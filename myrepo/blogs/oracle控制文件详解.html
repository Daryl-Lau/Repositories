<html>
<head>
  <title>oracle控制文件详解</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="500"/>
<h1>oracle控制文件详解</h1>

<div>
<span><div>oracle控制文件详解</div><div><br/></div><div>Oracle控制文件详解</div><div><br/></div><div>一、Oracle 控制文件</div><div><br/></div><div>        为二进制文件，初始化大小由CREATE DATABASE指定,可以使用RMAN备份</div><div><br/></div><div>        记录了当前数据库的结构信息,同时也包含数据文件及日志文件的信息以及相关的状态,归档信息等等</div><div><br/></div><div>        在参数文件中描述其位置，个数等等。通常采用分散放开，多路复用的原则。在mount阶段被读取，open阶段一直被使用</div><div><br/></div><div>        维护数据库一致性(数据库启动时会比较控制文件与联机日志文件中的ckpt,即起始scn号，如相等则正常启动，否则需要介质恢复)</div><div><br/></div><div>        一个控制文件只能属于一个数据库</div><div><br/></div><div>        控制文件的任意修改将写入到初始化参数中指定的所有控制文件中，读取时则仅读取第一个控制文件</div><div><br/></div><div>        控制文件只能连接一个数据库，控制文件的大小一般不要超过MB,最多为个，最少一个，互为镜像</div><div><br/></div><div>               </div><div><br/></div><div>        控制文件中包含的内容</div><div><br/></div><div>            数据库的名字、ID、创建的时间戳</div><div><br/></div><div>            表空间的名字</div><div><br/></div><div>            联机日志文件、数据文件的位置、个数、名字</div><div><br/></div><div>            联机日志的Sequence号码</div><div><br/></div><div>            检查点的信息</div><div><br/></div><div>            撤销段的开始或结束</div><div><br/></div><div>            归档信息</div><div><br/></div><div>            备份信息</div><div><br/></div><div>   </div><div><br/></div><div>二、查看控制文件的相关信息</div><div><br/></div><div>    1.使用相关视图来查看</div><div><br/></div><div>        V$CONTROLFILE                   --列出实例中所有控制文件的名字及状态信息</div><div><br/></div><div>        V$PARAMETER                     --列出所有参数的位置及状态信息</div><div><br/></div><div>        V$CONTROLFILE_RECORD_SECTION    --列出控制文件中记录的部分信息</div><div><br/></div><div>        SHOW PARAMETER CONTROL_FILES    --列出控制文件的名字、状态、位置等</div><div><br/></div><div>2.使用STRINGS命令来查看控制文件中的具体内容</div><div><br/></div><div>3.备份控制文件到平面文件(然后查看控制文件中的具体内容)</div><div><br/></div><div>        SQL&gt; alter database backup controlfile  to trace as '/u01/app/oracle/ctl.txt';</div><div><br/></div><div>        Database altered.</div><div><br/></div><div>4.转储控制文件内容(查看控制文件中的具体内容)</div><div><br/></div><div>        alter session set events 'immediate trace name CONTROLF level 12'; level表示级别</div><div><br/></div><div>        或                     --level1  块头的内容 --level2 数据文件内容 --levle 10 |12 所有内容</div><div><br/></div><div>        oradebug setmypid</div><div><br/></div><div>        oradebug dump controlf 12</div><div><br/></div><div>   </div><div><br/></div><div>        SQL&gt; alter system set events 'immediate trace name controlf level 10';</div><div><br/></div><div>        System altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; show parameter user_dump;</div><div><br/></div><div>        NAME                                 TYPE        VALUE</div><div><br/></div><div>        ------------------------------------ ----------- ------------------------------</div><div><br/></div><div>        user_dump_dest                       string      /u01/app/oracle/admin/orcl/udump</div><div><br/></div><div>三、控制文件的管理</div><div><br/></div><div>    规划原则：多路复用,建议存放到不同的磁盘或同一磁盘不同的分区</div><div><br/></div><div>    个数与位置及状态管理:</div><div><br/></div><div>        查看控制文件的状态是否与参数定义中的相吻合,当数据库发生结构修改时，将修改内容同时写入控制文件</div><div><br/></div><div>    备份管理</div><div><br/></div><div>    恢复管理</div><div><br/></div><div>    新建控制文件语句</div><div><br/></div><div>   </div><div><br/></div><div>    spfile或pfile都可以实现对控制文件的个数及位置管理</div><div><br/></div><div>    spfile步骤</div><div><br/></div><div>        修改spfile参数中的control_files   -- alter system ... scope = spfile | both |memory</div><div><br/></div><div>        一致性关闭数据库</div><div><br/></div><div>        增加或减少控制文件(cp or mv)</div><div><br/></div><div>        启动数据库使用spfile</div><div><br/></div><div>        验证结果</div><div><br/></div><div>       </div><div><br/></div><div>    pfile步骤</div><div><br/></div><div>        一致性关闭数据库</div><div><br/></div><div>        修改pfile参数(vi或vim)   修改*.control_files＝......这一段</div><div><br/></div><div>        增加或减少控制文件(cp or mv)</div><div><br/></div><div>        启动数据库使用pfile</div><div><br/></div><div>        验证结果</div><div><br/></div><div>       </div><div><br/></div><div>    --演示spfile修改控制文件</div><div><br/></div><div>        SQL&gt; show parameter control_file</div><div><br/></div><div><br/></div><div>        NAME                                 TYPE        VALUE</div><div><br/></div><div>        ------------------------------------ ----------- ------------------------------</div><div><br/></div><div>        control_file_record_keep_time        integer     7</div><div><br/></div><div>        control_files                        string      /u01/app/oracle/oradata/orcl/c</div><div><br/></div><div>                                                         ontrol01.ctl, /u01/app/oracle/</div><div><br/></div><div>                                                         oradata/orcl/control02.ctl, /u</div><div><br/></div><div>                                                         01/app/oracle/oradata/orcl/con</div><div><br/></div><div>                                                         trol03.ctl</div><div><br/></div><div>        --将控制文件减少到一个</div><div><br/></div><div>        SQL&gt; alter system set control_files = '/u01/app/oracle/oradata/orcl/control01.ctl' scope =spfile;</div><div><br/></div><div><br/></div><div>        System altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; shutdown immediate;</div><div><br/></div><div>        Database closed.</div><div><br/></div><div>        Database dismounted.</div><div><br/></div><div>        ORACLE instance shut down.</div><div><br/></div><div>        SQL&gt; startup mount</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              88082196 bytes</div><div><br/></div><div>        Database Buffers          159383552 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        Database mounted.</div><div><br/></div><div>       </div><div><br/></div><div>        --再次查看参数文件,已显示为一个</div><div><br/></div><div>        SQL&gt; show parameter control_file</div><div><br/></div><div><br/></div><div>        NAME                                 TYPE        VALUE</div><div><br/></div><div>        ------------------------------------ ----------- ------------------------------</div><div><br/></div><div>        control_file_record_keep_time        integer     7</div><div><br/></div><div>        control_files                        string      /u01/app/oracle/oradata/orcl/c</div><div><br/></div><div>                                                         ontrol01.ctl</div><div><br/></div><div>       </div><div><br/></div><div>        --增加控制文件(在nomount状态下即可修改)</div><div><br/></div><div>        SQL&gt; alter system set control_files = '/u01/app/oracle/oradata/orcl/control01.ctl',</div><div><br/></div><div>          2  '/u01/app/oracle/oradata/orcl/control02.ctl',</div><div><br/></div><div>          3  '/u01/app/oracle/oradata/orcl/control03.ctl'</div><div><br/></div><div>          4  scope = spfile;</div><div><br/></div><div><br/></div><div>        System altered.</div><div><br/></div><div>       </div><div><br/></div><div>        --启动时可以看到在实例阶段出现了版本号不一致的问题</div><div><br/></div><div>        SQL&gt; startup force</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              88082196 bytes</div><div><br/></div><div>        Database Buffers          159383552 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        ORA-00214: control file '/u01/app/oracle/oradata/orcl/control01.ctl' version</div><div><br/></div><div>        1051 inconsistent with file '/u01/app/oracle/oradata/orcl/control02.ctl'</div><div><br/></div><div>        version 1049</div><div><br/></div><div>       </div><div><br/></div><div>        --处理办法,用版本号高的控制文件覆盖版本号低的控制文件</div><div><br/></div><div>        SQL&gt; host cp /u01/app/oracle/oradata/orcl/control01.ctl/u01/app/oracle/oradata/orcl/control02.ctl;</div><div><br/></div><div>        SQL&gt; host cp /u01/app/oracle/oradata/orcl/control01.ctl/u01/app/oracle/oradata/orcl/control03.ctl;</div><div><br/></div><div>        SQL&gt; alter database mount;</div><div><br/></div><div>        Database altered.</div><div><br/></div><div>        SQL&gt; alter database open;</div><div><br/></div><div>        Database altered.  </div><div><br/></div><div>       </div><div><br/></div><div>    对于控制文件丢失的情况下,通过查看参数文件中设置,使用操作系统命令逐个查看这些文件是否存在</div><div><br/></div><div>   </div><div><br/></div><div>        SQL&gt; host ls /u01/app/oracle/oradata/orcl/control01.ctl</div><div><br/></div><div>        /u01/app/oracle/oradata/orcl/control01.ctl</div><div><br/></div><div><br/></div><div>        SQL&gt; host ls /u01/app/oracle/oradata/orcl/control02.ctl</div><div><br/></div><div>        /u01/app/oracle/oradata/orcl/control02.ctl</div><div><br/></div><div>   </div><div><br/></div><div>    查看控制文件所在的目录可用空间及控制文件的大小,建议不要超过100MB</div><div><br/></div><div>        SQL&gt; host ls /u01/app/oracle/oradata/orcl/c*.ctl -lh</div><div><br/></div><div>        -rw-r----- 1 oracle oinstall 6.8M May 23 10:55 /u01/app/oracle/oradata/orcl/control01.ctl</div><div><br/></div><div>        -rw-r----- 1 oracle oinstall 6.8M May 23 10:55 /u01/app/oracle/oradata/orcl/control02.ctl</div><div><br/></div><div>        -rw-r----- 1 oracle oinstall 6.8M May 23 10:55 /u01/app/oracle/oradata/orcl/control03.ctl</div><div><br/></div><div><br/></div><div>        SQL&gt; ! df -h</div><div><br/></div><div>        Filesystem            Size  Used Avail Use% Mounted on</div><div><br/></div><div>        /dev/sda2             6.4G  3.9G  2.2G  64% /</div><div><br/></div><div>        /dev/sdd1             6.8G  3.7G  2.8G  58% /u01</div><div><br/></div><div>        /dev/sdc2             1.2G   34M  1.1G   3% /home</div><div><br/></div><div>        /dev/sdc1             760M   17M  704M   3% /tmp</div><div><br/></div><div>        /dev/sda1             456M   18M  415M   5% /boot</div><div><br/></div><div>        tmpfs                 450M     0  450M   0% /dev/shm</div><div><br/></div><div>        none                  450M  104K  450M   1% /var/lib/xenstored</div><div><br/></div><div>       </div><div><br/></div><div>    控制文件的备份</div><div><br/></div><div>        热备:</div><div><br/></div><div>            alter database backup controlfile to '&lt;dir&gt;';  --热备份控制文件</div><div><br/></div><div>            alter database backup controlfile to trace as '&lt;dir&gt;' ;--得到建立控制文件的脚本</div><div><br/></div><div>        RMAN:</div><div><br/></div><div>            backup current controlfile;</div><div><br/></div><div>            backup database include current controlfile;</div><div><br/></div><div>            -- 或者设置RMAN 为自动备份</div><div><br/></div><div>            RMAN &gt; configure controlfile autobackup on;</div><div><br/></div><div>           </div><div><br/></div><div>        --演示备份</div><div><br/></div><div>        --用于归档模式下的恢复，直接覆盖到控制文件</div><div><br/></div><div>        SQL&gt; alter database backup controlfile to '/u01/app/oracle/control.bak';</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div>       </div><div><br/></div><div>        --用于重建控制文件</div><div><br/></div><div>        SQL&gt; alter database backup controlfile to trace as'/u01/app/oracle/recreate_controlfile.txt';</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div>      </div><div><br/></div><div>        --使用RMAN备份</div><div><br/></div><div>        RMAN&gt; connect target /;</div><div><br/></div><div><br/></div><div>        connected to target database: ORCL (DBID=1242732291)</div><div><br/></div><div><br/></div><div>        RMAN&gt; backup current controlfile;   --handle为备份文件的路径</div><div><br/></div><div><br/></div><div>        Starting backup at 23-MAY-10</div><div><br/></div><div>        using target database control file instead of recovery catalog</div><div><br/></div><div>        allocated channel: ORA_DISK_1</div><div><br/></div><div>        channel ORA_DISK_1: sid=148 devtype=DISK</div><div><br/></div><div>        channel ORA_DISK_1: starting full datafile backupset</div><div><br/></div><div>        channel ORA_DISK_1: specifying datafile(s) in backupset</div><div><br/></div><div>        including current control file in backupset</div><div><br/></div><div>        channel ORA_DISK_1: starting piece 1 at 23-MAY-10</div><div><br/></div><div>        channel ORA_DISK_1: finished piece 1 at 23-MAY-10</div><div><br/></div><div>        piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/</div><div><br/></div><div>              2010_05_23/o1_mf_ncnnf_TAG20100523T131841_5zkgon2l_.bkp tag=TAG20100523T131841 comment=NONE</div><div><br/></div><div>        channel ORA_DISK_1: backup set complete, elapsed time: 00:00:05</div><div><br/></div><div>        Finished backup at 23-MAY-10</div><div><br/></div><div>       </div><div><br/></div><div>        RMAN&gt; backup database include current controlfile;</div><div><br/></div><div><br/></div><div>        Starting backup at 23-MAY-10</div><div><br/></div><div>        using target database control file instead of recovery catalog</div><div><br/></div><div>        allocated channel: ORA_DISK_1</div><div><br/></div><div>        channel ORA_DISK_1: sid=141 devtype=DISK</div><div><br/></div><div>        channel ORA_DISK_1: starting full datafile backupset</div><div><br/></div><div>        channel ORA_DISK_1: specifying datafile(s) in backupset</div><div><br/></div><div>        input datafile fno=00001 name=/u01/app/oracle/oradata/orcl/system01.dbf</div><div><br/></div><div>        input datafile fno=00003 name=/u01/app/oracle/oradata/orcl/sysaux01.dbf</div><div><br/></div><div>        input datafile fno=00005 name=/u01/app/oracle/oradata/orcl/example01.dbf</div><div><br/></div><div>        input datafile fno=00006 name=/u01/app/oracle/oradata/orcl/tbs1_1.dbf</div><div><br/></div><div>        input datafile fno=00007 name=/u01/app/oracle/oradata/orcl/tbs1_2.dbf</div><div><br/></div><div>        input datafile fno=00002 name=/u01/app/oracle/oradata/orcl/undotbs01.dbf</div><div><br/></div><div>        input datafile fno=00004 name=/u01/app/oracle/oradata/orcl/users01.dbf</div><div><br/></div><div>        channel ORA_DISK_1: starting piece 1 at 23-MAY-10</div><div><br/></div><div>        channel ORA_DISK_1: finished piece 1 at 23-MAY-10</div><div><br/></div><div>        piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/</div><div><br/></div><div>              2010_05_23/o1_mf_nnndf_TAG20100523T132647_5zkh4sk2_.bkp tag=TAG20100523T132647 comment=NONE</div><div><br/></div><div>        channel ORA_DISK_1: backup set complete, elapsed time: 00:05:25</div><div><br/></div><div>        channel ORA_DISK_1: starting full datafile backupset</div><div><br/></div><div>        channel ORA_DISK_1: specifying datafile(s) in backupset</div><div><br/></div><div>        including current control file in backupset</div><div><br/></div><div>        including current SPFILE in backupset</div><div><br/></div><div>        channel ORA_DISK_1: starting piece 1 at 23-MAY-10</div><div><br/></div><div>        channel ORA_DISK_1: finished piece 1 at 23-MAY-10</div><div><br/></div><div>        piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/</div><div><br/></div><div>              2010_05_23/o1_mf_ncsnf_TAG20100523T132647_5zkhh5st_.bkp tag=TAG20100523T132647 comment=NONE</div><div><br/></div><div>        channel ORA_DISK_1: backup set complete, elapsed time: 00:00:14</div><div><br/></div><div>        Finished backup at 23-MAY-10</div><div><br/></div><div>       </div><div><br/></div><div>        RMAN&gt; show all;</div><div><br/></div><div><br/></div><div>        RMAN configuration parameters are:</div><div><br/></div><div>        CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default</div><div><br/></div><div>        CONFIGURE BACKUP OPTIMIZATION OFF; # default</div><div><br/></div><div>        CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default</div><div><br/></div><div>        CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default</div><div><br/></div><div>        CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default</div><div><br/></div><div>        CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default</div><div><br/></div><div>        CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default</div><div><br/></div><div>        CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default</div><div><br/></div><div>        CONFIGURE MAXSETSIZE TO UNLIMITED; # default</div><div><br/></div><div>        CONFIGURE ENCRYPTION FOR DATABASE OFF; # default</div><div><br/></div><div>        CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default</div><div><br/></div><div>        CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default</div><div><br/></div><div>        CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u01/app/oracle/10g/dbs/snapcf_orcl.f'; # default</div><div><br/></div><div><br/></div><div>        RMAN&gt; configure controlfile autobackup on;   --将控制文件自动备份功能置为on;</div><div><br/></div><div><br/></div><div>        new RMAN configuration parameters:</div><div><br/></div><div>        CONFIGURE CONTROLFILE AUTOBACKUP ON;</div><div><br/></div><div>        new RMAN configuration parameters are successfully stored</div><div><br/></div><div>       </div><div><br/></div><div>    控制文件的恢复管理</div><div><br/></div><div>        控制文件版本不一致的问题</div><div><br/></div><div>            用较新版本的控制文件覆盖旧版本的控制文件</div><div><br/></div><div>            直接修改参数control_file</div><div><br/></div><div>        丢失问题</div><div><br/></div><div>            归档模式下</div><div><br/></div><div>                当归档日志全的时候,先做全备,然后使用备份的控制文件恢复即可</div><div><br/></div><div>                当归档日志不全的时候,先做全备,然后建立新的控制文件即可</div><div><br/></div><div>            非归档模式下</div><div><br/></div><div>                先做全备,然后建立新的控制文件即可</div><div><br/></div><div>        新建控制文件语句</div><div><br/></div><div>            数据库处于mount及open状态</div><div><br/></div><div>            执行alter database backup controlfile to trace as '&lt;dir&gt;';得到建立语句</div><div><br/></div><div>            注意[no]archievelog [no]resetlogs 两个参数的区别</div><div><br/></div><div>           </div><div><br/></div><div>    版本不一致演示</div><div><br/></div><div>        SQL&gt; startup</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              88082196 bytes</div><div><br/></div><div>        Database Buffers          159383552 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        ORA-00214: control file '/u01/app/oracle/oradata/orcl/control01.ctl' version</div><div><br/></div><div>        1051 inconsistent with file '/u01/app/oracle/oradata/orcl/control02.ctl'</div><div><br/></div><div>        version 1049</div><div><br/></div><div>       </div><div><br/></div><div>        --处理办法,用版本号高的控制文件覆盖版本号低的控制文件</div><div><br/></div><div>        SQL&gt; host cp /u01/app/oracle/oradata/orcl/control01.ctl/u01/app/oracle/oradata/orcl/control02.ctl;</div><div><br/></div><div><br/></div><div>        SQL&gt; host cp /u01/app/oracle/oradata/orcl/control01.ctl/u01/app/oracle/oradata/orcl/control03.ctl;</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database mount;</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database open;</div><div><br/></div><div><br/></div><div>        Database altered.  </div><div><br/></div><div>       </div><div><br/></div><div>        --控制文件部分丢失的演示，原本有两个控制文件，丢失一个</div><div><br/></div><div>        --处理办法：</div><div><br/></div><div>            1.将存在的控制文件复制到目的路径并更改控制文件名字为正确的控制文件名称</div><div><br/></div><div>            2.修改控控文件参数将丢失的控制文件去掉(一般不建议使用)</div><div><br/></div><div>        SQL&gt; alter system set control_files = ' /u01/app/oracle/oradata/orcl/c ontrol01.ctl',</div><div><br/></div><div>          2  '/u01/app/oracle/oradata/orcl/control02.ctl' scope = spfile;</div><div><br/></div><div><br/></div><div>        System altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; shutdown immediate;</div><div><br/></div><div>        Database closed.</div><div><br/></div><div>        Database dismounted.</div><div><br/></div><div>        ORACLE instance shut down.</div><div><br/></div><div>        SQL&gt; startup</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              75499284 bytes</div><div><br/></div><div>        Database Buffers          171966464 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        ORA-00205: error in identifying control file, check alert log for more info</div><div><br/></div><div>               </div><div><br/></div><div>        [oracle@robinson ~]$ tail -n 100 /u01/app/oracle/admin/orcl/bdump/alert_orcl.log</div><div><br/></div><div>        ..........................     </div><div><br/></div><div>        Tue Jun  8 19:03:42 2010</div><div><br/></div><div>        starting up 1 shared server(s) ...</div><div><br/></div><div>        MMON started with pid=11, OS id=4557</div><div><br/></div><div>        CJQ0 started with pid=10, OS id=4555</div><div><br/></div><div>        Tue Jun  8 19:03:44 2010</div><div><br/></div><div>        ALTER DATABASE   MOUNT</div><div><br/></div><div>        Tue Jun  8 19:03:44 2010</div><div><br/></div><div>        ORA-00202: control file: '/u01/app/oracle/10g/dbs/ /u01/app/oracle/oradata/orcl/c ontrol01.ctl'</div><div><br/></div><div>        ORA-27037: unable to obtain file status</div><div><br/></div><div>        Linux Error: 2: No such file or directory</div><div><br/></div><div>        Additional information: 3</div><div><br/></div><div>        Tue Jun  8 19:03:47 2010</div><div><br/></div><div>        ORA-205 signalled during: ALTER DATABASE   MOUNT...</div><div><br/></div><div><br/></div><div>        --从警告日志中得知，文件名为c ontrol01.ctl的文件不存在，故将其改为正确的文件名</div><div><br/></div><div>                                                         </div><div><br/></div><div>        SQL&gt; alter system set control_files='/u01/app/oracle/oradata/orcl/control01.ctl',</div><div><br/></div><div>          2  '/u01/app/oracle/oradata/orcl/control02.ctl' scope = spfile;</div><div><br/></div><div><br/></div><div>        System altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; startup force</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              83887892 bytes</div><div><br/></div><div>        Database Buffers          163577856 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        Database mounted.</div><div><br/></div><div>        Database opened.</div><div><br/></div><div><br/></div><div>    非归档模式下，当所有的控制文件都丢失，只能重建控制文件来解决</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              79693588 bytes</div><div><br/></div><div>        Database Buffers          167772160 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        ORA-00205: error in identifying control file, check alert log for more info</div><div><br/></div><div>       </div><div><br/></div><div>        [oracle@robinson ~]$tail -n 100 /u01/app/oracle/admin/orcl/bdump/alert_orcl.log</div><div><br/></div><div>        ALTER DATABASE   MOUNT</div><div><br/></div><div>        Thu Jul 15 12:13:15 2010</div><div><br/></div><div>        ORA-00202: control file: '/u01/app/oracle/oradata/orcl/control01.ctl'</div><div><br/></div><div>        ORA-27037: unable to obtain file status</div><div><br/></div><div>        Linux Error: 2: No such file or directory</div><div><br/></div><div><br/></div><div>        --重建控制文件主要有三个需要考虑的是</div><div><br/></div><div>        --搞清各个日志文件的大小及位置</div><div><br/></div><div>        --搞清各个数据文件的位置</div><div><br/></div><div>        --设置正确的字符集     </div><div><br/></div><div><br/></div><div>        SQL&gt; CREATE CONTROLFILE REUSE DATABASE &quot;orcl&quot; NOARCHIVELOG NORESTLOGS</div><div><br/></div><div>          2  MAXLOGFILES 16</div><div><br/></div><div>          3  MAXLOGMEMBER 3</div><div><br/></div><div>          4  MAXDATAFILES 20</div><div><br/></div><div>          5  MAXINSTANCES 8</div><div><br/></div><div>          6  MAXLOGHISTORY 3</div><div><br/></div><div>          7  LOGFILE</div><div><br/></div><div>          8    GROUP 1(</div><div><br/></div><div>          9      'u01/app/oracle/oradata/orcl/redo1.log',</div><div><br/></div><div>         10      '/u01/app/oracle/oradata/orcl/redo01.log'</div><div><br/></div><div>         11       ) SIZE 50M,</div><div><br/></div><div>         12    GROUP 2(</div><div><br/></div><div>         13      '/u01/app/oracle/oradata/orcl/redo2.log',  </div><div><br/></div><div>         14      '/u01/app/oracle/oradata/orcl/redo02.log'      </div><div><br/></div><div>         15       ) SIZE 50M,</div><div><br/></div><div>         16    GROUP 3(</div><div><br/></div><div>         17      '/u01/app/oracle/oradata/orcl/redo3.log',      </div><div><br/></div><div>         18      '/u01/app/oracle/oradata/orcl/redo03.log'    </div><div><br/></div><div>         19       ) SIZE 100M</div><div><br/></div><div>         20  DATAFILE</div><div><br/></div><div>         21    '/u01/app/oracle/oradata/orcl/tbs1_2.dbf',</div><div><br/></div><div>         22    '/u01/app/oracle/oradata/orcl/tbs1_1.dbf',     </div><div><br/></div><div>         23    '/u01/app/oracle/oradata/orcl/example01.dbf',</div><div><br/></div><div>         24    '/u01/app/oracle/oradata/orcl/users01.dbf',</div><div><br/></div><div>         25    '/u01/app/oracle/oradata/orcl/sysaux01.dbf',</div><div><br/></div><div>         26    '/u01/app/oracle/oradata/orcl/system01.dbf',</div><div><br/></div><div>         27    '/u01/app/oracle/oradata/orcl/undotbs01.dbf'</div><div><br/></div><div>         28  CHARACTER SET WE8ISO8859P1;</div><div><br/></div><div>        CREATE CONTROLFILE REUSE DATABASE &quot;orcl&quot; NOARCHIVELOG NORESTLOGS</div><div><br/></div><div>                                                              *</div><div><br/></div><div>        ERROR at line 1:</div><div><br/></div><div>        ORA-01967: invalid option for CREATE CONTROLFILE</div><div><br/></div><div><br/></div><div>        SQL&gt; save /u01/app/oracle/oradata/rectl.sql;</div><div><br/></div><div>        Created file /u01/app/oracle/oradata/rectl.sql</div><div><br/></div><div>        SQL&gt; ho vim /u01/app/oracle/oradata/rectl.sql</div><div><br/></div><div><br/></div><div>        SQL&gt; @/u01/app/oracle/oradata/rectl.sql</div><div><br/></div><div><br/></div><div>        Control file created.</div><div><br/></div><div><br/></div><div>        --下面给出正确执行后的语句内容</div><div><br/></div><div>        SQL&gt; host cat /u01/app/oracle/oradata/rectl.sql</div><div><br/></div><div>        CREATE CONTROLFILE REUSE DATABASE &quot;orcl&quot; NOARCHIVELOG NORESETLOGS</div><div><br/></div><div>        MAXLOGFILES 16</div><div><br/></div><div>        MAXLOGMEMBERS 3</div><div><br/></div><div>        MAXDATAFILES 20</div><div><br/></div><div>        MAXINSTANCES 8</div><div><br/></div><div>        MAXLOGHISTORY 3</div><div><br/></div><div>        LOGFILE</div><div><br/></div><div>          GROUP 1(</div><div><br/></div><div>            '/u01/app/oracle/oradata/orcl/redo01.log'</div><div><br/></div><div>             ) SIZE 50M,</div><div><br/></div><div>          GROUP 2(</div><div><br/></div><div>            '/u01/app/oracle/oradata/orcl/redo2.log',</div><div><br/></div><div>            '/u01/app/oracle/oradata/orcl/redo02.log'</div><div><br/></div><div>             ) SIZE 50M,</div><div><br/></div><div>          GROUP 3(</div><div><br/></div><div>            '/u01/app/oracle/oradata/orcl/redo3.log',</div><div><br/></div><div>            '/u01/app/oracle/oradata/orcl/redo03.log'</div><div><br/></div><div>             ) SIZE 100M</div><div><br/></div><div>        DATAFILE</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/tbs1_2.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/tbs1_1.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/example01.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/users01.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/sysaux01.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/system01.dbf',</div><div><br/></div><div>          '/u01/app/oracle/oradata/orcl/undotbs01.dbf'</div><div><br/></div><div>        CHARACTER SET WE8ISO8859P1</div><div><br/></div><div>        /</div><div><br/></div><div>       </div><div><br/></div><div>        --将数据库切换到open 状态</div><div><br/></div><div>        SQL&gt; alter database open;</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; select * from dual;</div><div><br/></div><div><br/></div><div>        D</div><div><br/></div><div>        -</div><div><br/></div><div>        X</div><div><br/></div><div>       </div><div><br/></div><div>        --查看已经新产生了控制文件</div><div><br/></div><div>        SQL&gt; host ls $ORACLE_BASE/oradata/orcl/control* -l  --可以看到新增了控制文件control01.ctl和control02.ctl</div><div><br/></div><div>        -rw-r----- 1 oracle oinstall 6012928 Jul 15 12:58 /u01/app/oracle/oradata/orcl/control01.ctl</div><div><br/></div><div>        -rw------- 1 oracle oinstall 7389184 Jul 15 12:04 /u01/app/oracle/oradata/orcl/control01.ctl.bak</div><div><br/></div><div>        -rw-r----- 1 oracle oinstall 6012928 Jul 15 12:58 /u01/app/oracle/oradata/orcl/control02.ctl</div><div><br/></div><div><br/></div><div>    归档模式下控制文件全部丢失的处理</div><div><br/></div><div>        --首先将数据库切换到归档模式</div><div><br/></div><div>        SQL&gt; shutdown immediate;</div><div><br/></div><div>        Database closed.</div><div><br/></div><div>        Database dismounted.</div><div><br/></div><div>        ORACLE instance shut down.</div><div><br/></div><div>        SQL&gt; startup mount;</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              79693588 bytes</div><div><br/></div><div>        Database Buffers          167772160 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        Database mounted.</div><div><br/></div><div>        SQL&gt; alter database archivelog;</div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database open  ;</div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        --查看归档的状态</div><div><br/></div><div>        SQL&gt; archive log list;</div><div><br/></div><div>        Database log mode              Archive Mode</div><div><br/></div><div>        Automatic archival             Enabled</div><div><br/></div><div>        Archive destination            USE_DB_RECOVERY_FILE_DEST</div><div><br/></div><div>        Oldest online log sequence     1</div><div><br/></div><div>        Next log sequence to archive   3</div><div><br/></div><div>        Current log sequence           3</div><div><br/></div><div><br/></div><div>        --备份控制文件</div><div><br/></div><div>        SQL&gt; alter database backup controlfile to '/u01/app/oracle/oradata/orcl/rectl.bak';</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; create table tb_temp(id int,col1 varchar2(20));</div><div><br/></div><div><br/></div><div>        Table created.</div><div><br/></div><div><br/></div><div>        SQL&gt; insert into tb_temp select 1,'Robinson' from dual;</div><div><br/></div><div><br/></div><div>        1 row created.</div><div><br/></div><div><br/></div><div>        SQL&gt; commit;</div><div><br/></div><div><br/></div><div>        Commit complete.</div><div><br/></div><div><br/></div><div>        SQL&gt; alter system switch logfile;   --切换日志</div><div><br/></div><div><br/></div><div>        System altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; archive log list; --日志切换后sequence由变成</div><div><br/></div><div>        Database log mode              Archive Mode</div><div><br/></div><div>        Automatic archival             Enabled</div><div><br/></div><div>        Archive destination            USE_DB_RECOVERY_FILE_DEST</div><div><br/></div><div>        Oldest online log sequence     2</div><div><br/></div><div>        Next log sequence to archive   4</div><div><br/></div><div>        Current log sequence           4</div><div><br/></div><div><br/></div><div>        --模拟控制文件全部丢失</div><div><br/></div><div>        SQL&gt; startup</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              79693588 bytes</div><div><br/></div><div>        Database Buffers          167772160 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        ORA-00205: error in identifying control file, check alert log for more info</div><div><br/></div><div><br/></div><div>        SQL&gt; show parameter control</div><div><br/></div><div><br/></div><div>        NAME                                 TYPE        VALUE</div><div><br/></div><div>        ------------------------------------ ----------- ------------------------------</div><div><br/></div><div>        control_file_record_keep_time        integer     7</div><div><br/></div><div>        control_files                        string      /u01/app/oracle/oradata/orcl/c</div><div><br/></div><div>                                                         ontrol01.ctl, /u01/app/oracle/</div><div><br/></div><div>                                                         oradata/orcl/control02.ctl</div><div><br/></div><div><br/></div><div>        --查看物理控制文件是否存在                                             </div><div><br/></div><div>        SQL&gt; ho ls /u01/app/oracle/oradata/orcl/contr*</div><div><br/></div><div>        ls: /u01/app/oracle/oradata/orcl/contr*: No such file or directory</div><div><br/></div><div><br/></div><div>        --建议先对数据库作备份再将备份的控制文件复制到参数文件中指定的位置</div><div><br/></div><div><br/></div><div>        SQL&gt; ho cp /u01/app/oracle/oradata/orcl/rectl.bak/u01/app/oracle/oradata/orcl/control01.ctl</div><div><br/></div><div><br/></div><div>        SQL&gt; ho cp /u01/app/oracle/oradata/orcl/rectl.bak/u01/app/oracle/oradata/orcl/control02.ctl</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database mount;</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database open;</div><div><br/></div><div>        alter database open</div><div><br/></div><div>        *</div><div><br/></div><div>        ERROR at line 1:</div><div><br/></div><div>        ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</div><div><br/></div><div><br/></div><div>        SQL&gt; shutdown immediate;</div><div><br/></div><div>        ORA-01109: database not open</div><div><br/></div><div>        Database dismounted.</div><div><br/></div><div>        ORACLE instance shut down.</div><div><br/></div><div>       </div><div><br/></div><div>        SQL&gt; startup mount;</div><div><br/></div><div>        ORACLE instance started.</div><div><br/></div><div><br/></div><div>        Total System Global Area  251658240 bytes</div><div><br/></div><div>        Fixed Size                  1218796 bytes</div><div><br/></div><div>        Variable Size              79693588 bytes</div><div><br/></div><div>        Database Buffers          167772160 bytes</div><div><br/></div><div>        Redo Buffers                2973696 bytes</div><div><br/></div><div>        Database mounted.</div><div><br/></div><div><br/></div><div>        SQL&gt; alter database open resetlogs;</div><div><br/></div><div><br/></div><div>        Database altered.</div><div><br/></div><div><br/></div><div>        SQL&gt; select * from dual;</div><div><br/></div><div><br/></div><div>        D</div><div><br/></div><div>        -</div><div><br/></div><div>        X</div><div><br/></div><div><br/></div><div>        SQL&gt; select * from tb_temp;  --表成功被恢复</div><div><br/></div><div><br/></div><div>                ID COL1</div><div><br/></div><div>        ---------- --------------------</div><div><br/></div><div>                 1 Robinson</div><div><br/></div><div><br/></div><div>        SQL&gt; drop table tb_temp purge;</div><div><br/></div><div><br/></div><div>        Table dropped.</div><div><br/></div><div><br/></div><div>        SQL&gt; archive log list;   --日志的sequence号被置为</div><div><br/></div><div>        Database log mode              Archive Mode</div><div><br/></div><div>        Automatic archival             Enabled</div><div><br/></div><div>        Archive destination            USE_DB_RECOVERY_FILE_DEST</div><div><br/></div><div>        Oldest online log sequence     1</div><div><br/></div><div>        Next log sequence to archive   1</div><div><br/></div><div>        Current log sequence           1</div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 