<html>
<head>
  <title>RMAN恢复控制文件-控制文件(controlfile)丢失恢复</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="528"/>
<h1>RMAN恢复控制文件-控制文件(controlfile)丢失恢复</h1>

<div>
<span><div>RMAN恢复控制文件-<span style="font-size: 14px; color: rgb(51, 51, 51);">控制文件(controlfile)丢失恢复</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">基于控制文件的复合多路径性，它的丢失分为两种，一种是其中某个控制文件的损坏或丢失，另外一种是所有控制文件均丢失。</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">基于第一种情况，只需把好的控制文件复制一份在损坏或丢失的那个控制文件路径下即可。第二种情况下则需要通过备份信息来对控制文件进行恢复或手工重建控制文件。</span></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-weight: bold;">情景一：单一控制文件丢失</span></font></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">查看控制文件</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="color: rgb(51, 51, 51);"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; select name from v$controlfile;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">NAME</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">--------------------------------------------------------------------------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">/oracle/11g/oradata/oracle/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">/oracle/11g/flash_recovery_area/oracle/control02.ctl</span></div></div><div style="color: rgb(51, 51, 51);"><div><br/></div></div><div><font color="#3665EE" face="DejaVu Sans Mono"><span style="font-size: 14.6667px;">##或者</span></font></div><div style="color: rgb(51, 51, 51);"><div><br/></div></div><div style="color: rgb(51, 51, 51);"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; show parameter control_file;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">NAME                            TYPE        VALUE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">control_file_record_keep_time   integer     7</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">control_files                   string      /oracle/11g/oradata/oracle/con</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                            trol01.ctl, /oracle/11g/flash_</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                            recovery_area/oracle/control02</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                            .ctl</span></div></div></div><div><br/></div><div>模拟控制文件丢失，删除控制文件<span style="font-size: 11pt; color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;;">/oracle/11g/oradata/oracle/control01.ctl</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle ~]$ rm /oracle/11g/oradata/oracle/control01.ctl</span></div></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">关闭数据库，</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">数据库无法正常关闭，因为在关闭的时候必须向控制文件中更新scn号，</span><span style="font-size: 14px; color: rgb(51, 51, 51);">此时需要使用abort关闭</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; shutdown immediate;</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-00210: cannot open the specified control file</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-00202: control file: '/oracle/11g/oradata/oracle/control01.ctl'</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-27041: unable to open file</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Linux-x86_64 Error: 2: No such file or directory</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Additional information: 3</span></font></div><div><br/></div><div><br/></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; shutdown abort;</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORACLE instance shut down.</span></font></div></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">启动数据库失败</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; startup;</span></font></div><div><font color="#333333"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORACLE instance started.</span></font></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Total System Global Area  409194496 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Fixed Size          2213856 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Variable Size          335546400 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database Buffers        67108864 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Redo Buffers             4325376 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-00205: error in identifying control file, check alert log for more info</span></font></div></div><div><br/></div><div>使用其他的控制文件恢复</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle ~]$ cp -a /oracle/11g/flash_recovery_area/oracle/control02.ctl /oracle/11g/oradata/oracle/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle ~]$ ll /oracle/11g/oradata/oracle/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall 9945088 May 17 13:51 /oracle/11g/oradata/oracle/control01.ctl</span></div></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">重新启动</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; startup;</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-01081: cannot start already-running ORACLE - shut it down first</span></font></div><div><br/></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; shutdown abort;</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORACLE instance shut down.</span></font></div><div><br/></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; startup;</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORACLE instance started.</span></font></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Total System Global Area  409194496 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Fixed Size          2213856 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Variable Size          335546400 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database Buffers        67108864 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Redo Buffers             4325376 bytes</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database mounted.</span></font></div><div><font color="#333333"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database opened.</span></font></div></div><div><br/></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-weight: bold;">情景二：全部控制文件丢失，但是有自动备份控制文件</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; show all;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN configuration parameters for database with db_unique_name MYSQL_MA are:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE BACKUP OPTIMIZATION OFF; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">CONFIGURE CONTROLFILE AUTOBACKUP ON; </span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">   ##开启自动备份控制文件</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE CONTROLFILE AUTOBACKUP <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">FORMAT FOR DEVICE TYPE DISK TO '%F'</span>; # default   ##保存在闪回区中</span></div></div><div><br/></div><div>自动备份，备份文件放在闪回区</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; backup tablespace users;</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Starting Control File and SPFILE Autobackup at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">piece handle=/oracle/11g</span><span style="font-family: &quot;DejaVu Sans Mono&quot;;font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font color="#E30000">/flash_recovery_area</font></span><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">/MYSQL_MA/autobackup/2018_05_17/o1_mf_s_976388621_fhw2lg7b_.bkp comment=NONE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Finished Control File and SPFILE Autobackup at 17-MAY-18</span></div></div><div><br/></div><div>删除所有的控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 ~]$ rm /oracle/11g/oradata/mysql_master_1003306/control01.ctl /oracle/11g/flash_recovery_area/mysql_master_1003306/control02.ctl</span></div></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">关闭数据库，</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">数据库无法正常关闭，因为在关闭的时候必须向控制文件中更新scn号，</span><span style="font-size: 14px; color: rgb(51, 51, 51);">此时需要使用abort关闭</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">SQL&gt; shutdown immediate;</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-00210: cannot open the specified control file</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-00202: control file: '/oracle/11g/oradata/oracle/control01.ctl'</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-27041: unable to open file</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">Linux-x86_64 Error: 2: No such file or directory</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">Additional information: 3</span></div><div><br/></div><div><br/></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">SQL&gt; shutdown abort;</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORACLE instance shut down.</span></div></div><div><br/></div><div>rman连接到目标库,如果报错<span style="color: rgb(227, 0, 0);">ORA-12528: TNS:listener: all appropriate instances are blocking new connections，</span>则需要配置静态注册，使用静态注册的服务名来连，因为此时数据库连接是blocked的</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle oracle]$ rman target sys/Oracle_1@ma1 catalog rman/Rman_1@rman</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Recovery Manager: Release 11.2.0.1.0 - Production on Thu May 17 18:38:29 2018</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">connected to target database (</span><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">not started</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">connected to recovery catalog database</span></div></div><div><br/></div><div>恢复控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; startup nomount;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Oracle instance started</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Total System Global Area     409194496 bytes</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Fixed Size                     2213856 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Variable Size                335546400 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database Buffers              67108864 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Redo Buffers                   4325376 bytes</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; restore controlfile from autobackup;  ##自动识别自动备份里面的备份</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting restore at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">allocated channel: ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: SID=19 device type=DISK</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">recovery area destination: /oracle/11g/flash_recovery_area</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">database name (or database unique name) used for search: MYSQL_MA</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: AUTOBACKUP /oracle/11g/flash_recovery_area/MYSQL_MA/autobackup/2018_05_17/o1_mf_s_976388621_fhw2lg7b_.bkp found in the recovery area</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: looking for AUTOBACKUP on day: 20180517</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restoring control file from AUTOBACKUP /oracle/11g/flash_recovery_area/MYSQL_MA/autobackup/2018_05_17/o1_mf_s_976388621_fhw2lg7b_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: control file restore from AUTOBACKUP complete</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">output file name=/oracle/11g/oradata/mysql_master_1003306/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">output file name=/oracle/11g/flash_recovery_area/mysql_master_1003306/control02.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished restore at 17-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; alter database mount;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">database mounted</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">released channel: ORA_DISK_1</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; recover database;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting recover at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting implicit crosscheck backup at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">allocated channel: ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: SID=19 device type=DISK</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Crosschecked 1 objects</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished implicit crosscheck backup at 17-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting implicit crosscheck copy at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished implicit crosscheck copy at 17-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">searching for all files in the recovery area</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">cataloging files...</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">cataloging done</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">List of Cataloged Files</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">=======================</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">File Name: /oracle/11g/flash_recovery_area/MYSQL_MA/autobackup/2018_05_17/o1_mf_s_976388621_fhw2lg7b_.bkp</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting media recovery</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log for thread 1 with sequence 1 is already on disk as file /oracle/11g/oradata/mysql_master_1003306/redo01.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log file name=/oracle/11g/oradata/mysql_master_1003306/redo01.log thread=1 sequence=1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">media recovery complete, elapsed time: 00:00:00</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished recover at 17-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; alter database open resetlogs;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">database opened</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">new incarnation of database registered in recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting full resync of recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">full resync complete</span></div></div><div><font color="#E30000"><br/></font></div><div><font color="#E30000">以上是备份文件放在闪回区内，如果备份文件没有放在闪回区内，可能需要设置DBID，但是在oracle11g中，我试验的时候不需要设置DBID也可以进行恢复；</font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-weight: bold;"><br/></span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(51, 51, 51); font-weight: bold;">情景三：全部控制文件丢失，没有自动备份控制文件，但是有数据库全备</span></font></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">查看控制文件</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="color: rgb(51, 51, 51);"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sys@MYSQL_MA&gt; select name from v$controlfile;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">NAME</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-----------------------------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">/oracle/11g/oradata/mysql_master_10</span><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">03306/control01.ctl</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">/oracle/11g/flash_recovery_area/mys</span><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ql_master_1003306/control02.ctl</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="color: rgb(51, 51, 51);"><div><br/></div></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(54, 101, 238); font-size: 14.6667px;">##或者</span></div><div style="color: rgb(51, 51, 51);"><div><br/></div></div><div style="color: rgb(51, 51, 51);"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sys@MYSQL_MA&gt; show parameter control_file;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">NAME                                  TYPE       VALUE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">control_file_record_keep_time        integer     7</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">control_files                        string      /oracle/11g/oradata/mysql_mast</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                                 er_1003306/control01.ctl, /ora</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                                 cle/11g/flash_recovery_area/my</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                                 sql_master_1003306/control02.c</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">                                                 tl</span></div><div><br/></div></div></div><div><br/></div><div>RMAN没有开启自动备份控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; show all;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN configuration parameters for database with db_unique_name ORACLE are:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">CONFIGURE BACKUP OPTIMIZATION OFF; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div></div><div><br/></div><div>全备数据库</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; backup database plus archivelog delete all input;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting backup at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">current log archived</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting archived log backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: specifying archived log(s) in backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">input archived log thread=1 sequence=55 RECID=59 STAMP=976314177</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">input archived log thread=1 sequence=56 RECID=60 STAMP=976385529</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting piece 1 at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: finished piece 1 at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">piece handle=/oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_annnn_TAG20180517T181210_fhvzktll_.bkp tag=TAG20180517T181210 comment=NONE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: backup set complete, elapsed time: 00:00:03</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: deleting archived log(s)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log file name=/oracle/11g/flash_recovery_area/MYSQL_MA/archivelog/2018_05_16/o1_mf_1_55_fhssvy7r_.arc RECID=59 STAMP=976314177</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">...</span></div></div><div><br/></div><div>删除所有的控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 ~]$ rm /oracle/11g/oradata/mysql_master_1003306/control01.ctl /oracle/11g/flash_recovery_area/mysql_master_1003306/control02.ctl</span></div></div><div><br/></div><div>停库</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; shutdown immediate;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database closed.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-00210: cannot open the specified control file</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-00202: control file: '/oracle/11g/oradata/oracle/control01.ctl'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-27041: unable to open file</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Linux-x86_64 Error: 2: No such file or directory</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Additional information: 3</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; shutdown abort;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORACLE instance shut down.</span></div></div><div><br/></div><div>rman连接到目标库,如果报错<span style="color: rgb(227, 0, 0);">ORA-12528: TNS:listener: all appropriate instances are blocking new connections，</span>则需要配置静态注册，使用静态注册的服务名来连，因为此时数据库连接是blocked的</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle oracle]$ rman target sys/Oracle_1@ma1 catalog rman/Rman_1@rman</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Recovery Manager: Release 11.2.0.1.0 - Production on Thu May 17 18:38:29 2018</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">connected to target database (<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">not started</span>)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">connected to recovery catalog database</span></div></div><div><br/></div><div>恢复控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;"><font color="#3665EE">##将数据库启动到nomount状态</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; startup nomount;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Oracle instance started</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Total System Global Area     409194496 bytes</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Fixed Size                     2213856 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Variable Size                335546400 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database Buffers              67108864 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Redo Buffers                   4325376 bytes</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;"><font color="#3665EE">##查看含有控制文件的全备备份集</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; list backupset;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">List of Backup Sets</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">===================</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">BS Key  Type LV Size       Device Type Elapsed Time Completion Time</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">------- ---- -- ---------- ----------- ------------ ---------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">597     Full    13.05M     DISK        00:00:01     17-MAY-18     </span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">        BP Key: 600   Status: AVAILABLE  Compressed: NO  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">Tag: TAG20180517T182027</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">        Piece Name: /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">  SPFILE Included: Modification time: 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">  SPFILE db_unique_name: MYSQL_MA</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">Control File Included:</span> Ckp SCN: 1517178      Ckp time: 17-MAY-18</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;"><font style="color: rgb(54, 101, 238);">##使用该备份集恢复控制文件，自动选择最新备份集</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; restore controlfile;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting restore at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting datafile backup set restore</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restoring control file</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: reading from backup piece /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: piece handle=/oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp tag=TAG20180517T182027</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restored backup piece 1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restore complete, elapsed time: 00:00:01</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">output file name=/oracle/11g/oradata/mysql_master_1003306/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">output file name=/oracle/11g/flash_recovery_area/mysql_master_1003306/control02.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished restore at 17-MAY-18</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt; color: #3665ee;">##使用该备份集恢复控制文件，手动指定备份集</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; restore controlfile to '/oracle/11g/oradata/mysql_master_1003306/control01.ctl' from tag 'TAG20180517T182027';</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting restore at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">allocated channel: ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: SID=19 device type=DISK</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting datafile backup set restore</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restoring control file</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">output file name=/oracle/11g/oradata/mysql_master_1003306/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: reading from backup piece /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: piece handle=/oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp tag=TAG20180517T182027</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restored backup piece 1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restore complete, elapsed time: 00:00:01</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished restore at 17-MAY-18</span></div></div><div><br/></div><div>启动并恢复数据库</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; alter database mount;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">database mounted</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">released channel: ORA_DISK_1</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; recover database;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting recover at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting implicit crosscheck backup at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">allocated channel: ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: SID=19 device type=DISK</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Crosschecked 2 objects</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished implicit crosscheck backup at 17-MAY-18</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting implicit crosscheck copy at 17-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished implicit crosscheck copy at 17-MAY-18</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">searching for all files in the recovery area</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">cataloging files...</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">cataloging done</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">List of Cataloged Files</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">=======================</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">File Name: /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_ncsnf_TAG20180517T182027_fhw02hlh_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">File Name: /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_17/o1_mf_annnn_TAG20180517T182105_fhw02knm_.bkp</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting media recovery</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log for thread 1 with sequence 59 is already on disk as file /oracle/11g/oradata/mysql_master_1003306/redo02.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log for thread 1 with sequence 60 is already on disk as file /oracle/11g/oradata/mysql_master_1003306/redo03.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log file name=/oracle/11g/oradata/mysql_master_1003306/redo02.log thread=1 sequence=59</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">archived log file name=/oracle/11g/oradata/mysql_master_1003306/redo03.log thread=1 sequence=60</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">media recovery complete, elapsed time: 00:00:00</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished recover at 17-MAY-18</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; alter database open resetlogs;    ##恢复控制文件也需要resetlogs</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">database opened</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">new incarnation of database registered in recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting full resync of recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">full resync complete</span></div></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">情景四：啥都没有，重建控制文件</span></font></div><div><br/></div><div>删除所有的控制文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle ~]$ rm /oracle/11g/oradata/oracle/control01.ctl /oracle/11g/flash_recovery_area/oracle/control02.ctl</span></div></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">关闭数据库，</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">数据库无法正常关闭，因为在关闭的时候必须向控制文件中更新scn号，</span><span style="font-size: 14px; color: rgb(51, 51, 51);">此时需要使用abort关闭</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">SQL&gt; shutdown immediate;</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-00210: cannot open the specified control file</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-00202: control file: '/oracle/11g/oradata/oracle/control01.ctl'</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORA-27041: unable to open file</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">Linux-x86_64 Error: 2: No such file or directory</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">Additional information: 3</span></div><div><br/></div><div><br/></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">SQL&gt; shutdown abort;</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;">ORACLE instance shut down.</span></div></div><div><br/></div><div>重建控制文件</div><div>步骤1：获取数据库名及字符集</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; create pfile from spfile;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">File created.</span></div><div><br/></div><div><font color="#3665EE" face="DejaVu Sans Mono"><span style="font-size: 14.6667px;">##查看pfile</span></font></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle dbs]$ cat initorcl.ora | grep db_name</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">*.</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">db_name</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">='<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">oracle</span>'</span></div><div><br/></div><div><font color="#3665EE" face="DejaVu Sans Mono"><span style="font-size: 14.6667px;">##开启到nomount模式，查看字符集</span></font></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; start nomount;</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; select userenv('language') from dual;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">USERENV('LANGUAGE')</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">----------------------------------------------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">AMERICAN_AMERICA.<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">US7ASCII</span></span></div></div><div><br/></div><div>步骤2：获取数据文件路径及名称</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@oracle oracle]$ ll /oracle/11g/oradata/oracle/*.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall 1073750016 May 17 14:16 /oracle/11g/oradata/oracle/bigtbs.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall  650125312 May 17 14:16 /oracle/11g/oradata/oracle/sysaux01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall  744497152 May 17 14:16 /oracle/11g/oradata/oracle/system01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall  524296192 May 17 14:16 /oracle/11g/oradata/oracle/tbs01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall   20979712 May  8 03:16 /oracle/11g/oradata/oracle/temp001.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall   20979712 May  8 03:16 /oracle/11g/oradata/oracle/temp002.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall   35659776 May 16 22:02 /oracle/11g/oradata/oracle/temp01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall   41951232 May 17 14:16 /oracle/11g/oradata/oracle/undo01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall   78651392 May 17 14:16 /oracle/11g/oradata/oracle/undotbs01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall    5251072 May 17 14:16 /oracle/11g/oradata/oracle/users01.dbf</span></div></div><div><br/></div><div>步骤3：生成创建控制文件脚本，<span style="color: rgb(227, 0, 0);">注意去掉temp表空间</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">STARTUP NOMOUNT</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">CREATE</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONTROLFILE REUSE DATABASE</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">&quot;oracle&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">NORESETLOGS ARCHIVELOG</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">    MAXLOGFILES</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">5</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">    MAXLOGMEMBERS</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">3</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">    MAXDATAFILES</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">100</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">    MAXINSTANCES</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">    MAXLOGHISTORY</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">226</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">LOGFILE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">GROUP</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">1</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/redo01.log'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">SIZE</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">50M,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">GROUP</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">2</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/redo02.log'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">SIZE</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">50M,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">GROUP</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">3</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/redo03.log'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 11pt;">SIZE</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">50M</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">DATAFILE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/bigtbs.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/sysaux01.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/system01.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/tbs01.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/undo01.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/undotbs01.dbf'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">'/oracle/11g/oradata/oracle/users01.dbf'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CHARACTER</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">SET</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">US7ASCII</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">;</span></div></div><div><br/></div><div>步骤4：执行脚本</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; @/oracle/11g/product/11.2.0/dbhome_1/dbs/a.sql</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORACLE instance started.</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Total System Global Area  409194496 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Fixed Size          2213856 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Variable Size          331352096 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database Buffers        71303168 bytes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Redo Buffers             4325376 bytes</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 11pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Control file created.</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; select status from v$instance;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">STATUS</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">------------</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">MOUNTED</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">SQL&gt; alter database open;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database altered.</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 