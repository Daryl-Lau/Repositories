<html>
<head>
  <title>RMAN恢复数据文件和表空间</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="411"/>
<h1>RMAN恢复数据文件和表空间</h1>

<div>
<span><div>RMAN恢复数据文件和表空间</div><div><br/></div><div>当数据文件由于操作失误或者介质损坏而丢失或损坏的时候可以进行恢复</div><div>如果是介质损坏则需要先修复介质</div><div>system、undo表空间的数据文件损坏需要关闭数据库进行恢复</div><div><br/></div><div><br/></div><div>恢复数据文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" style="font-size: 11pt;">run {</font></div><div><font style="font-size: 11pt; color: rgb(50, 135, 18);">sql 'alter database datafile 5 offline';</font></div><div><font style="font-size: 11pt; color: rgb(50, 135, 18);">restore datafile 5;</font></div><div><font style="font-size: 11pt; color: rgb(50, 135, 18);">recover datafile 5;</font></div><div><font style="font-size: 11pt; color: rgb(50, 135, 18);">sql 'alter database datafile 5 online';</font></div><div><font color="#328712" style="font-size: 11pt;">}</font></div></div><div><br/></div><div>实验：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sys@MYSQL_MA&gt; select file_id,tablespace_name,file_name,online_status from dba_data_files;</span></div></div><div><img src="RMAN恢复数据文件和表空间_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>删除tbs01.dbf</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 ~]$ rm -rf /oracle/11g/oradata/mysql_master_1003306/tbs01.dbf</span></div></div><div><br/></div><div>使用rman恢复，前提是要先有备份</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; run {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql 'alter database datafile 5 offline';</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">restore datafile 5;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">recover datafile 5;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql 'alter database datafile 5 online';</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">}</span></div><div><br/></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql statement: alter database datafile 5 offline</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting restore at 21-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">allocated channel: ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: SID=41 device type=DISK</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting datafile backup set restore</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restoring datafile 00005 to /oracle/11g/oradata/mysql_master_1003306/tbs01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: reading from backup piece /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_21/o1_mf_nnndf_TAG20180521T113848_fj5t08z3_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: piece handle=/oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_21/o1_mf_nnndf_TAG20180521T113848_fj5t08z3_.bkp tag=TAG20180521T113848</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restored backup piece 1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restore complete, elapsed time: 00:00:03</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished restore at 21-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting recover at 21-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting media recovery</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">media recovery complete, elapsed time: 00:00:01</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished recover at 21-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql statement: alter database datafile 5 online</span></div></div><div><br/></div><div><br/></div><div>恢复表空间</div><div><br/></div><div>恢复表空间包括对该表空间所有数据文件的恢复</div><div><span style="color: rgb(227, 0, 0);">需要注意离线的数据文件，离线的数据文件在恢复表空间的时候是不会被恢复的，需要单独进行恢复</span></div><div>system或undo表空间丢失则数据库要关闭才能进行恢复</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">run {</font></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">sql 'alter tablespace <i>tablespace_name</i> offline immediate';</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">restore tablespace <i>tablespace_name</i>;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">recover tablespace <i>tablespace_name</i>;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">sql 'alter tablespace <i>tablespace_name</i> online';</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">}</font></div></div><div><br/></div><div>实验：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; run {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql 'alter tablespace tbs01 offline immediate';</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">restore tablespace tbs01;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">recover tablespace tbs01;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql 'alter tablespace tbs01 online';</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting full resync of recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">full resync complete</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql statement: alter tablespace tbs01 offline immediate</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting restore at 21-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting datafile backup set restore</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restoring datafile 00005 to /oracle/11g/oradata/mysql_master_1003306/tbs01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: reading from backup piece /oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_21/o1_mf_nnndf_TAG20180521T125815_fj5yo89p_.bkp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: piece handle=/oracle/11g/flash_recovery_area/MYSQL_MA/backupset/2018_05_21/o1_mf_nnndf_TAG20180521T125815_fj5yo89p_.bkp tag=TAG20180521T125815</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restored backup piece 1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: restore complete, elapsed time: 00:00:03</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished restore at 21-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting recover at 21-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting media recovery</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">media recovery complete, elapsed time: 00:00:01</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Finished recover at 21-MAY-18</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sql statement: alter tablespace tbs01 online</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">starting full resync of recovery catalog</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">full resync complete</span></div></div><div><br/></div><div>如果原介质不可用了，需要把数据文件恢复到不同的位置，可以使用set newname命令来指定新的目录</div><div><br/></div><div>针对数据文件使用</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">set newname for datafile 3 to 'PATH'</font></div></div><div><br/></div><div>针对表空间使用</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">set newname for tablespace <span style="font-style: italic;">tablespace_name </span>to 'PATH'</font></div></div><div><br/></div><div>目标文件名可使用变量</div><div>%b：不含目录的文件名</div><div>%f：文件编号</div><div>%I：DBID</div><div>%N：表空间名称</div><div>%U：系统自动生成文件名，data-%I_TS-%N_FNO-%f</div><div><br/></div><div>针对数据文件例如：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">run {</span></div><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">sql 'alter database datafile 5 offline';</span></div><div><span style="font-family: Monaco; font-size: 11pt;"><font color="#E30000">set newname for datafile 5 to '/oracle/11g/oradata/orcl/%U';</font></span></div><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">restore datafile 5;</span></div><div><span style="font-size: 14.6667px; font-family: Monaco;"><font color="#E30000">switch datafile all;</font></span></div><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">recover datafile 5;</span></div><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">sql 'alter database datafile 5 online';</span></div><div><span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: Monaco;">}</span></div></div><div><br/></div><div>针对表空间例如：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">run {</span></div><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">sql 'alter tablespace</span> <span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-style: italic;">tablespace_name </span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">offline immediate';</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;"><font color="#E30000">set newname for tablespace <span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; font-style: italic;">tablespace_name </span>to '<span style="font-family: Monaco; font-size: 11pt;">/oracle/11g/oradata/orcl/%U</span>';</font></span></div><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">restore tablespace </span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-style: italic;">tablespace_name</span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">;</span></div><div><font color="#E30000" style="font-family: &quot;DejaVu Sans Mono&quot;;"><span style="font-size: 14.6667px;">switch datafile all;</span></font></div><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">recover tablespace </span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-style: italic;">tablespace_name</span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">;</span></div><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">sql 'alter tablespace </span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-style: italic;">tablespace_name </span><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">online';</span></div><div><span style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">}</span></div></div><div><br/></div><div><br/></div><div>————————————————————————————————————————</div><div><br/></div><div>如果认为误操作导致删除了数据文件，又没有备份，短期可以进行恢复，因为删除只是删除了元数据，实际的数据短时间没有被覆盖，且oracle还持有文件句柄，就可以恢复</div><div><br/></div><div>例如：</div><div>删除数据文件TBS01</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 mysql_master_1003306]$ ls</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">control01.ctl  redo01.log  redo02.log  redo03.log  sysaux01.dbf  system01.dbf  TBS01  temp01.dbf  undotbs01.dbf  users01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 mysql_master_1003306]$ rm -rf TBS01</span></div></div><div><br/></div><div>恢复步骤</div><div>1）查看ora_dbw进程</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 mysql_master_1003306]$ ps -ef |grep ora_dbw</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">oracle     4388      1  0 13:30 ?        00:00:00</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">ora_dbw</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">0_orcl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">oracle     4604   3782  0 13:47 pts/2    00:00:00 grep --color=auto</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">ora_dbw</span></div></div><div><br/></div><div>进到fd里面，被删除的文件会被标记为delete，如下所示</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 fd]$ cd</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 ~]$ cd /proc/4388/fd</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 fd]$ ll</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">total 0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">0</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">l-wx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">1</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">l-wx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">10</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/diag/rdbms/mysql_ma/orcl/trace/orcl_ora_4323.trc</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">l-wx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">11</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/diag/rdbms/mysql_ma/orcl/trace/orcl_ora_4323.trm</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">12</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/rdbms/mesg/oraus.msb</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">13</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/zero</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">14</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(11, 133, 255); font-size: 11pt;">/proc/4388/fd</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">15</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/zero</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">16</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/dbs/hc_orcl.dat</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">17</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/dbs/lkMYSQL_MA</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">18</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/control01.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">19</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/flash_recovery_area/mysql_master_1003306/control02.ctl</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">l-wx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">2</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">20</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/system01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">21</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/sysaux01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">22</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/undotbs01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">23</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/users01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">26</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 192); font-size: 11pt;">socket:[42915]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">27</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/oradata/mysql_master_1003306/temp01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">28</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/rdbms/mesg/oraus.msb</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">29</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 11pt;"><font color="#E30000">/oracle/11g/oradata/mysql_master_1003306/TBS01 (deleted)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">l-wx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">3</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/rdbms/log/orcl_ora_4323.trc</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">4</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">5</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">6</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 11pt;">/dev/null</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">7</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt; /oracle/11g/product/11.2.0/dbhome_1/dbs/hc_orcl.dat</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lrwx------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 11pt;">8</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 192); font-size: 11pt;">/oracle/11g/product/11.2.0/dbhome_1/dbs/lkinstorcl (deleted)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">lr-x------. 1 oracle oinstall 64 May 21 13:41</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 11pt;">9</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(11, 133, 255); font-size: 11pt;">/proc/4388/fd</span></div></div><div><br/></div><div>将其拷贝到原有位置，就恢复了</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 fd]$ cp 29 /oracle/11g/oradata/mysql_master_1003306/TBS01</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">[oracle@mysql-master-1003306 fd]$ ls -l /oracle/11g/oradata/mysql_master_1003306/TBS01</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">-rw-r-----. 1 oracle oinstall 209723392 May 21 13:50 /oracle/11g/oradata/mysql_master_1003306/TBS01</span></div></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 