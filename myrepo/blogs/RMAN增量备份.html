<html>
<head>
  <title>RMAN增量备份</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="443"/>
<h1>RMAN增量备份</h1>

<div>
<span><div><div>RMAN增量备份</div><div><br/></div><div>增量备份至备份相对变化了的增量部分</div><div>以数据块为增量判断的最小单位</div><div>分为差异的增量备份和累积的增量备份</div><div>包括全部数据块的基础备份为0级增量备份</div><div>差异的增量备份以最近一次的0或1级备份为基础</div><div>累积的增量备份以最近一次的0级备份为基础</div><div><br/></div><div><span style="box-sizing: border-box; outline: 0px; font-size: 14px; color: rgb(102, 102, 102); line-height: 26px; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;">RMAN备份分为全备和增量备份两部分</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(102, 102, 102); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"><span style="box-sizing: border-box; outline: 0px; font-size: 14px; color: rgb(102, 102, 102); line-height: 26px; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial;">增量备份:分为0 1 2级</span></div><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(102, 102, 102); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"></p><div>ORACLE官方解释： </div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">A level 1 incremental backup can be either of the following types:</span></div><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(102, 102, 102); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"></p><div>Adifferential backup, which backs up all blocks changed after the most recentincremental backup at level 1 or 0</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">A cumulative backup, which backs up all blocks changed after the most recentincremental backup at level 0</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"><span style="box-sizing: border-box; outline: 0px; font-size: 14px; color: rgb(255, 0, 0); line-height: 26px; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial; font-weight: bold;">Incrementalbackups are differential by default. 默认是差异备份</span></div><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"></p><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);">在</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; background-color: rgb(255, 255, 51); color: rgb(255, 0, 0);">differential（差异）模式下</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);">（缺省）</span></div><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);">0=全备</span></div><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);">1=差异增量</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);"> </span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);"> 上次全备或LV1至今的增量（无论是否有，有N次LV2的备份，一律从上次lv1或0至今的变化）</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(255, 0, 0);">0/1 ~ NOW </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);-en-paragraph:true;">2=累积增量</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);-en-paragraph:true;"> </span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102);-en-paragraph:true;"> 上次任意级别备份至今的增量（任意一次备份至今）</span><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(255, 0, 0);-en-paragraph:true;">0/1/2 ~ NOW</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(255, 0, 0);-en-paragraph:true;"><img src="RMAN增量备份_files/Image.png" type="image/png" data-filename="Image.png" style="font-weight: bold; color: rgb(255, 0, 0);"/><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(255, 0, 0);-en-paragraph:true;"><br/></span></div><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; font-size: 14px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Arial;"></p><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; color: rgb(102, 102, 102);">在</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; background-color: rgb(255, 255, 102); color: rgb(255, 0, 0);">cumulative（累积的）</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; background-color: rgb(255, 255, 102); color: rgb(102, 102, 102);">模式下，</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102); font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold;">0=全备</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; color: rgb(102, 102, 102);">1=上次全备至今的增量（无论是否有，有N次LV1的备份，一律从全备至今的变化）</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; color: rgb(255, 0, 0);">0 ~ NOW</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102); font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold;">2=上次0或1级别备份至今的增量（2次LV2间的累积，也汇总备份至今）</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; color: rgb(255, 0, 0);">0/1~ NOW</span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold; color: rgb(255, 0, 0);"> </span><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(102, 102, 102); font-family: Arial; font-size: 14px; line-height: 26px; font-weight: bold;">（differential下的LV1）</span></div><div><img src="RMAN增量备份_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>进行0级备份，可以针对全库也可以针对部分表空间</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">backup incremental level=0 database;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">backup incremental level=0 tablespace users;</font></div></div><div><br/></div><div>执行增量备份</div><div>差异增量备份，默认方式</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">backup incremental level=1 database;</font></div></div><div><br/></div><div>累积增量备份</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">backup incremental level=1 cumulative database;</font></div></div><div><br/></div><div><br/></div><div><br/></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;, Verdana, Arial, Helvetica, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">RMAN增量备份读取整个数据库文件进行块级别检查时要花费大量时间，可以通过设置快改变跟踪文件，避免进行备份时全部对比块。</span><span style="font-family: &quot;microsoft yahei&quot;, Verdana, Arial, Helvetica, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="color: rgb(227, 0, 0);">建议配置这个。</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">alter database enable block change tracking using file '/oracle/11g/oradata/mysql_master_1003306/orcl.trc';</font></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">alter database disable block change tracking;  ##同时会删除orcl.trc文件</font></div></div><div><br/></div><div><br/></div><div><br/></div><div>恢复直接使用restore database，recover database即可</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 