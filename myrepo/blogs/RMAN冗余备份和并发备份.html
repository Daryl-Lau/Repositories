<html>
<head>
  <title>RMAN冗余备份和并发备份</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="526"/>
<h1>RMAN冗余备份和并发备份</h1>

<div>
<span><div>RMAN冗余备份和并发备份</div><div><br/></div><div>RMAN冗余备份（duplex backup）</div><div><br/></div><div><span style="color: rgb(227, 0, 0);">冗余备份不能放置在闪回区，需要自己定义其他的存放目录；</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN&gt; backup copies 2 tablespace users;     ##默认使用闪回区</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Starting backup at 15-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">using channel ORA_DISK_1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting full datafile backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: specifying datafile(s) in backup set</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">input datafile file number=00004 name=/oracle/11g/oradata/mysql_master_1003306/users01.dbf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">channel ORA_DISK_1: starting piece 1 at 15-MAY-18</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN-00571: ===========================================================</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN-00571: ===========================================================</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">RMAN-03009: failure of backup command on ORA_DISK_1 channel at 05/15/2018 21:09:51</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-19806: <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">cannot make duplex backups in recovery area</span></span></div></div><div><br/></div><div>方法1：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;           ##1改为2将会备两份</span></div><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;</span></div></div><div><br/></div><div>方法2：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">backup copies 2 tablespace users format '/oracle/11g/backup/orcl/backup01/%U','/oracle/11g/backup/orcl/backup02/%U';</span></div><div><br/></div><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">##如果只写一个format，那么两个文件都将放在那个路径下</span></div></div><div><br/></div><div>方法3：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">run {</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">set backup copies 2;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">backup device type disk format '/oracle/11g/backup/orcl/backup01/%U','/oracle/11g/backup/orcl/backup02/%U' tablespace users,tbs01;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">}</span></div></div><div><br/></div><div>RMAN并发备份</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">如果一个文件跟大，将需要并行化这一文件的备份，通常，一个通道只能读一个文件，但是用多段关键字可以改变这一行为：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">run {</font></div><div><font face="DejaVu Sans Mono" style="color: rgb(50, 135, 18); font-size: 12pt;">allocate channel c1 device type disk format <span style="min-height: 13pt; color: rgb(0, 128, 0);">'/oracle/11g/backup/orcl/backup01/%U'</span>;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">allocate channel c2 device type disk <span style="color: rgb(50, 135, 18);">format </span><span style="color: rgb(0, 128, 0); min-height: 13pt;">'/oracle/11g/backup/orcl/backup01/%U'</span><span style="color: rgb(50, 135, 18);">;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">allocate channel c3 device type disk <span style="color: rgb(50, 135, 18);">format </span><span style="color: rgb(0, 128, 0); min-height: 13pt;">'/oracle/11g/backup/orcl/backup01/%U'</span><span style="color: rgb(50, 135, 18);">;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">allocate channel c4 device type disk <span style="color: rgb(50, 135, 18);">format </span><span style="color: rgb(0, 128, 0); min-height: 13pt;">'/oracle/11g/backup/orcl/backup01/%U'</span><span style="color: rgb(50, 135, 18);">;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">backup datafile 1 section size 1m;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">}</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;"><br/></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 12pt;">##如果format指向不同的路径，那么文件将分布在其路径下，指向同一个路径，则都放在同一个路径下</font></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">这一脚本将启动4个通道，每个通道读取数据文件16的一段10GB的段。每个通道将生成包含段的备份的片（单独的物理文件）。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">如果文件为200GB, 将有20个这样的片，一次生成4个。没有section size 关键字，并行读将为1（也就是序列化），用一个通道执行整个操作。</span></div><div><br/></div></span>
</div></body></html> 