<html>
<head>
  <title>防火墙iptables和firewall-cmd</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="614"/>
<h1>防火墙iptables和firewall-cmd</h1>

<div>
<span><div>防火墙iptables和firewall-cmd</div><div><br/></div><div><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">防火墙是通过定义一些有序的规则，并管理进入到网络内的主机数据包的一种机制，更广义的来说，只要能分析与过滤进出我们管理的网络的数据包的数据，就可以称之为防火墙。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">防火墙最大的功能就是帮助你限制某些服务的访问来源。这就是为什么搭建服务器的时候有些服务启动不了的原因。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">防火墙并不能有效阻挡病毒或者密码程序，且防火墙对来自内部的攻击无能为力</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables 是一种软件防火墙，称为数据包过滤软件。iptables是一种低级工具，他仅能调整IPv4防火墙规则。为保证更完整的防火墙覆盖率，需要使用其他的实用程序，例如用于IPv6的ip6tables和用于软件桥的ebtables</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">数据包进入流程：规则顺序的重要性</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables 利用的是分析数据包的报头数据，根据报头数据与定义的规则来决定该数据包是否可以进入主机或者是被丢弃。也就是说，根据数据包的分析资料对比预先定义的规则内容，若数据包与规则内容相同则进行相关动作，否则进入下一条负责的比对。如果对比第一条就成功了，则不会比对后面的规则，所以规则的顺序非常重要。当规则顺序排列错误时，就会产生很严重的错误。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables的表格（table）与链（chain）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">(三表（filter、NAT、Mangle）五链（INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING）)</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables里面有多个表格，每个表格定义出自己的默认策略与规则，且每个表格的用途都不一样。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Filter（过滤器）：主要跟进入linux本机的数据包有关，是默认的table</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">    INPUT：主要与想进入本机的数据包有关</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">    OUTPUT：主要与linux本机想要送出的数据包有关</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">    FORWARD：与linux本机没有关系，它可以传递数据包到后端的计算机中，与NAT的table相关性较高</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">NAT（地址转换，Network Address Translation）：这个表格的作用是进行来源于目的地的IP或port转换，与linux本机无关，主要与linux主机后的局域网内的计算机有关</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">    PREROUTING：在进行路由判断之前所要进行的规则（DNAT/REDIRECT）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    POSTROUTING：在进行路由判断之后所要进行的规则（SNAT/MASOUERADE）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    OUTPUT：与发送出去的数据包有关</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Mangle （破坏者）：这个表格主要是与特殊的数据包的路由标志有关，这个表格与特殊标志相关性较高。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left;"><span style="font-size: 14pt; font-weight: bold;">查看iptables</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">表格定义下面的就是链（chain）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">由一条条规则组成。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">本机iptables的语法</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">iptables -t filter  -L  -n </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">查看规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">-t ：指定table，不使用-t选项，则是默认的filter表格</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">-L ：列出目前的table的规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">-n：不进行IP与hostname的反查，显示信息的速度会快很多</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -t filter -L -n   （-n 以IP形式输出）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Chain INPUT (policy ACCEPT)   &lt;=== 针对INPUT链，默认策略为可接受</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">target     prot   opt     source               destination</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">target：代表进行的操作，ACCEPT（放行），REJECT（拒绝），DROP（丢弃）,LOG（记录日志，继续匹配下一条规则）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">prot：代表使用的数据包协议，主要有TCP，UDP，ICMP3种</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">opt：额外的选项说明</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">source：代表此规则是针对哪个来源IP进行限制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">destination：代表此规则是针对哪个目标IP进行限制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">iptables-save列出完整的防火墙规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">输出没有格式化</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">[root@redhata ~]# iptables -nvL</span></div><div><span style="font-size: 11pt;">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span></div><div><span style="font-size: 11pt;">pkts bytes target     prot opt in     out     source               destination         </span></div><div><span style="font-size: 11pt;">  584 55744 ACCEPT   all   --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED</span></div><div><span style="font-size: 11pt;">    2   210 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           </span></div><div><span style="font-size: 11pt;">    1    60 ACCEPT       all    --  lo     *       0.0.0.0/0            0.0.0.0/0           </span></div><div><span style="font-size: 11pt;">    1    52 ACCEPT       tcp   --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp d</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px;"><span style="font-size: 14px; font-weight: bold; line-height: 1.75;">定义默认策略</span></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">iptables -t 【filter，nat】 -P【INPUT，OUTPUT，FORWARD】 【ACCEPT，DROP（这里不能使用REJECT）】</span></div><div><span style="font-size: 11pt;">这里修改的是 Chain INPUT (policy ACCEPT) 括号里面的默认策略</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">[root@nisa ~]# iptables -t filter -P INPUT DROP</span></div><div><span style="font-size: 11pt;">[root@nisa ~]# iptables -L  </span></div><div><span style="font-size: 11pt;">Chain INPUT (policy DROP)  &lt;===设置成了DROP</span></div><div><span style="font-size: 11pt;">target     prot    opt      source                destination     </span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px;"><span style="font-size: 14px; font-weight: bold; line-height: 1.75;">自定义链</span></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">添加一个新的链</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">iptables -N RHCE</span></div><div><span style="font-size: 11pt;">iptables -A RHCE -s 172.25.254.122  -j  ACCEPT</span></div><div><span style="font-size: 11pt;">iptables -A ACCEPT -j RHCE</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">清空自定义链</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">iptables -F  RHCE</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><div><br/></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px;"><span style="font-size: 14px; font-weight: bold; line-height: 1.75;">DNAT转换</span></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">INBOUND</span></div><div><span style="font-size: 11pt;">iptables -t nat -A PREROUTING -p  tcp -d 172.16.1.1  --dport 80  -j DNAT --to-dest  192.128.1.1:8080</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">OUTBOUND</span></div><div><span style="font-size: 11pt;">iptables -t  nat  -A OUTPUT -p tcp --deport 80 -j DNAT --to-dest  192.128.2.1:3128</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><div><br/></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">SNAT</span></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">地址伪装</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">iptables -t nat -A POSTROUTING -j SNAT  --to-source 1.2.3.45</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><div><br/></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); font-weight: bold; line-height: 1.75;">自定义规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 动作</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">-t&lt;表&gt;：指定要操纵的表；包括：</span></div><div><span style="font-size: 11pt;">       filter包过滤，用于防火墙规则，默认</span></div><div><span style="font-size: 11pt;">       nat地址转换，用于网关路由器</span></div><div><span style="font-size: 11pt;">       mangle数据包修改（QOS），用于实现服务质量</span></div><div><span style="font-size: 11pt;">规则链名：</span></div><div><span style="font-size: 11pt;">       INPUT：处理输入数据包</span></div><div><span style="font-size: 11pt;">       OUTPUT：处理输出数据包</span></div><div><span style="font-size: 11pt;">       FORWARD：处理转发数据包</span></div><div><span style="font-size: 11pt;">       PREROUTING：用于目标地址转换（DNAT）</span></div><div><span style="font-size: 11pt;">       POSTROUTING：用于源地址转换（SNAT）</span></div><div><span style="font-size: 11pt;">-A：向规则链中添加条目；</span></div><div><span style="font-size: 11pt;">-D：从规则链中删除条目；</span></div><div><span style="font-size: 11pt;">-I：向规则链中插入条目；</span></div><div><span style="font-size: 11pt;">-R：替换规则链中的条目；</span></div><div><span style="font-size: 11pt;">-L：显示规则链中已有的条目；</span></div><div><span style="font-size: 11pt;">-F：清楚规则链中已有的条目；</span></div><div><span style="font-size: 11pt;">-Z：清空规则链中的数据包计算器和字节计数器；</span></div><div><span style="font-size: 11pt;">-N：创建新的用户自定义规则链；</span></div><div><span style="font-size: 11pt;">-P：定义规则链中的默认目标；</span></div><div><span style="font-size: 11pt;">-h：显示帮助信息；</span></div><div><span style="font-size: 11pt;">-p：指定要匹配的数据包协议类型；</span></div><div><span style="font-size: 11pt;">-s：指定要匹配的数据包源ip地址；</span></div><div><span style="font-size: 11pt;">-j&lt;目标&gt;：指定要跳转的目标；包括：</span></div><div><span style="font-size: 11pt;">       accept接收</span></div><div><span style="font-size: 11pt;">       drop丢弃</span></div><div><span style="font-size: 11pt;">       redirect重定向、映射、透明代理</span></div><div><span style="font-size: 11pt;">       snat源地址转换</span></div><div><span style="font-size: 11pt;">       dnat目标地址转换</span></div><div><span style="font-size: 11pt;">       masquerade IP地址伪装</span></div><div><span style="font-size: 11pt;">       log日志记录</span></div><div><span style="font-size: 11pt;">-i&lt;网络接口&gt;：指定数据包进入本机的网络接口；</span></div><div><span style="font-size: 11pt;">-o&lt;网络接口&gt;：指定数据包要离开本机所使用的网络接口。</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left;"><div style="font-size: 14px;"><b>清除已有iptables规则</b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -F</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -X</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -Z</font></div></div><div style="font-size: 14px; margin-top: 0px; margin-bottom: 25px;"></div><div style="font-size: 14px;"><b>开放指定的端口</b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT #允许本地回环接口(即运行本机访问本机)</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT #允许已建立的或相关连的通行</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A OUTPUT -j ACCEPT #允许所有本机向外的访问</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -p tcp --dport 22 -j ACCEPT #允许访问22端口</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -p tcp --dport 80 -j ACCEPT #允许访问80端口</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -p tcp --dport 21 -j ACCEPT #允许ftp服务的21端口</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -p tcp --dport 20 -j ACCEPT #允许FTP服务的20端口</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A INPUT -j reject #禁止其他未允许的规则访问</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -A FORWARD -j REJECT #禁止其他未允许的规则访问</font></div></div><div style="font-size: 14px;"><br/></div><div style="font-size: 14px;"><b>屏蔽IP</b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono">iptables -I INPUT -s 123.45.6.7 -j DROP #屏蔽单个IP的命令</font></div><div><font color="#328712" face="DejaVu Sans Mono">iptables -I INPUT -s 123.0.0.0/8 -j DROP #封整个段即从123.0.0.1到123.255.255.254的命令</font></div><div><font color="#328712" face="DejaVu Sans Mono">iptables -I INPUT -s 124.45.0.0/16 -j DROP #封IP段即从123.45.0.1到123.45.255.254的命令</font></div><div><font color="#328712" face="DejaVu Sans Mono">iptables -I INPUT -s 123.45.6.0/24 -j DROP #封IP段即从123.45.6.1到123.45.6.254的命令是</font></div></div><div style="font-size: 14px;"><br/></div><div style="font-size: 14px;"><b>查看已添加的iptables规则</b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# iptables -nvL</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">pkts bytes target     prot opt in     out     source               destination        </span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">33355   16M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0          </span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1285 77555 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0          </span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  811 47992 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">pkts bytes target     prot opt in     out     source               destination        </span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Chain OUTPUT (policy ACCEPT 35021 packets, 16M bytes)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">pkts bytes target     prot opt in     out     source               destination        </span></div></div><div style="font-size: 14px;"><br/></div><div style="font-size: 14px;"><br/></div><div style="font-size: 14px;"><b>删除已添加的iptables规则</b></div><div style="font-size: 14px;">将所有iptables以序号标记显示，执行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -L -n --line-numbers</font></div></div><div style="font-size: 14px; margin-top: 0px; margin-bottom: 25px;"></div><div style="font-size: 14px;">比如要删除INPUT里序号为8的规则，执行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 9pt;">iptables -D INPUT 8</font></div></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">举个例子</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# iptables -A INPUT -i eth0 -p tcp -s 192.168.0.13 -d 192.168.0.11 -j ACCEPT</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -i eth0 -p tcp -s 192.168.0.0/24 --sport 1024:65535 --dport ssh -j REJECT</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">除了端口之外，tcp数据包还有特殊的标志，最常见的就是主动链接的SYN标志，在iptables里面还支持“--syn”的处理方式</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">例如，将来自任何地方来源port 1到1023端口主动链接到本地端的1到1023端口的链接丢弃</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -i eth0  -p tcp --sport 1:1023 --dport 1:1023 --syn -j DROP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables的外挂模块：state和mac</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">iptables -A INPUT 【-m state】【--state 状态】</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">-m：一些外挂模块，主要常见的有state（状态模块），mac（网卡硬件地址）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">--state：一些数据包的状态，主要有：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">               INVALID：无效的数据包，例如破损的数据包状态</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">               ESTABLISHED：已经建立成功的状态</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">               NEW：想要新建立连接的数据包状态</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">               RELATED：这个最常用，表示这个数据包是与主机发送出去的数据包有关</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">将已经建立或已发出的请求的相关数据包放行</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">将无效的数据包丢弃</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -m state --state INVALID -j DROP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">另外，iptables还可以针对网卡来进行放行与防御</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -m mac --mac-source aa:bb:cc:dd:ee:ff -j REJECT</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">--mac-source：就是来源主机的mac</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# iptables -A INPUT -p tcp -m mutiport --dport 1,2,3,4,5 -j REJECT</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">mutiport指定多个端口</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Firewall防火墙工具</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">redhat7.0中引入了一种新的与netfilter交互的方法：firewall。该守护进程不仅涵盖了IPv4，IPv6，还能ebtables设置。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">预定义区域，如下图片所示：</span></div><div style="text-align: left;"><img src="file:///C:/Users/Jerry/AppData/Local/YNote/data/liuyi930714@163.com/f117bca64f0f46be93c6f00a08936492/81ed0f974f18b7f035ce81d698df2758.jpg" style="width: 503px;"></img></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">redhat7.0中，可以通过三种方式与netfilter交互：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">1、直接编辑/etc/firewall/中的配置文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">2、使用firewall-config图形工具</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">3、firewall-cmd命令行配置</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">！！！使用firewall-config进行图形化配置时，左上方Configuration是Runtime时，防火墙配置将不会写入配置文件，重启后规则将失效，若想生成永久配置，需要将其勾选成Permanent，配置完成后，需要立即生效的话，需要在Options中进行Reload Firewalld操作。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">使用firewall-cmd命令配置防火墙</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">查看默认区域</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --get-default-zone </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">public</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">设置默认的区域</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd  --set-defaults-zone=dmz（默认的区域是public）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">来自192.168.0.0/24网络的所有流量都被分配给internal区域，而且internal区域上打开了mysql的网络接口</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --zone=internal --add-source=192.168.0.0/24</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --zone=internal --add-service=mysql</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --reload （重新加载，立即生效）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# firewall-cmd --list-all</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  public (default, active)</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  interfaces: eno16777736    &lt;===接口名</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  sources:                        &lt;===源地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  services: dhcpv6-client nfs ssh     &lt;===预定义的各种服务</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  ports:                     &lt;===端口和协议      </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  masquerade: no   &lt;===地址伪装，私有的网络地址可以被映射到公开的ip地址，这是一次正规的地址转换</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  forward-ports:      &lt;===地址转发，端口可以映射到另一个端口以及/或者其他主机</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  icmp-blocks:         &lt;===icmp阻塞</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">  rich rules:              &lt;===自定义规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">查看接口所属的区域</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --get-zone-of-interface=eno16777736 </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">public</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加源地址到internal区域</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --zone=internal --add-source=192.168.0.0/24</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加mysql服务</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --zone=internal --add-service=mysql</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加8080/tcp端口</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --add-port=8080/tcp；firewall-cmd --reload</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加端口转发</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">firewall-cmd --permanent --add-forward-ports=【port=xx】：【proto=tcp/udp】：【toport=xx】：【toaddr=ip</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">address】</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">将22端口的tcp转发到192.168.0.1的32端口</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">--add-forward-port=port=22:proto=tcp:toport=32:toaddr=192.168.0.1</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加地址伪装</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --add-masquerade </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">success</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加icmp阻塞</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --add-icmp-block=【有以下一些icmp报文类别】</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">destination-unreachable  parameter-problem        router-solicitation</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">echo-reply               redirect                 source-quench</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">echo-request             router-advertisement     time-exceeded</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">添加rich rules</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@nisa" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(0, 56, 132); line-height: 1.75; text-decoration: underline;">root@nisa</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# firewall-cmd --permanent --add-rich-rule='rule family=&quot;ipv4&quot; source address=&quot;192.168.0.1&quot; destination address=&quot;192.168.0.2&quot; service name=&quot;ssh&quot; log prefix=&quot;ssh&quot; level=&quot;warning&quot; limit value=&quot;1/m&quot; reject'</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">在 --add-rich-rule= 后面的全部内容要用单引号或双引号全部括起来，各个小项的值也需要用双引号括起来</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">rule family：IP家族，可以使ipv4或ipv6</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">source address：源IP地址，也可以是网段</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">destination address：目标IP地址，也可以是网段</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">service name：服务名</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">log prefix：日志名</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">level：日志级别</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">limit value：日志写入限制，上述定义的是1分钟1次（value后面没有s）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">reject：操作，也可以是accept，drop</span></div><div style="white-space: pre-wrap; font-size: 14px;"><br/></div><div><br/></div></span>
</div></body></html> 