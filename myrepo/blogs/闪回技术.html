<html>
<head>
  <title>闪回技术</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="423"/>
<h1>闪回技术</h1>

<div>
<span><div><div><div>闪回技术</div><div><br/></div><div>闪回机制</div><div>首先必须开启归档模式和闪回恢复区</div><div>打开闪回数据库功能会由RVWR进程在闪回区记录闪回日志</div><div>通过v$database可以查询是否开启了数据库闪回功能</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select flashback_on from v$database;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">FLASHBACK_ON</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">NO</font></span></div></div><div><br/></div><div>开启闪回功能</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">shutdown immediate;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">startup mount;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">alter database flashback on;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><font style="font-size: 11pt;"><font color="#008000">alter system set db_flashback_retention_target=2880;     ##可以闪回到多少</font><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font color="#E30000">分钟</font></span><font color="#008000">以前的状态</font></font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">alter database open;</font></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; shutdown immediate;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database closed.</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database dismounted.</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">ORACLE instance shut down.</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; startup mount;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">ORACLE instance started.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Total System Global Area  409194496 bytes</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Fixed Size          2213856 bytes</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Variable Size          360712224 bytes</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database Buffers        41943040 bytes</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Redo Buffers             4325376 bytes</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database mounted.</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; alter database flashback on;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database altered.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; alter system set db_flashback_retention_target=2880;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">System altered.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; alter database open;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Database altered.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select flashback_on from v$database;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">FLASHBACK_ON</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">YES</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; show parameter <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);">db_flashback_retention_target</span>;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">NAME                      TYPE   VALUE</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">------------------------------------ ----------- ------------------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">db_flashback_retention_target        integer     2880</font></span></div><div><br/></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">[oracle@mysql-master-1003306 mysql_master_1003306]$ ps -ef | grep rvwr</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);">oracle    11369      1  0 17:14 ?        00:00:00 ora_</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0);">rvwr</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);">_orcl</span></font></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">[oracle@mysql-master-1003306 flashback]$ ls -l /oracle/11g/flash_recovery_area/MYSQL_MA/flashback/o1_mf_fj921crk_.flb</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">-rw-r-----. 1 oracle oinstall 8200192 May 22 17:20 /oracle/11g/flash_recovery_area/MYSQL_MA/flashback/<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">o1_mf_fj921crk_.flb</span></font></span></div></div><div>该文件记录闪回日志</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">oracle提供了几种可使用的闪回技术，分别是闪回查询，闪回删除，闪回数据归档，闪回数据库，闪回版本查询，闪回事务查询。</span></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 12pt;">闪回查询</font></span></div><div>1）闪回基本查询</div><div>可以查询过去某个时间段的数据库状态， Oracle 会提取所需要的撤销数据（前提是撤销是可用的，即撤销数据还没被覆盖）进行回滚，但这种回滚是临时的，仅针对当前session可见。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">select * from scott.t1 as of timestamp to_timestamp('2018-05-22 19:00:00','yyyy-mm-dd hh24:mi:ss');</font></span></div><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">select * from scott.t1 as of scn 10000;</font></span></div></div><div><br/></div><div>查询scn</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><font color="#3665EE" style="font-size: 11pt;">##查询当前scn号</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select current_scn from v$database;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">CURRENT_SCN</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">-----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  1624016</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><font color="#3665EE" style="font-size: 11pt;">##查询可以闪回的最老的scn号</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select * from v$flashback_database_log;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">OLDEST_FLASHBACK_SCN OLDEST_FL RETENTION_TARGET FLASHBACK_SIZE ESTIMATED_FLASHBACK_SIZE</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">-------------------- --------- ---------------- -------------- ------------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">             1619546 22-MAY-18             2880       12288000                160579584</font></span></div></div><div><br/></div><div>实验：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; !date</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Tue May 22 19:28:16 EDT 2018</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select current_scn from v$database;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">CURRENT_SCN</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">-----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  1624016</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    30</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; insert into scott.t1 select * from dba_data_files;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">5 rows created.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; /</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">5 rows created.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; /</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">5 rows created.</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; commit;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Commit complete.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    45</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1 as of timestamp to_timestamp('2018-05-22 19:28:16','yyyy-mm-dd hh24:mi:ss');</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    30</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select current_scn from v$database;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">CURRENT_SCN</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">-----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  1624191</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1 as of scn 1624016;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    30</font></span></div></div><div><br/></div><div><br/></div><div>2）闪回表</div><div>可以将表回退到过去某个时间点， Oracle会先去查询撤销段，提取过去某个时间点之后的所有变更，构造反转这些变更的SQL语句进行回退,闪回操作是一个单独的事务，所以若由于撤销数据过期之类的原因导致无法闪回，整个操作会回滚，不会存在不一致的状态。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">flashback table scott.t1 to timestamp to_timestamp('2018-05-22 19:28:16','yyyy-mm-dd hh24:mi:ss');</font></span></div><div><span style="min-height: 13pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">flashback table scott.t1 to scn 1624016;</font></span></div></div><div><br/></div><div>启用表闪回首先要在表上支持行移动（在数据字典中设置标识来标识该操作可能会改变行ID，即同一条数据闪回成功后主键都一样，但行ID其实已经发生变化了）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; alter table scott.t1 enable row movement;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Table altered.</font></span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; flashback table scott.t1 to timestamp to_timestamp('2018-05-22 19:28:16','yyyy-mm-dd hh24:mi:ss');</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Flashback complete.</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    30</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; flashback table scott.t1 to scn 1624016;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Flashback complete.</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; select count(*) from scott.t1;</font></span></div><div><br style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">    30</font></span></div></div><div><br/></div><div>闪回表可能会失败，有可能有以下几种情况：</div><div>   违反了数据库约束，比如用户不小心删除了子表中的数据，现在想利用闪回表技术进行回退，恰好在这中间，父表中与该数据对应的那条记录也被删除了，在这种情况下，由于违反了外键约束，导致闪回表操作失败了；</div><div>   撤销数据失效，比如用于支撑闪回操作的撤销数据被覆盖了，这种情况闪回表操作自然会失败；</div><div>   闪回不能跨越DDL，即在闪回点和当前点之间，表结构有过变更，这种情况闪回操作也会失败。</div><div><br/></div><div><span style="font-style: italic;">注意：上述闪回功能都是基于撤销数据的，而撤销数据是会被重写的（Expired会被重写，Active不会被重写），所以，在需要使用这几种闪回功能去恢复数据的时候（确切地说，是需要使用基于撤销数据的闪回功能时），最短时间发现错误，第一时间执行闪回操作，才能最大程度地保证闪回功能的成功。</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 12pt;">闪回drop</font></span></div><div><span style="-en-paragraph:true;">回收站：实现闪回删除功能，需要使用</span><span style="-en-paragraph:true;">Oracle</span><span style="-en-paragraph:true;">回收站（</span><span style="-en-paragraph:true;">recycle bin</span><span style="-en-paragraph:true;">），回收站是所有被删除对象及其相依对象的逻辑存储容器，例如当一张表被删除（</span><span style="-en-paragraph:true;">drop</span><span style="-en-paragraph:true;">）时，该表及其相依对象并不会马上被数据彻底删除，而是被存放到回收站中。</span></div><div><span style="-en-paragraph:true;">机制：回收站将用户执行的</span><span style="-en-paragraph:true;">drop</span><span style="-en-paragraph:true;">操作记录在一个系统表中，也就是</span><span style="-en-paragraph:true;">被删除的对象写到一个数据字典</span><span style="-en-paragraph:true;">中，如果确定不再需要该对象，可以使用</span><span style="-en-paragraph:true;">purge</span><span style="-en-paragraph:true;">命令对回收站进行清空。</span></div><div><span style="-en-paragraph:true;">回收站中的对象会进行重命名，格式如下：</span></div><div><span style="-en-paragraph:true;">BIN$globalUID$version</span></div><div><span style="-en-paragraph:true;">BIN:</span><span style="-en-paragraph:true;">表示</span><span style="-en-paragraph:true;">becyclebin</span></div><div><span style="-en-paragraph:true;">globalUID</span><span style="-en-paragraph:true;">：全局唯一的，二十四字符长的标识对象，该</span><span style="-en-paragraph:true;">标识</span><span style="-en-paragraph:true;">于原对象没有任何关系</span></div><div><span style="-en-paragraph:true;">$version</span><span style="-en-paragraph:true;">：数据库分配的版本号</span></div><div><br/></div><div><span style="-en-paragraph:true;">回收站的管理：</span></div><div><span style="-en-paragraph:true;">回收站是否启用</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">show parameter recyclebin;</font></div></div><div><br/></div><div><span style="-en-paragraph:true;">回收站的信息的查看</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">show recyclebin;</span><span style="-en-paragraph:true;">（查看不到删除的表的索引）</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-size: 11pt;"><span style="-en-paragraph:true;">select * from user_recyclebin;</span><span style="-en-paragraph:true;">（可以查看到删除的表的索引）</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">select * from dba_recyclebin;</span><span style="-en-paragraph:true;">（可以查看到删除的表的索引）</span></font></div></div><div><br/></div><div><span style="-en-paragraph:true;">清除回收站的对象</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">purge table</span> <span style="-en-paragraph:true;">表名字</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">purge table tablespace</span> <span style="-en-paragraph:true;">表空间名</span><span style="-en-paragraph:true;">;</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">purge table tablespace</span> <span style="-en-paragraph:true;">表空间名</span> <span style="-en-paragraph:true;">user</span> <span style="-en-paragraph:true;">用户名</span><span style="-en-paragraph:true;">;</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">purge index</span> <span style="-en-paragraph:true;">索引名字</span><span style="-en-paragraph:true;">;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="-en-paragraph:true;">purge recyclebin;</span><span style="-en-paragraph:true;">全部清空</span></font></div></div><div><br/></div><div><span style="-en-paragraph:true;">使用闪回删除的前提条件：</span></div><div><span style="-en-paragraph:true;">必须是</span><span style="-en-paragraph:true;">DDL</span><span style="-en-paragraph:true;">语言</span></div><div><span style="-en-paragraph:true;">不能是</span><span style="-en-paragraph:true;">sys</span><span style="-en-paragraph:true;">或是</span><span style="-en-paragraph:true;">dba</span><span style="-en-paragraph:true;">权限的用户，否则查不出记录</span></div><div><br/></div><div>例子：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">sys@MYSQL_MA&gt; conn scott/scott</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Connected.</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">scott@MYSQL_MA&gt; select count(*) from t1;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">  COUNT(*)</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">     5</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">scott@MYSQL_MA&gt; drop table t1;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">Table dropped.</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">scott@MYSQL_MA&gt; show recyclebin;</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">ORIGINAL NAME    RECYCLEBIN NAME           OBJECT TYPE  DROP TIME</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">---------------- ------------------------------ ------------ -------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">T1          BIN$bNYRDdAKDffgUAoKZAowIw==$0 TABLE     2018-05-22:21:00:53</font></span></div><div><br/></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">scott@MYSQL_MA&gt; select * from user_recyclebin;</font></span></div><div><br style="font-family: Monaco; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">OBJECT_NAME                 ORIGINAL_NAME            OPERATION                  TYPE                 TS_NAME</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">------------------------------ -------------------------------- ------------------------------ ------------------------- ------------------------------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">CREATETIME     DROPTIME            DROPSCN PARTITION_NAME           CAN CAN    RELATED BASE_OBJECT PURGE_OBJECT      SPACE</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">------------------- ------------------- ---------- -------------------------------- --- --- ---------- ----------- ------------ ----------</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">BIN$bNYRDdAKDffgUAoKZAowIw==$0 T1                    DROP                   TABLE                USERS</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);"><font style="font-size: 11pt;">2018-05-22:20:28:42 2018-05-22:21:00:53    1626327                        YES YES      74120          74120   74120     8</font></span></div></div><div><br/></div><div>闪回drop</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18); font-size: 11pt;">flashback table t1 to before drop;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">flashback table t1 to before drop rename to t2;</font></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);"><font style="font-size: 11pt;">flashback table &quot;BIN$bNYRDdAMDffgUAoKZAowIw==$0&quot; to before drop;</font></span></div><div><font style="font-size: 11pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">flashback table &quot;BIN$bNYRDdAMDffgUAoKZAowIw==$0&quot; to before drop rename to t2;   </span><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><font color="#E30000">##必须使用双引号</font></span></font></div></div><div><br/></div><div><span style="font-style: italic;">注意：闪回删除只针对Drop命令，注意区分truncate操作和drop操作，truncate称为表截断，会清空表中数据（调节Oracle高水位线实现），表结构不受影响，速度很快，弊端是此过程不会产生任何撤销数据或是重做日志，如果误删，恢复异常麻烦，要慎重使用。而Drop则会删除数据+表结构，闪回删除仅针对Drop操作。</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">闪回数据归档</span></div><div>闪回数据归档可使表具有回退到过去任何时间点的能力，前面提到的闪回查询，闪回表都会受限于撤销数据是否失效，如果撤销数据被覆盖重写了，闪回操作自然会失败，闪回删除则受限于表空间是否有足够可用空间，而闪回数据归档，则没有这些限制。</div><div>实质上就是对undo数据进行归档从而支持更大时间范围内的闪回查询和闪回表等功能，该功能是oracle 11g的新功能，建议在单独的表空间上创建flashback archive，可以单独指定针对哪些表开启flashback archive功能</div><div><br/></div><div>为scott.t1表创建闪回归档</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">create tablespace flbtbs datafile '/oracle/11g/oradata/flbtbs01.dbf' size 500M autoextend on;</font></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">create flashback archive default flbarch tablespace flbtbs quota 300M retention 1 year;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">alter flashback archive flbarch set default;</font></div><div><br/></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">grant flashback archive on flbarch to scott;  ##或者直接赋闪回归档管理员权限 grant flashback archive administer to scott; </font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">conn scott/scott</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">alter table t1 flashback archive flbarch;  ##不指定flbarch的话，将使用上面配置的默认flashback archive，我这里默认也是flbarch，所以也可以使用alter table t1 flashback archive;</font></div></div><div><br/></div><div>闪回数据归档管理</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">alter flashback archive flbarch add tablespace flbtbs02 quota <span style="color: #328712; font-size: 11pt; font-family: DejaVu Sans Mono;">500M</span>;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">alter flashback archive flbarch modify retention 2 year;</font></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);">alter flashback archive flbarch purge before timestamp (systimestamp - interval '1' day); ##删除一天前的历史数据</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">drop flashback archive flbarch;</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><br/></font></div><div><font color="#328712" face="DejaVu Sans Mono"><span style="font-size: 14.6667px;">alter table t1 no flashback archive;</span></font></div></div><div><br/></div><div>闪回归档信息查询</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">*</span> <span style="min-height: 10pt;">from</span> <span style="min-height: 10pt;">dba_flashback_archive</span><span style="min-height: 10pt;">;</span></font></div><div><font style="font-size: 11pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(50, 135, 18);"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">*</span> <span style="min-height: 10pt;">from</span> <span style="min-height: 10pt;">dba_flashback_archive_ts;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">*</span> <span style="min-height: 10pt;">from</span> <span style="min-height: 10pt;">dba_flashback_archive_tables;</span></font></div><div><br/></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">*</span> <span style="min-height: 10pt;">from</span> <span style="min-height: 10pt;">user_flashback_archive</span><span style="min-height: 10pt;">;</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">*</span> <span style="min-height: 10pt;">from</span> <span style="min-height: 10pt;">user_flashback_archive_tables;</span></font></div></div><div><br/></div><div>对于开启了闪回归档的表，不能执行如下操作，否则会有ora-55610的报错：</div><div>1）drop table</div><div>2）alter table move or exchange a partition or subpartition</div><div>3）alter table upgrade</div><div><br/></div><div>如果一定要执行这些操作，可以通过dbms_flashback_archive.diassociate_fba暂时中止和flashback archive的联系，等操作完毕后再重新恢复，或者直接停止flashback archive</div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">scott@MYSQL_MA&gt; drop table t1;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">drop table t1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">           *</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ERROR at line 1:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">ORA-55610: Invalid DDL statement on history-tracked table</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;"><br/></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">scott@MYSQL_MA&gt; alter table t1 no flashback archive;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Table altered.</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">scott@MYSQL_MA&gt; drop table t1;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Table dropped.</span></div></div><br/></div><div> <br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">闪回数据库</span></div><div>关于闪回数据库</div><div>闪回操作要在mount状态下执行</div><div>闪回完毕后可以以read only模式开启，或者resetlogs方式打开，这样可以执行DML操作</div><div>flashback 和recover二者方向正好相反</div><div>如下情况无法进行flashback database：</div><ul><li><div>重建或者恢复了控制文件</div></li><li><div>表空间被删除</div></li><li><div>数据文件进行了收缩</div></li></ul><div><br/></div><div><span style="-en-paragraph:true;">就是将数据库回退到过去的一个时间点或</span><span style="-en-paragraph:true;">SCN</span><span style="-en-paragraph:true;">上，从而实现数据库的恢复，这种恢复时不需要通过备份。</span></div><div>步骤：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">shutdown immediate</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">startup mount exclusive</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">flashback database to timestamp(to_date(‘2009-12-39 05:52:45’, ’yyyy-mm-dd hh24:mi:ss’));</font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">alter database open resetlogs;</font></div></div><div><br/></div><div><span style="-en-paragraph:true;">常用</span><span style="-en-paragraph:true;">sql</span><span style="-en-paragraph:true;">：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">Alter session set nls_data_format=’yyyy-mm-dd hh24:mi:ss’—设置当前会话时间格式</font></div><div><span style="background-color: transparent;"><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;">Select oldest_flashback_scn,oldest_flashback_time from V$flashback_database_log;</font></span></div></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">闪回版本查询</span></div><div><span style="-en-paragraph:true;">闪回版本查询，提供了一个审计数据行改变的查询功能，通过它可以查到所有已经提交了的行记录。（注意，只包括被提交的记录，还是存放在</span><span style="-en-paragraph:true;">undo</span><span style="-en-paragraph:true;">表空间中）</span></div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 217px;"></col><col style="width: 795px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><div><span style="-en-paragraph:true;">VERSIONS_STARTSCN</span></div></td><td rowspan="2" style="border: 1px solid rgb(204, 204, 204); width: 795px; padding: 8px;"><div>该条记录操作时的SCN或时间，如果为空，表示该行记录是在查询范围外创建的</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><div>VERSIONS_STARTTIME</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><span style="-en-paragraph:true;">VERSIONS_ENDSCN</span></td><td rowspan="2" style="border: 1px solid rgb(204, 204, 204); width: 795px; padding: 8px;"><div>该条记录失效时的SCN或时间，如果为空，说明记录当前时间在当前表内不存在，或者已经被删除了，可以配合着VERSIONS_OPERATION列来看，如果VERSIONS_OPERATION列值为D，说明该列已被删除，如果该列为空，则说明记录在这段时间无操作</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><div>VERSIONS_ENDTIME</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><div>VERSIONS_XID</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 795px; padding: 8px;"><div>该操作的事务ID</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 217px; padding: 8px;"><div>VERSIONS_OPERATION</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 795px; padding: 8px;"><div><span style="-en-paragraph:true;">对该行执行的操作：</span><span style="-en-paragraph:true;">I</span><span style="-en-paragraph:true;">表示</span><span style="-en-paragraph:true;">INSERT</span><span style="-en-paragraph:true;">，</span><span style="-en-paragraph:true;">D</span><span style="-en-paragraph:true;">表示</span><span style="-en-paragraph:true;">DELETE</span><span style="-en-paragraph:true;">，</span><span style="-en-paragraph:true;">U</span><span style="-en-paragraph:true;">表示</span><span style="-en-paragraph:true;">UPDATE</span></div><div>提示：对于索引键的update操作，版本查询可能会将其识别成两个操作：DELETE和INSERT</div></td></tr></tbody></table><div><br/></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">select</span> <span style="min-height: 10pt;">versions_starttime</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">versions_endtime</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">versions_startscn</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">versions_endscn</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">versions_xid</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">versions_operation</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">id</span></font> <span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: &quot;DejaVu Sans Mono&quot;; min-height: 10pt;">from</span> <span style="font-size: 11pt; color: rgb(50, 135, 18); font-family: &quot;DejaVu Sans Mono&quot;; min-height: 10pt;">scott.t1</span></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">versions</span> <span style="min-height: 10pt;">between</span> <span style="min-height: 10pt;">timestamp</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">to_timestamp</span><span style="min-height: 10pt;">(</span><span style="min-height: 10pt;">'2018-05-23 11:43:33'</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">'yyyy-mm-dd hh24:mi:ss'</span><span style="min-height: 10pt;">)</span> <span style="min-height: 10pt;">and</span> <span style="min-height: 10pt;">to_timestamp</span><span style="min-height: 10pt;">(</span><span style="min-height: 10pt;">'2018-05-23 11:45:33'</span><span style="min-height: 10pt;">,</span><span style="min-height: 10pt;">'yyyy-mm-dd hh24:mi:ss'</span><span style="min-height: 10pt;">)</span></font></div><div><font color="#328712" face="DejaVu Sans Mono" style="font-size: 11pt;"><span style="min-height: 10pt;">order</span> <span style="min-height: 10pt;">by</span> <span style="min-height: 10pt;">versions_starttime</span><span style="min-height: 10pt;">;</span></font></div></div><div><img src="闪回技术_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">闪回事务查询</span></div><div><span style="-en-paragraph:true;">闪回事务查询实际上是闪回版本查询的一个扩充，通过它可以审计某个事务甚至撤消一个已经提交的事务。</span></div><div><span style="-en-paragraph:true;">主要视图：</span><span style="-en-paragraph:true;">flashback_transaction_query</span><span style="-en-paragraph:true;">，从该视图可以获取事务的历史操作记录以及撤消语句（</span><span style="-en-paragraph:true;">undo_sql</span><span style="-en-paragraph:true;">），如果要撤消此操作可以使用此</span><span style="-en-paragraph:true;">sql</span></div><div><span style="-en-paragraph:true;">思路：</span></div><div><span style="-en-paragraph:true;">1）先用版本查询的方法得到</span><span style="-en-paragraph:true;">versions_xid</span><span style="-en-paragraph:true;">即事务</span><span style="-en-paragraph:true;">id</span><span style="-en-paragraph:true;">的值</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">select</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_starttime</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_endtime</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_startscn</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_endscn</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_xid</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_operation</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">id</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">from</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">scott.t1</span></div><div><span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">versions</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">between</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">timestamp</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">to_timestamp</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">(</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 255); font-size: 9pt;">'2018-05-23 12:26:00'</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 255); font-size: 9pt;">'yyyy-mm-dd hh24:mi:ss'</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">)</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">and</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">to_timestamp</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">(</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 255); font-size: 9pt;">'2018-05-23 12:58:00'</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">,</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 255); font-size: 9pt;">'yyyy-mm-dd hh24:mi:ss'</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">)</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">order</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">by</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">versions_starttime</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">;</span></div></div><div><img src="闪回技术_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="-en-paragraph:true;">2）获取事务对应的undo_sql</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="-en-paragraph:true;"><span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">select</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">*</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">from</span> <span style="min-height: 10pt; font-family: ����; font-size: 9pt; color: rgb(51, 51, 51);">flashback_transaction_query</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">where</span> <span style="min-height: 10pt; font-family: ����; color: rgb(0, 128, 128); font-size: 9pt;">XID</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">=</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 255); font-size: 9pt;">'0600130036040000'</span><span style="min-height: 10pt; font-family: ����; color: rgb(0, 0, 128); font-size: 9pt;">;</span></span></div></div><div><img src="闪回技术_files/Image [2].png" type="image/png" data-filename="Image.png"/></div></div><div><br/></div><div>3）运行undo_sql进行撤消操作</div><div><br/></div><div><br/></div><div><br/></div><div><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">很多时候在首次使用flashback_transaction_query 执行闪回事务查询是，列operation全是unknown 而且undo_sql 也为空，</span></div><div>SQL&gt; select operation,undo_sql from flashback_transaction_query</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">  2  where xid=hextoraw('09000E0065060000');</span></div><div>OPERATION            UNDO_SQL</div><div>-------------------- ----------------------------------------------------------------------</div><div>UNKNOWN</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">BEGIN</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">出现这种情况的原因可能有如下两种</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">一：因为撤销表空间有限，因此flashback_transaction_query视图中只包含一部分事务，对于任何所选事务不再显示在撤销表空间的DML，operation列的值是unknown。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">二：使用闪回查询前，必须先启用重做日志流的其他日志记录。重做日志流数据时撤销表空间记录的信息的补充，闪回事务查询时既需要增强的重做信息，也需要撤销表空间的撤销信息。</span></div><blockquote style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 24px; font-size: 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; text-align: justify; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; color: rgb(79, 79, 79); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">首先，使用alter database命令，启用对DML更改引用的列值和主键值的日志记录：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sys@MYSQL_MA&gt; alter database add supplemental log data;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database altered.</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">sys@MYSQL_MA&gt; alter database add supplemental log data (primary key) columns;</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 11pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 11pt;">Database altered.</span></div></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; text-align: justify; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; font-size: 18px; word-break: break-all; color: rgb(255, 0, 0); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">注意，只有对alter database命令之后的DML操作在flashback_transaction_query中列operation和undo_sql才会有相应的值</span></div></blockquote><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 