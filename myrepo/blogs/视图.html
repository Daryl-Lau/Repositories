<html>
<head>
  <title>视图</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="580"/>
<h1>视图</h1>

<div>
<span><div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; line-height: 1.75; font-weight: bold;">视图</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75; font-weight: bold;">什么是视图</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">视图（View）是一种虚拟存在的表。其内容与真实的表相似，包含一系列带有名称的列和行数据。但是视图并不在数据库中以存储的数据的形式存在。行和列的数据来自定义视图时查询所引用的基本表，并且在具体引用视图时动态生成。</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">视图的特点如下：</span></div><ul><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">视图的列可以来自不同的表，是表的抽象和在逻辑意义上建立的新关系；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">视图是由基本表（实表）产生的表（虚表）；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">视图的建立和删除不影响基本表；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">对视图内容的更新（增删改）直接影响基本表；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">当视图来自多个基本表时，不允许添加和删除数据。</span></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.33333; font-weight: bold;">为什么使用视图</span></div><div style="white-space: pre-wrap; text-align: justify; text-indent: 28px; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.625;">数据库中关于数据的查询有时候非常复杂，例如表连接、子查询等，逻辑复杂，编写语句比较多。当这种查询需要重复使用时，则不会次次都能编写正确，从而降低了数据库的实用性。</span></div><div style="white-space: pre-wrap; text-align: justify; text-indent: 28px; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.625;">在具体操作表前，有时候要求只能操作部分字段，而不是全部字段。例如，在公司中员工的工资一般是保密的，如果因为程序员一时疏勿而向查询中多写入了“工资”的字段，则会让员工的“工资”显示给所有能够查看该查询结果的人，这时就需要限制程序员操作的字段。</span></div><div style="white-space: pre-wrap; text-align: justify; text-indent: 28px; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.625;">视图是程序员只关心感兴趣的某些特定数据和他们所负责的特定任务。这样程序员只能看到视图中所 定义的数据，而不是视图所引用表中的数据，从而提高了数据库的安全性。</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">视图相对于普通的表的有时主要包括以下几项：</span></div><ul><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;"> 简单：使用视图的用户完全不需要关心视图中的数据是通过什么查询得到的，视图中的数据对用户来说已经是过滤好的符合条件的结果集；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">安全：使用视图的用户只能访问他们被允许查询的结果集，对表的权限管理并不能限制到某个行或某个列，但是通过视图就可以简答地实现；</span></li><li style="list-style-type: disc; list-style-position: inside; white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="font-size: 14px; line-height: 1.625;">数据独立：一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，原表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响。</span></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.28571; font-weight: bold;">视图操作</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">视图的操作包括创建视图、查看视图、删除视图和修改视图。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.33333;">创建视图：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">CREATE [OR REPLACE ]VIEW view_name AS select_statement;</span></div></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.33333;">删除视图：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">DROP VIEW [IF EXISTS] view_name [,…,view_name_n]…[RESTRICT|CASCADE];</span></div></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.33333;">查看视图：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">SHOW CREATE VIEW view_name;</span></div></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;">SHOW TABLES; 语句会同时把基表和视图查出来，如果只想查出基表，可以使用下面的语句：</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">SELECT * FROM information_schema.`TABLES` WHERE table_type='BASE TABLE'；</span></div></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.33333;">修改视图：</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.33333;">先删除视图，再重新创建；</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75; font-weight: bold;">视图的限制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">&lt;1&gt; 不能在视图上创建索引；</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">&lt;2&gt; 在视图的FROM子句中不能使用子查询；</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">&lt;3&gt; 以下情形中的视图是不可更新的（更新是指对基表中的数据进行更新，并不是指基表中数据修改后，视图中的数据不进行更新或是不能对视图的定义进行修改）：</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span style="text-indent: 28px;"><span>    </span>[1]包含以下关键字的SQL语句：聚合函数(SUM、MIN、MAX、COUNT等)、DISTINCT、GROUP BY、HAVING、UNION或UNION ALL；</span></div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span>    </span>[2]常量视图；</div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span>    </span>[3]SELECT中包含子查询；</div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span>    </span>[4]JOIN；</div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span>    </span>[5]FROM一个不能更新的视图；</div><div style="white-space: pre-wrap; text-align: justify; font-size: 14px;"><span>    </span>[6]WHERE子句的子查询引用了FROM子句中的表。</div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.33333; font-weight: bold;">WITH CHECK OPTION </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">如果在创建视图的时候制定了“WITH CHECK OPTION”，那么更新数据时不能插入或更新不符合视图限制条件的记录。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(223, 64, 42);">注意点： </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(223, 64, 42);">1. 视图不是表，不直接存储数据，是一张虚拟的表； </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(223, 64, 42);">2. 一般情况下，在创建有条件限制的视图时，加上“WITH CHECK OPTION”命令。</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><br/></div><div><br/></div></div></span>
</div></body></html> 