<html>
<head>
  <title>生成式（列表生成式、集合生成式、字典生成式）、生成器</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="712"/>
<h1>生成式（列表生成式、集合生成式、字典生成式）、生成器</h1>

<div>
<span><div><span style="font-size: 12pt; font-weight: bold;">生成式（列表生成式、集合生成式、字典生成式）、生成器</span></div><div><br/></div><div><span style="font-size: 11pt; font-weight: bold;">列表生成式</span></div><div>凡是可以通过for-in循环创建的列表，都可以使用列表生成式来创建</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L = [x **2 for x in range(1, 7)]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[1, 4, 9, 16, 25, 36]</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#2D4FC9">##可以在列表生成式的for-in循环后面添加if语句</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L = [x **2 for x in range(1, 7) if x % 2 == 0]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[4, 16, 36]</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#2D4FC9">##可以在列表生成式中使用双重循环</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L = [(i, j) for i in range(1, 4) for j in range(1, 3)]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[(1, 1), (1, 2), (2, 1), (2, 2), (3, 1), (3, 2)]</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#2D4FC9">##同样，可以在双重循环后添加if语句</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L = [(i, j) for i in range(1, 4) for j in range(1, 3) if i != j]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[(1, 2), (2, 1), (3, 1), (3, 2)]</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#2D4FC9">##嵌套的列表生成式</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; L = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; l1 = [[j[i]  for j in L] for i in range(3)]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; l1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[[1, 4, 7], [2, 5, 8], [3, 6, 9]]</span></div></div><div><br/></div><div><span style="font-size: 11pt; font-weight: bold;">集合生成式</span></div><div>和列表生成式类似，通过for-in循环来创建集合生成式</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s = {x **2 for x in range(1, 7)}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{1, 4, 36, 9, 16, 25}           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000">##集合是没有顺序的</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s = {x **2 for x in range(1, 7) if x % 2 == 0}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{16, 4, 36}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s = {(i, j) for i in range(1, 4) for j in range(1, 3)}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{(1, 2), (3, 2), (3, 1), (2, 1), (2, 2), (1, 1)}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s = {[i, j] for i in range(1, 4) for j in range(1, 3)}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Traceback (most recent call last):</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;setcomp&gt;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">TypeError: unhashable type: 'list'         </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000">##集合的元素必须是能hash的</font></span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s = {(i, j) for i in range(1, 4) for j in range(1, 3) if i != j}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; s</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{(1, 2), (3, 2), (3, 1), (2, 1)}</span></div></div><div><br/></div><div><span style="font-size: 11pt; font-weight: bold;">字典生成式</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; keys = ['a', 'b', 'c']</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; values = [1, 2, 3]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d = {key:value for key in keys for value in values}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d = {key.upper():value for key in keys for value in values}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{'A': 3, 'B': 3, 'C': 3}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d = {key.upper():value for key, value in zip(keys, values)}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{'A': 1, 'B': 2, 'C': 3}</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d = {key.upper():value</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">...     for key, value in zip(keys, values)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">...     if value &gt; 2}</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; d</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{'C': 3}</span></div></div><div><br/></div><div><span style="font-size: 14.6667px;"><span style="font-size: 14.6667px;background-color: rgb(255, 250, 165);-evernote-highlight:true;">没有元组生成式</span></span></div><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;">生成器</span></div><div><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的。而且，创建一个包含100万个元素的列表，不仅占用很大的存储空间，如果我们仅仅需要访问前面几个元素，那后面绝大多数元素占用的空间都白白浪费了。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">所以，如果列表元素可以按照某种算法推算出来，那我们是否可以在循环的过程中不断推算出后续的元素呢？这样就不必创建完整的list，从而节省大量的空间。在Python中，这种一边循环一边计算的机制，称为生成器：generator。</span></div><div><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">要创建一个generator，有很多种方法。第一种方法很简单，只要把一个列表生成式的</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(250, 250, 250); line-height: 1.75;">[]</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">改成</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(250, 250, 250); line-height: 1.75;">()</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">，就创建了一个generator：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; g = (x * x for x in range(10))</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; type(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&lt;class 'generator'&gt;</span></div></div><div><br/></div><div>可以通过next()函数来获取生成器的值，当生成器的值被调用完了后，会停止迭代，而不会重头开始重新迭代</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; g</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&lt;generator object &lt;genexpr&gt; at 0x7fa073c008b8&gt;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">4</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">9</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">16</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">25</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">36</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">49</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">64</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">81</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">&gt;&gt;&gt; next(g)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Traceback (most recent call last):</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">StopIteration</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 