<html>
<head>
  <title>MHA高可用架构原理及搭建</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="540"/>
<h1>MHA高可用架构原理及搭建</h1>

<div>
<span><div>MHA高可用架构原理及搭建</div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">简介：</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">MHA（Master High Availability）目前在MySQL高可用方面是一个相对成熟的解决方案，它由日本DeNA公司youshimaton（现就职于Facebook公司）开发，是一套优秀的作为MySQL高可用性环境下故障切换和主从提升的高可用软件。在MySQL故障切换过程中，MHA能做到在0~30秒之内自动完成数据库的故障切换操作，并且在进行故障切换的过程中，MHA能在最大程度上保证数据的一致性，以达到真正意义上的高可用。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">该软件由两部分组成：MHA Manager（管理节点）和MHA Node（数据节点）</span><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">。MHA Manager可以单独部署在一台独立的机器上管理多个master-slave集群，也可以部署在一台slave节点上。MHA Node运行在每台MySQL服务器上，MHA Manager会定时探测集群中的master节点，当master出现故障时，它可以自动将最新数据的slave提升为新的master，然后将所有其他的slave重新指向新的master。整个故障转移过程对应用程序完全透明。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">在MHA自动故障切换过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过ssh访问，MHA没法保存二进制日志，只进行故障转移而丢失了最新的数据。使用MySQL 5.5的半同步复制，可以大大降低数据丢失的风险。MHA可以与半同步复制结合起来。如果只有一个slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的slave服务器上，因此可以保证所有节点的数据一致性。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">目前MHA主要支持一主多从的架构，</span><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">要搭建MHA,要求一个复制集群中必须最少有三台数据库服务器，</span><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">一主二从，即一台充当master，一台充当备用master，另外一台充当从库，因为至少需要三台服务器，出于机器成本的考虑，淘宝也在该基础上进行了改造，目前淘宝TMHA已经支持一主一从。另外对于想快速搭建的可以参考：</span><a href="http://www.cnblogs.com/gomysql/p/6547797.html" style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 105, 214); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; text-decoration: underline;">MHA快速搭建</a></div><div><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">我们自己使用其实也可以使用1主1从，但是master主机宕机后无法切换，以及无法补全binlog。master的mysqld进程crash后，还是可以切换成功，以及补全binlog的。</span></div><div><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><img src="MHA高可用架构原理及搭建_files/Image.png" type="image/png" data-filename="Image.png" style="font-family: Helvetica Neue;"/></div><div><br/></div><div>MHA工作原理总结</div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（1）从宕机崩溃的master保存二进制日志事件（binlog events）;</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（2）识别含有最新更新的slave；</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（3）应用差异的中继日志（relay log）到其他的slave；</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（4）应用从master保存的二进制日志事件（binlog events）；</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（5）提升一个slave为新的master；</span></div><div><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（6）使其他的slave连接新的master进行复制；</span></div><div><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div>Manager工具:</div><div><ol><li><span style="font-size: 10pt;">masterha_check_ssh : 检查MHA的SSH配置；<br/></span></li><li><span style="font-size: 10pt;">masterha_check_repl : 检查MySQL复制；<br/></span></li><li><span style="font-size: 10pt;">masterha_manager : 启动MHA；<br/></span></li><li>masterha_stop：停止MHA；</li><li><span style="font-size: 10pt;">masterha_check_status : 检测当前MHA运行状态；<br/></span></li><li><span style="font-size: 10pt;">masterha_master_monitor : 监测master是否宕机；<br/></span></li><li><span style="font-size: 10pt;">masterha_master_switch : 控制故障转移(自动或手动)；<br/></span></li><li><span style="font-size: 10pt;">masterha_conf_host : 添加或删除配置的server信息；</span></li><li>masterha_secondary_check：检查备节点；</li></ol></div><div><br/></div><div>Node工具：</div><div><ol><li><span style="font-size: 10pt;">save_binary_logs : 保存和复制master的二进制日志。<br/></span></li><li><span style="font-size: 10pt;">apply_diff_relay_logs : 识别差异的中继日志事件并应用于其它slave。<br/></span></li><li><span style="font-size: 10pt;">filter_mysqlbinlog : 去除不必要的ROLLBACK事件(MHA已不再使用这个工具)。<br/></span></li><li><span style="font-size: 10pt;">purge_relay_logs : 清除中继日志(不会阻塞SQL线程)。</span><br/></li></ol></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><span style="font-weight: bold; font-size: 14pt; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;">一、部署MHA</span><span style="font-weight: bold; font-size: 14pt; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;">环境介绍</span></font></div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 185px;"></col><col style="width: 130px;"></col><col style="width: 86px;"></col><col style="width: 130px;"></col></colgroup><tbody><tr><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>mysql角色</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 185px;"><div>主机名</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>IP地址</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 86px;"><div>MHA角色</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>说明</div></td></tr><tr><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>master</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 185px;"><div>mysql-master-1003306</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>10.10.10.100</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 86px;"><div>node</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>主库</div></td></tr><tr><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>slave1</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 185px;"><div>mysql-slave-1013306</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>10.10.10.101</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 86px;"><div>node</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>从库，当主库宕机时，自动切换到这台从库</div></td></tr><tr><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>slave2</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 185px;"><div>mysql-slave-1023306</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>10.10.10.102</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 86px;"><div>node、manager</div></td><td style="padding: 8px; border: 1px solid rgb(204, 204, 204); width: 130px;"><div>从库，只读，不作为master切换节点，由于资源有限，将manager同时安装在slave2上</div></td></tr></tbody></table><div><span style="font-weight: bold; font-size: 14pt;">二、基础环境配置</span></div><div>三台机器修改/etc/hosts</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master slave1 slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# cat /etc/hosts</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">10.10.10.100 mysql-master-1003306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">10.10.10.101 mysql-slave-1013306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">10.10.10.102 mysql-slave-1023306</span></div></div><div><br/></div><div>三台机器互相建立ssh互信，下面仅举一个例子，其他的按照下面方法逐个添加；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa</span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Generating public/private rsa key pair.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Your identification has been saved in /root/.ssh/id_rsa.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Your public key has been saved in /root/.ssh/id_rsa.pub.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">The key fingerprint is:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">d0:ba:b2:62:09:6e:a1:4b:8a:c9:30:2c:e8:ef:d9:78 root@mysql-master-1003306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">The key's randomart image is:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--[ RSA 2048]----+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|                 |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|       .         |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|      . .        |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|       o         |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|      . S        |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|+.     .         |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|B+... .          |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|X=+ +E           |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|*=o*o.           |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-----------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.10.10.101</span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">root@10.10.10.101's password:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Number of key(s) added: 1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Now try logging into the machine, with:   &quot;ssh 'root@10.10.10.101'&quot;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">and check to make sure that only the key(s) you wanted were added.</span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000"><br/></font></span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000">#注意使用ssh IP 和 ssh HOSTNAME 进行验证！</font></span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000"><br/></font></span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000">##由于后面我们会把node和manager同时安装在slave2上，所以slave2上需要自己和自己互信，否则后面mha的ssh检测脚本会失败</font></span></div></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">三、搭建一主两从架构（基于GTID模式）</span></font></div><div>master配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[mysqld]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">server-id=1003306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">##binlog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">log-bin=mysql-bin</span><br/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">sync-binlog=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">innodb_support_xa=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">binlog_format=row</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##GTID</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">gtid_mode=on</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">log_slave_updates=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">enforce_gtid_consistency=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##realylog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">relay-log=mysql-relay-bin</span><br/></span></div><div style="font-family: Monaco;"><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><span style="font-family: &quot;DejaVu Sans Mono&quot;;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;;"><span style="font-size: 9pt;"><font color="#008000">relay_log_purge=0             </font> <font color="#E30000">  ##</font></span> <font style="font-size: 9pt;"><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font color="#E30000">禁止 SQ</font></span><span style="color: rgb(255, 0, 0); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">L 线程在执行完一个 relay log 后自动将其删除，</span><span style="color: rgb(255, 0, 0); box-sizing: border-box; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(245, 248, 253);">对于</span><span style="color: rgb(255, 0, 0); box-sizing: border-box; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(245, 248, 253);">MHA</span><span style="color: rgb(255, 0, 0); box-sizing: border-box; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(245, 248, 253);">场景下，对于某些滞后从库的恢复依赖于其他从库的</span><span style="color: rgb(255, 0, 0); box-sizing: border-box; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(245, 248, 253);">relaylog</span><span style="color: rgb(255, 0, 0); box-sizing: border-box; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(245, 248, 253);">，因此采取禁用自动删除功能</span></font></span></span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br/></span></span></div></div><div>后面会介绍如何通过mha清理relay log；</div><div><br/></div><div>slave1配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">[mysqld]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">server-id=1013306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##binlog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">log-bin=mysql-bin</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">sync-binlog=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">innodb_support_xa=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">binlog_format=row</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##GTID</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">gtid_mode=on</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">log_slave_updates=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">enforce_gtid_consistency=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##relaylog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">relay-log=mysql-relay-bin</span><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">relay_log_purge=0</span></span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br/></span></span></div></div><div><br/></div><div>slave2配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"># slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">[mysqld]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">server-id=1023306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">##binlog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">log-bin=mysql-bin</span><br/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">sync-binlog=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">innodb_support_xa=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">binlog_format=row</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##GTID</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">gtid_mode=on</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">log_slave_updates=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">enforce_gtid_consistency=1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##relaylog</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">relay-log=mysql-relay-bin</span><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">relay_log_purge=0</span></span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br/></span></span></div></div><div><span style="font-size: 9pt;"><span style="font-size: 9pt; color: rgb(227, 0, 0); font-family: &quot;DejaVu Sans Mono&quot;;">从库不要在配置文件中开启read-only，因为从库随时可能切换成主库，可以使用动态设置set global read_only=1</span></span></div><div><br/></div><div>主库同步数据到两台从库</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"># master</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-master-1003306 ~]# mysqldump -uroot -p --single-transaction -A</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;;font-size: 9pt;color: rgb(0, 128, 0);background-color: rgb(255, 250, 165);-evernote-highlight:true;">--master-data=2</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">&gt; all.sql</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Enter password:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">##这里加不加</span><span style="font-family: &quot;DejaVu Sans Mono&quot;;font-size: 9pt;color: rgb(0, 128, 0);background-color: rgb(255, 250, 165);-evernote-highlight:true;">--master-data=2</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">都行，因为复制已经不再是基于position号的形式了。</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-master-1003306 ~]# scp all.sql 10.10.10.101:/root               </span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(50, 135, 18); min-height: 10pt;">#将备份文件拷贝到从库</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-master-1003306 ~]# scp all.sql 10.10.10.102:/root</span></div></div><div><br/></div><div>从库恢复数据</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"># slave1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-slave-1013306 ~]# mysql -uroot -p &lt; all.sql</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Enter password:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"><br/></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"># slave2</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# mysql -uroot -p &lt; all.sql</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Enter password:</span></div></div><div><br/></div><div>开启复制</div><div>在master和slave1上创建复制账号，因为slave1随时会变成master，需要创建复制账号；slave2后面控制其不会成为master，所以不需要创建复制账号，当然，创建也可以；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'mharepl'@'10.10.10.%' IDENTIFIED BY 'echo123.';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; flush privileges;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'mharepl'@'10.10.10.%' IDENTIFIED BY 'echo123.';</span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">mysql&gt; flush privileges;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Query OK, 0 rows affected (0.00 sec)</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div></div><div><br/></div><div>在slave上开启复制</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; CHANGE MASTER TO MASTER_HOST='10.10.10.100',MASTER_USER='mharepl',MASTER_PASSWORD='echo123.',MASTER_PORT=3306,MASTER_AUTO_POSITION=1;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected, 2 warnings (0.03 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; start slave;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.06 sec)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave2</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; CHANGE MASTER TO MASTER_HOST='10.10.10.100',MASTER_USER='mharepl',MASTER_PASSWORD='echo123.',MASTER_PORT=3306,MASTER_AUTO_POSITION=1;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected, 2 warnings (0.03 sec)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; start slave;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.02 sec)</span></div></div></div></div><div><br/></div><div>查看主从状态</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show slave status\G;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*************************** 1. row ***************************</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Slave_IO_State: Waiting for master to send event</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Host: 10.10.10.100</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_User: mharepl</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Port: 3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Connect_Retry: 60</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_Log_File: mysql-bin.000011</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Read_Master_Log_Pos: 2805</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Relay_Log_File: mysql-relay-bin.000002</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Relay_Log_Pos: 2978</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Relay_Master_Log_File: mysql-bin.000011</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Slave_IO_Running: Yes</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Slave_SQL_Running: Yes</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Replicate_Do_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Replicate_Ignore_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Replicate_Do_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       Replicate_Ignore_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Replicate_Wild_Do_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Wild_Ignore_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Skip_Counter: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Exec_Master_Log_Pos: 2805</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Relay_Log_Space: 3225</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Until_Condition: None</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Until_Log_File:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Until_Log_Pos: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Allowed: No</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_File:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_Path:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_SSL_Cert:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Master_SSL_Cipher:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Key:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Seconds_Behind_Master: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Master_SSL_Verify_Server_Cert: No</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Ignore_Server_Ids:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Server_Id: 1003306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_UUID: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Info_File: /data/mysql/master.info</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                    SQL_Delay: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          SQL_Remaining_Delay: NULL</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_Retry_Count: 86400</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Bind:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Last_IO_Error_Timestamp:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">     Last_SQL_Error_Timestamp:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Crl:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Crlpath:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Retrieved_Gtid_Set: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd:29-36</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Executed_Gtid_Set: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd:1-36</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Auto_Position: 1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">         Replicate_Rewrite_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Channel_Name:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_TLS_Version:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show slave status\G;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*************************** 1. row ***************************</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Slave_IO_State: Waiting for master to send event</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Host: 10.10.10.100</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_User: mharepl</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Port: 3306</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Connect_Retry: 60</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_Log_File: mysql-bin.000011</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Read_Master_Log_Pos: 2805</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Relay_Log_File: mysql-relay-bin.000002</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Relay_Log_Pos: 2978</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Relay_Master_Log_File: mysql-bin.000011</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Slave_IO_Running: Yes</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Slave_SQL_Running: Yes</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Replicate_Do_DB:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Replicate_Ignore_DB:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Replicate_Do_Table:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       Replicate_Ignore_Table:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Replicate_Wild_Do_Table:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Wild_Ignore_Table:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Errno: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Error:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Skip_Counter: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Exec_Master_Log_Pos: 2805</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Relay_Log_Space: 3185</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Until_Condition: None</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Until_Log_File:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Until_Log_Pos: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Allowed: No</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_File:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_Path:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_SSL_Cert:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Master_SSL_Cipher:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Key:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Seconds_Behind_Master: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Master_SSL_Verify_Server_Cert: No</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Errno: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Error:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Errno: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Error:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Ignore_Server_Ids:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Server_Id: 1003306</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_UUID: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Info_File: /data/mysql/master.info</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                    SQL_Delay: 0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          SQL_Remaining_Delay: NULL</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_Retry_Count: 86400</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Bind:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Last_IO_Error_Timestamp:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">     Last_SQL_Error_Timestamp:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Crl:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Crlpath:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Retrieved_Gtid_Set: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd:29-36</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Executed_Gtid_Set: 91daaeb1-3eab-11e8-bbc1-000c29ffc6cd:1-36</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Auto_Position: 1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">         Replicate_Rewrite_DB:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Channel_Name:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_TLS_Version:</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div></div></div><div><br/></div><div>验证：</div><div>主库创建一张表并插入一行数据</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; use test;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Database changed</span></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; create table t (id int);</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.04 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; insert into t values (1);</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 1 row affected (0.01 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; select * from t;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| id   |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|    1 |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.01 sec)</span></div></div><div><br/></div><div>从库检查数据</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; use test;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Database changed</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; select * from t;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| id   |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|    1 |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; use test;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Database changed</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; select * from t;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| id   |</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">|    1 |</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+------+</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div></div><div><br/></div><div>将两台从数据库设置为只读<span style="font-size: 9pt; color: rgb(227, 0, 0); font-family: &quot;DejaVu Sans Mono&quot;;">set global read_only=1</span><span style="font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;;">，不要在配置文件里面开启；</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; set global read_only=1;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.00 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">#slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; set global read_only=1;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.00 sec)</span></div></div></div><div><br/></div><div>至此，基于GTID的主从搭建完毕，接下来就是搭建MHA高可用集群了；</div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">四、安装MHA</span></font></div><div>配置yum源</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># 163的源</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">wget <a href="http://mirrors.163.com/.help/CentOS7-Base-163.repo">http://mirrors.163.com/.help/CentOS7-Base-163.repo</a> -O /etc/yum.repos.d/163.repo       </span></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># epel源</span></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# </span>wget <a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm">http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm</a> </span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# rpm -ivh epel-release-7-11.noarch.rpm</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">warning: epel-release-7-11.noarch.rpm: Header V3 RSA/SHA256 Signature, key ID 352c64e5: NOKEY</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Preparing...                          ################################# [100%]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Updating / installing...</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   1:epel-release-7-11                ################################# [100%]</span></div></div><div><br/></div><div>在master、slave1、slave2三台机器上装node，在slave2上装manager，manager可以单独安装一台机器，我这里资源有限，将其放在slave2上；</div><div>安装node</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"># master slave1 slave2</span></div><div><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">[root@mysql-slave-1013306 ~]# </span><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; min-height: 10pt;">yum -y install perl-DBD-MySQL* <span style="min-height: 10pt; font-size: 9pt;">perl-ExtUtils* <span style="min-height: 10pt; font-size: 9pt;">perl-CPAN</span></span></span><br/></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# tar -xf mha4mysql-node-0.57.tar.gz</span></span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# cd mha4mysql-node-0.57/</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 mha4mysql-node-0.57]# perl Makefile.PL</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Module::AutoInstall version 1.06</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Checking for Perl dependencies...</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[Core Features]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- DBI        ...loaded. (1.627)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- DBD::mysql ...loaded. (4.023)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Module::AutoInstall configuration finished.</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Checking if your kit is complete...</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Looks good</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Writing Makefile for mha4mysql::node</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 mha4mysql-node-0.57]# make &amp;&amp; make install</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogManager.pm blib/lib/MHA/BinlogManager.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogPosFindManager.pm blib/lib/MHA/BinlogPosFindManager.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogPosFinderXid.pm blib/lib/MHA/BinlogPosFinderXid.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogHeaderParser.pm blib/lib/MHA/BinlogHeaderParser.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogPosFinder.pm blib/lib/MHA/BinlogPosFinder.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/NodeUtil.pm blib/lib/MHA/NodeUtil.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/BinlogPosFinderElp.pm blib/lib/MHA/BinlogPosFinderElp.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/SlaveUtil.pm blib/lib/MHA/SlaveUtil.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/NodeConst.pm blib/lib/MHA/NodeConst.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp bin/filter_mysqlbinlog blib/script/filter_mysqlbinlog</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/perl &quot;-Iinc&quot; -MExtUtils::MY -e 'MY-&gt;fixin(shift)' -- blib/script/filter_mysqlbinlog</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp bin/apply_diff_relay_logs blib/script/apply_diff_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/perl &quot;-Iinc&quot; -MExtUtils::MY -e 'MY-&gt;fixin(shift)' -- blib/script/apply_diff_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp bin/purge_relay_logs blib/script/purge_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/perl &quot;-Iinc&quot; -MExtUtils::MY -e 'MY-&gt;fixin(shift)' -- blib/script/purge_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp bin/save_binary_logs blib/script/save_binary_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/usr/bin/perl &quot;-Iinc&quot; -MExtUtils::MY -e 'MY-&gt;fixin(shift)' -- blib/script/save_binary_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Manifying blib/man1/filter_mysqlbinlog.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Manifying blib/man1/apply_diff_relay_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Manifying blib/man1/purge_relay_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Manifying blib/man1/save_binary_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogManager.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogPosFindManager.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogPosFinderXid.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogHeaderParser.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogPosFinder.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/NodeUtil.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/BinlogPosFinderElp.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/SlaveUtil.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/perl5/MHA/NodeConst.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/man/man1/filter_mysqlbinlog.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/man/man1/apply_diff_relay_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/man/man1/purge_relay_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Installing /usr/local/share/man/man1/save_binary_logs.1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/filter_mysqlbinlog</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/apply_diff_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/purge_relay_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/save_binary_logs</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Appending installation info to /usr/lib64/perl5/perllocal.pod</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">###安装完成后会在/usr/local/bin下安装4个可执行文件</div></div><div><br/></div><div>在slave2上安装manager</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave2</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# yum -y install perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# tar -xf mha4mysql-manager-0.57.tar.gz</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# cd mha4mysql-manager-0.57/</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 mha4mysql-manager-0.57]# perl Makefile.PL</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Module::AutoInstall version 1.06</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Checking for Perl dependencies...</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[Core Features]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- DBI                   ...loaded. (1.627)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- DBD::mysql            ...loaded. (4.023)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- Time::HiRes           ...loaded. (1.9725)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- Config::Tiny          ...loaded. (2.14)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- Log::Dispatch         ...loaded. (2.41)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- Parallel::ForkManager ...loaded. (1.18)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">- MHA::NodeConst        ...loaded. (0.57)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*** Module::AutoInstall configuration finished.</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Checking if your kit is complete...</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Looks good</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Writing Makefile for mha4mysql::manager</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 mha4mysql-manager-0.57]# make &amp;&amp; make install</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/ManagerUtil.pm blib/lib/MHA/ManagerUtil.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/Config.pm blib/lib/MHA/Config.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cp lib/MHA/HealthCheck.pm blib/lib/MHA/HealthCheck.pm</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">......</div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_stop    </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_conf_host</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_check_repl</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_check_status</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_master_monitor</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_check_ssh</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_master_switch</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_secondary_check</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">Installing /usr/local/bin/masterha_manager</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Appending installation info to /usr/lib64/perl5/perllocal.pod</span></div></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">五、配置MHA</span></font></div><div>安装完成后，在所有数据库节点中中创建用于MHA管理的超管账号；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master slave1 slave2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; grant all privileges on *.* to 'mhamanager'@'%' identified by 'echo123.';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected, 1 warning (0.18 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; flush privileges;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.12 sec)</span></div></div><div><br/></div><div>创建MHA目录，MHA可以管理多套主从架构，因此我在这里将这套环境所有的配置存放在/home/mha/app1里，如果有其他的环境，可以创建app2、app3等用于区分</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># slave2 </span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># 创建工作目录</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# mkdir -p /home/mha/app1</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># 创建配置文件目录</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# mkdir /home/mha/app1/conf</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">#创建脚本存放目录</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# mkdir /home/mha/app1/scripts</span></div></div><div><br/></div><div><span style="min-height: 10pt; font-size: 9pt;">在mha4mysql-manager-0.57.tar.gz解压后的目录里面，有默认的配置文件和脚本，我们将其复制到我们定义的目录中</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# cp mha4mysql-manager-0.57/samples/conf/* /home/mha/app1/conf/</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# cp mha4mysql-manager-0.57/samples/scripts/* /home/mha/app1/scripts/</span></div></div><div><br/></div><div>修改配置app1.conf文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 conf]# vim app1.cnf</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[server default]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">manager_log=/home/mha/app1/manager.log              ##设置manager的日志文件</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">manager_workdir=/home/mha/app1                      ##设置manager的工作目录</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">master_binlog_dir=/data/mysql                       ##设置master保存binlog的目录，以便MHA找到master的日志</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">master_ip_failover_script= /home/mha/app1/scripts/master_ip_failover   ##设置自动failover时的切换脚本</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">master_ip_online_change_script= /home/mha/app1/scripts/master_ip_online_change  ##设置手动切换时的切换脚本</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">user=mhamanager                                     ##设置监控用户，就是上面创建的超管用户</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">password=echo123.                                   ##设置监控用户密码</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ping_interval=1                                     ##设置监控主库发送ping包的时间间隔，默认是3，这里设置成1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">remote_workdir=/home/mysql                          ##设置远端mysql在发生切换时binlog保存的位置</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">repl_user=mharepl                                   ##设置复制环境中的复制用户的用户名</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">repl_password=echo123.                              ##设置复制环境中复制用户的密码</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">report_script=/home/mha/app1/scripts/send_report    ##设置发生切换是的告警脚本</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">secondary_check_script= /usr/local/bin/masterha_secondary_check -s 10.10.10.101 -s 10.10.10.102  --user=root --master_host=10.10.10.100 --master_ip=10.10.10.100 --master_port=3306   ##一旦MHA到master之间监控出现问题，MHA  manager会判断其他从库是否能建立到master_ip 3306的连接</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">shutdown_script=&quot;&quot;                                  ##设置故障发生后关闭故障主机的脚本（防止脑裂现象），我这里不指定</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ssh_user=root                                       ##设置ssh登录的用户名</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ssh_port=22                                         ##设置ssh登录的端口</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[server1]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">hostname=10.10.10.100</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">port=3306</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">candidate_master=1</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">check_repl_delay=0 </span><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[server2]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">hostname=10.10.10.101</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">port=3306</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">candidate_master=1                                  ##设置为候选master</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">check_repl_delay=0                                  ##<span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">默认情况下如果一个slave落后master 100M的relay logs的话，MHA将不会选择该slave作为一个新的master，因为对于这个slave的恢复需要花费很长时间，通过设置check_repl_delay=0,MHA触发切换在选择一个新的master的时候将会忽略复制延时，这个参数对于设置了candidate_master=1的主机非常有用，因为它保证了这个候选主在切换过程中一定是最新的master</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[server3]</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">hostname=10.10.10.102</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">port=3306</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">no_master=1                                         ##设置其不会成为候选master</span></div></div><div><br/></div><div>修改<span style="font-size: 9pt; color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;;">master_ip_failover</span><span style="font-size: 10pt; font-family: &quot;DejaVu Sans Mono&quot;;">和</span><span style="font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0);">master_ip_online_change</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 10pt;">脚本</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 scripts]# cd /home/mha/app1/scripts/</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 scripts]# cp master_ip_failover master_ip_failover_bak</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 scripts]# cp master_ip_online_change master_ip_online_change_bak</span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">[root@mysql-slave-1023306 scripts]# vim master_ip_failover</span><br/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">#!/usr/bin/env perl </span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">use strict</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">use warnings</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">FATAL</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=&gt;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'all'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">use</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Getopt::Long;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,         </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_port</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">);</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 0, 213); font-size: 9pt;"><br/></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 0, 213); font-size: 9pt;">##这下面的根据实际情况修改</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'10.10.10.200/24'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'0'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_start_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;/sbin/ifconfig eno16777736:</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;          </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_stop_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;/sbin/ifconfig eno16777736:</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">down&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">GetOptions(</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'command=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'ssh_user=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">         =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'orig_master_host=s'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'orig_master_ip=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'orig_master_port=i'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'new_master_host=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'new_master_ip=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">'new_master_port=i'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">);</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">&amp;main</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">main</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">IN SCRIPT TEST====</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_stop_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">==</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_start_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">===</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;stop&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">||</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;stopssh&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">1</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eval</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;Disabling the VIP on old master:</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">&amp;stop_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        };</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">warn</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;Got Error:</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">elsif</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;start&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">10</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eval</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;Enabling the VIP -</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">on the new master -</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">&amp;start_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        };</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">warn</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">elsif</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;status&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;Checking the Status of the script.. OK</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">else</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">&amp;usage</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">1</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">start_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">() {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">ssh</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$new_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_start_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">stop_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">() {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">return</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">unless</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  (</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">);</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">ssh</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$orig_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">$ssh_stop_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 192, 192); font-size: 9pt;">usage</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 192, 0); font-size: 9pt;">print</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">   </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip  </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">            --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 192); font-size: 9pt;">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(192, 0, 0); font-size: 9pt;">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">}</span></div></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0); min-height: 10pt;">[root@mysql-slave-1023306 scripts]# vim master_ip_online_change</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192); min-height: 10pt;">#!/usr/bin/env perl </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">use strict</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">use warnings</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">FATAL</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=&gt;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'all'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">use</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Getopt::Long;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);">##根据实际情况修改</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'10.10.10.200/24'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">; </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># Virtual IP </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;0&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$ssh_start_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;/sbin/ifconfig eno16777736:</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$ssh_stop_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;/sbin/ifconfig eno16777736:</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$key</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">down&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,             </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_is_new_slave</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,      </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,        </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_password</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,    </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,         </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_password</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">, </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">);</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">GetOptions(</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'command=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">                =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_is_new_slave'</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_is_new_slave</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_host=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_ip=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">         =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_port=i'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_user=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_password=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">   =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_password</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'orig_master_ssh_user=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">   =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_host=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_ip=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">          =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_ip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_port=i'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_user=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_password=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">    =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_password</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"> </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">'new_master_ssh_user=s'</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">    =&gt; \</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">,</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">);</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">&amp;main</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">main</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);">#print &quot;\n\nIN SCRIPT TEST====$ssh_stop_vip==$ssh_start_vip===\n\n&quot;; </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;stop&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">||</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;stopssh&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># $orig_master_host, $orig_master_ip, $orig_master_port are passed. </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># If you manage master ip address at global catalog database, </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># invalidate orig_master_ip here. </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">1</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eval</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">***************************************************************</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;Disabling the VIP -</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">on old master:</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_host</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;***************************************************************</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n\n\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">&amp;stop_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        };</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">warn</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;Got Error:</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">elsif</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;start&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># all arguments are passed. </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># If you manage master ip address at global catalog database, </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># activate new_master_ip here. </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># You can also grant write access (create user, set read_only=0, etc) here. </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">my</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">10</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eval</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">***************************************************************</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;Enabling the VIP -</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">on new master:</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;***************************************************************</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n\n\n\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">&amp;start_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        };</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">if</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">warn</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">           </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">        }</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$exit_code</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">elsif</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">(</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$command</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">eq</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;status&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">) {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;Checking the Status of the script.. OK</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">ssh</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$ssh_start_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">0</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">else</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">&amp;usage</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">();</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">       </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">exit</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">1</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># A simple system call that enable the VIP on the new master </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">start_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">() {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">ssh</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$new_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$ssh_start_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 0, 213);"># A simple system call that disable the VIP on the old_master </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">stop_vip</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">() {</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">ssh</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_ssh_user</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\@</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$orig_master_host</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">$ssh_stop_vip</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">`</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">sub</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 192, 192);">usage</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">{</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 192, 0);">print</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;Usage: master_ip_failover –command=start|stop|stopssh|status –orig_master_host=host –orig_master_ip=ip –orig_master_port=po </span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">rt –new_master_host=host –new_master_ip=ip –new_master_port=port</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 192);">\n</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(192, 0, 0);">&quot;</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">}</span></div></div></div><div><br/></div><div>利用mha工具检测ssh</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 scripts]# /usr/local/bin/masterha_check_ssh --conf=/home/mha/app1/conf/app1.conf</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:14 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:14 2018 - [info] Reading application default configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:14 2018 - [info] Reading server configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:14 2018 - [info] Starting SSH connection tests..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:16 2018 - [debug]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:14 2018 - [debug]  Connecting via SSH from root@10.10.10.100(10.10.10.100:22) to root@10.10.10.101(10.10.10.101:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]  Connecting via SSH from root@10.10.10.100(10.10.10.100:22) to root@10.10.10.102(10.10.10.102:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:17 2018 - [debug]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]  Connecting via SSH from root@10.10.10.101(10.10.10.101:22) to root@10.10.10.100(10.10.10.100:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]  Connecting via SSH from root@10.10.10.101(10.10.10.101:22) to root@10.10.10.102(10.10.10.102:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:16 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:17 2018 - [debug]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:15 2018 - [debug]  Connecting via SSH from root@10.10.10.102(10.10.10.102:22) to root@10.10.10.100(10.10.10.100:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:16 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:16 2018 - [debug]  Connecting via SSH from root@10.10.10.102(10.10.10.102:22) to root@10.10.10.101(10.10.10.101:22)..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:16 2018 - [debug]   ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:48:17 2018 - [info] <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">All SSH connection tests passed successfully.</span></span></div></div><div><br/></div><div>检测复制状态</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 scripts]# /usr/local/bin/masterha_check_repl --conf=/home/mha/app1/conf/app1.conf</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:23 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:23 2018 - [info] Reading application default configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:23 2018 - [info] Reading server configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:23 2018 - [info] MHA::MasterMonitor version 0.57.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] GTID failover mode = 1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Dead Servers:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Alive Servers:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   10.10.10.102(10.10.10.102:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Alive Slaves:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   10.10.10.101(10.10.10.101:3306)  Version=5.7.21-log (oldest major version between slaves) log-bin:enabled</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     GTID ON</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     Replicating from 10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     Primary candidate for the new Master (candidate_master is set)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   10.10.10.102(10.10.10.102:3306)  Version=5.7.21-log (oldest major version between slaves) log-bin:enabled</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     GTID ON</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     Replicating from 10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]     Not candidate for the new Master (no_master is set)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Current Alive Master: 10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking slave configurations..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking replication filtering settings..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]  binlog_do_db= , binlog_ignore_db=</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]  Replication filtering check ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] GTID (with auto-pos) is supported. Skipping all SSH and Node package checking.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking SSH publickey authentication settings on the current master..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] HealthCheck: SSH to 10.10.10.100 is reachable.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">10.10.10.100(10.10.10.100:3306) (current master)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--10.10.10.102(10.10.10.102:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking replication health on 10.10.10.101..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]  ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking replication health on 10.10.10.102..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]  ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Checking master_ip_failover_script status:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]   /home/mha/app1/scripts/master_ip_failover --command=status --ssh_user=root --orig_master_host=10.10.10.100 --orig_master_ip=10.10.10.100 --orig_master_port=3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">IN SCRIPT TEST====/sbin/ifconfig eno16777736:0 down==/sbin/ifconfig eno16777736:0 10.10.10.200/24===</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Checking the Status of the script.. OK</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info]  OK.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [warning] shutdown_script is not defined.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 18:49:24 2018 - [info] Got exit code 0 (Not master dead).</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">MySQL Replication Health is OK.</span></span></div></div><div><br/></div><div>在主库添加vip（第一次手动添加）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">/sbin/ifconfig eno16777736:0 10.10.10.200/24</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# ip addr show  eno16777736</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2: eno16777736: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    link/ether 00:0c:29:ff:c6:cd brd ff:ff:ff:ff:ff:ff</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet 10.10.10.100/24 brd 10.10.10.255 scope global eno16777736</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">10.10.10.200/24</span> brd 10.10.10.255 scope global secondary eno16777736:0</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet6 fe80::20c:29ff:feff:c6cd/64 scope link</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div></div><div><br/></div><div>尝试使用vip连接</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 ~]# mysql -uroot -p -h 10.10.10.200 -P 3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Enter password:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ERROR 1045 (28000): Access denied for user 'root'@'mysql-slave-1023306' (using password: YES)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></div><div style="font-family: Monaco; font-size: 9pt;"><font color="#328712">##由于root仅允许localhost连接，我们需要创建一个账号用于远程连接</font></div></div><div><br/></div><div>在master上创建远程连接用户</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);"># master</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">mysql&gt; grant all privileges on *.* to 'user'@'%' identified by 'echo123.';</span></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Query OK, 0 rows affected, 1 warning (0.02 sec)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">mysql&gt; flush privileges;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Query OK, 0 rows affected (0.00 sec)</span></div></div><div><br/></div><div>使用user重新连接</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-slave-1023306 ~]# mysql -uuser -p -h 10.10.10.200 -P 3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Enter password:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Welcome to the MySQL monitor.  Commands end with ; or \g.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Your MySQL connection id is 40</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Server version: 5.7.21-log MySQL Community Server (GPL)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Oracle is a registered trademark of Oracle Corporation and/or its</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">affiliates. Other names may be trademarks of their respective</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">owners.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">mysql&gt;</span></div></div><div><br/></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">六、验证MHA切换</span></font></div><div>启动MHA，使用nohup后台运行</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# nohup /usr/local/bin/masterha_manager --conf=/home/mha/app1/conf/app1.conf &amp;&gt; /home/mha/app1/nohup.out &amp;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[1] 23028</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# /usr/local/bin/masterha_check_status --conf=/home/mha/app1/conf/app1.conf</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">app1 (pid:23028) is running(0:PING_OK), master:10.10.10.100</span></div></div></div><div><br/></div><div>模拟主库宕机，观察会不会切换到slave1上</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># master</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# service mysqld stop</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Shutting down MySQL............ SUCCESS!</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# ip addr show eno16777736</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2: eno16777736: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    link/ether 00:0c:29:ff:c6:cd brd ff:ff:ff:ff:ff:ff</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet 10.10.10.100/24 brd 10.10.10.255 scope global eno16777736</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet6 fe80::20c:29ff:feff:c6cd/64 scope link</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##可以看到vip已经迁移走了</span></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div></div><div><br/></div><div>在slave1上查看</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">#slave1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1013306 ~]# ip addr show eno16777736</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2: eno16777736: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    link/ether 00:0c:29:66:1d:d8 brd ff:ff:ff:ff:ff:ff</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet 10.10.10.101/24 brd 10.10.10.255 scope global eno16777736</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">10.10.10.200/24</span> brd 10.10.10.255 scope global secondary eno16777736:0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">    inet6 fe80::20c:29ff:fe66:1dd8/64 scope link</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       valid_lft forever preferred_lft forever</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">##vip已经迁移到了slave1上</span></div></div><div><br/></div><div>在slave2上查看复制指向的是哪个master</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show slave status\G;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*************************** 1. row ***************************</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Slave_IO_State: Waiting for master to send event</span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="color: rgb(0, 128, 0); font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">                  Master_Host: 10.10.10.101             </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000">##可以看到已经指向到了slave1上</font></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_User: mharepl</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Port: 3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Connect_Retry: 60</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_Log_File: mysql-bin.000004</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Read_Master_Log_Pos: 234</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Relay_Log_File: mysql-relay-bin.000002</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Relay_Log_Pos: 367</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Relay_Master_Log_File: mysql-bin.000004</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Slave_IO_Running: Yes</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Slave_SQL_Running: Yes</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Replicate_Do_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Replicate_Ignore_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Replicate_Do_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">       Replicate_Ignore_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Replicate_Wild_Do_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Wild_Ignore_Table:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                   Last_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Skip_Counter: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          Exec_Master_Log_Pos: 234</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Relay_Log_Space: 574</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Until_Condition: None</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Until_Log_File:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Until_Log_Pos: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Allowed: No</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_File:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_CA_Path:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">              Master_SSL_Cert:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Master_SSL_Cipher:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Key:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">        Seconds_Behind_Master: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Master_SSL_Verify_Server_Cert: No</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Last_IO_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Errno: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Last_SQL_Error:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">  Replicate_Ignore_Server_Ids:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Server_Id: 1013306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_UUID: 8d3e071d-41b8-11e8-aaef-000c29661dd8</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">             Master_Info_File: /data/mysql/master.info</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                    SQL_Delay: 0</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">          SQL_Remaining_Delay: NULL</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_Retry_Count: 86400</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                  Master_Bind:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">      Last_IO_Error_Timestamp:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">     Last_SQL_Error_Timestamp:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">               Master_SSL_Crl:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_SSL_Crlpath:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Retrieved_Gtid_Set:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">            Executed_Gtid_Set: 8d3e071d-41b8-11e8-aaef-000c29661dd8:1-4,</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">91daaeb1-3eab-11e8-bbc1-000c29ffc6cd:1-42,</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">94a6d6b6-4280-11e8-a2f7-000c295bc4c5:1-2</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                Auto_Position: 1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">         Replicate_Rewrite_DB:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">                 Channel_Name:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">           Master_TLS_Version:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div></div><div><br/></div><div>在切换完成后manager上的MHA进程会停掉，并在工作目录下创建一个*.complete的空文件,再次启动的时候，最好把这个文件删掉；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">[root@mysql-slave-1023306 app1]# /usr/local/bin/masterha_check_status --conf=/home/mha/app1/conf/app1.conf</span></span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">app1 is stopped(2:NOT_RUNNING).</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# ls</span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;;"><font color="#008000" style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">app1.failover.compelte</font><font color="#328712" style="color: rgb(51, 51, 51);"> </font></span><span style="color: rgb(0, 0, 213); font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;;">conf</span><span style="color: rgb(0, 128, 0); font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;;">  manager.log  nohup.out </span> <span style="color: rgb(0, 0, 213); font-size: 9pt; font-family: &quot;DejaVu Sans Mono&quot;;">scripts</span></div></div><div><br/></div><div>检查复制状态</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# /usr/local/bin/masterha_check_repl --conf=/home/mha/app1/conf/app1.conf</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:50 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:50 2018 - [info] Reading application default configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:50 2018 - [info] Reading server configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:50 2018 - [info] MHA::MasterMonitor version 0.57.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:51 2018 - [error][/usr/local/share/perl5/MHA/ServerManager.pm, ln653] There are 2 non-slave servers! MHA manages at most one non-slave server. Check configurations.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:51 2018 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln427] Error happened on checking configurations.  at /usr/local/share/perl5/MHA/MasterMonitor.pm line 329.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:51 2018 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln525] Error happened on monitoring servers.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:19:51 2018 - [info] Got exit code 1 (Not master dead).</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">MySQL Replication Health is NOT OK!</span></div></div><div><br/></div><div>出现这个的原因是主库宕机，没有指向新的主库，需要手动指向新的主库，也就是slave2；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-master-1003306 ~]# service mysqld start</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Starting MySQL. SUCCESS!</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; CHANGE MASTER TO MASTER_HOST='10.10.10.101',MASTER_USER='mharepl',MASTER_PASSWORD='echo123.',MASTER_PORT=3306,MASTER_AUTO_POSITION=1;</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected, 2 warnings (0.02 sec)</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; start slave;</span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Query OK, 0 rows affected (0.01 sec)</span></div></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><br/></span></div></div><div><br/></div><div>再次检查复制状态，显示成功；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# /usr/local/bin/masterha_check_repl --conf=/home/mha/app1/conf/app1.conf</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:07 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:07 2018 - [info] Reading application default configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:07 2018 - [info] Reading server configuration from /home/mha/app1/conf/app1.conf..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:07 2018 - [info] MHA::MasterMonitor version 0.57.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] GTID failover mode = 1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Dead Servers:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Alive Servers:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   10.10.10.102(10.10.10.102:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Alive Slaves:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   10.10.10.100(10.10.10.100:3306)  Version=5.7.21-log (oldest major version between slaves) log-bin:enabled</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     GTID ON</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     Replicating from 10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     Primary candidate for the new Master (candidate_master is set)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   10.10.10.102(10.10.10.102:3306)  Version=5.7.21-log (oldest major version between slaves) log-bin:enabled</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     GTID ON</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     Replicating from 10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]     Not candidate for the new Master (no_master is set)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Current Alive Master: 10.10.10.101(10.10.10.101:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking slave configurations..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  read_only=1 is not set on slave 10.10.10.100(10.10.10.100:3306).</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking replication filtering settings..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  binlog_do_db= , binlog_ignore_db=</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  Replication filtering check ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] GTID (with auto-pos) is supported. Skipping all SSH and Node package checking.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking SSH publickey authentication settings on the current master..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] HealthCheck: SSH to 10.10.10.101 is reachable.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">10.10.10.101(10.10.10.101:3306) (current master)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--10.10.10.100(10.10.10.100:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--10.10.10.102(10.10.10.102:3306)</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking replication health on 10.10.10.100..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking replication health on 10.10.10.102..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Checking master_ip_failover_script status:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]   /home/mha/app1/scripts/master_ip_failover --command=status --ssh_user=root --orig_master_host=10.10.10.101 --orig_master_ip=10.10.10.101 --orig_master_port=3306</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">IN SCRIPT TEST====/sbin/ifconfig eno16777736:0 down==/sbin/ifconfig eno16777736:0 10.10.10.200/24===</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Checking the Status of the script.. OK</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info]  OK.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [warning] shutdown_script is not defined.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Wed Apr 18 20:23:08 2018 - [info] Got exit code 0 (Not master dead).</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">MySQL Replication Health is OK.</span></div></div><div><br/></div><div>删除complete文件，再起启动MHA</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# rm -rf <a href="http://app1.failover.complete/">app1.failover.complete</a></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# nohup /usr/local/bin/masterha_manager --conf=/home/mha/app1/conf/app1.conf &amp;&gt; /home/mha/app1/nohup.out &amp;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[1] 23424</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 app1]# /usr/local/bin/masterha_check_status --conf=/home/mha/app1/conf/app1.conf</span></span></div><div style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">app1 (pid:23424) is running(0:PING_OK), master:10.10.10.101</span></div></div></div><div><br/></div><div>至此，搭建MHA的过程就结束了；</div><div><br/></div><div>还有点内容需要补充，就是之前提到了清理relay log的方法；</div><div style="letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;-en-paragraph:true;"><span style="background-color: rgb(250, 250, 252); font-variant-caps: normal; font-variant-ligatures: normal; font-size: 10pt; color: rgb(51, 51, 51);"> </span> <span style="font-variant-caps: normal; font-variant-ligatures: normal; font-size: 10pt;">MHA在发生切换过程中，从库在恢复的过程中，依赖于relay log的相关信息，所以我们这里要将relay log的自动清楚设置为OFF，采用手动清楚relay log的方式。</span></span></div><div style="letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;-en-paragraph:true;"><span style="font-variant-caps: normal; font-variant-ligatures: normal; font-size: 10pt;">      在默认情况下，从服务器上的中继日志会在SQL线程执行完后被自动删除。但是在MHA环境中，这些中继日志在恢复其它从服务器时可能会被用到，因此需要禁用中继日志的自动清除。改为定期手动清除SQL线程应用完的中继日志。</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;-en-paragraph:true;"><span style="font-variant-caps: normal; font-variant-ligatures: normal; font-size: 10pt;">      在ext3文件系统下，删除大的文件需要一定的时间，这样会导致严重的复制延迟，所以在Linux中，一般都是通过硬链接的方式来删除大文件。</span></span></div><div><span style="background-color: rgb(250, 250, 252); font-size: 14px; text-align: justify;"><br/></span></div><div><span style="background-color: rgb(250, 250, 252); font-size: 14px; text-align: justify; color: rgb(51, 51, 51); font-family: tahoma, 宋体;">设置定期清理relay脚本</span><br/></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252); color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">        MHA节点中包含了purge_relay_logs脚本，它可以为relay log创建硬链接，执行set global relay_log_purge=1，等待几秒钟以便SQL线程切换到新的中继日志，再执行set global relay_log_purge=0。</span></div><div><br/></div><div>使用方法：</div><div>    <br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@mysql-slave-1023306 mysql]# <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">/usr/local/bin/purge_relay_logs --user=mhamanager --password=echo123. --disable_relay_log_purge  --workdir=/home/mysql</span></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2018-04-18 20:43:02: purge_relay_logs script started.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Found relay_log.info: /data/mysql/relay-log.info</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Opening /data/mysql/mysql-relay-bin.000002 ..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Opening /data/mysql/mysql-relay-bin.000003 ..</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Executing SET GLOBAL relay_log_purge=1; FLUSH LOGS; sleeping a few seconds so that SQL thread can delete older relay log files (if it keeps up); SET GLOBAL relay_log_purge=0; .. ok.</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2018-04-18 20:43:05: All relay log purging operations succeeded.</span></div></div><div><br/></div><div>可以将该命令写到计划任务里面去，不同的slave进行relay log清理的时间最好错开；</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 