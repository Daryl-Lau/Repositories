<html>
<head>
  <title>MySQL数据库文件</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="584"/>
<h1>MySQL数据库文件</h1>

<div>
<span><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><a href="#17mbwm1522333065944" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">MySQL数据库文件</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#91lrjx1522333000201" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">1、参数文件</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#21bqpt1522333023313" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">2、日志文件</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#17wzvm1522333986713" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">错误日志文件 （error log）</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#18osmh1522334085787" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">二进制日志文件 （bin log）</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#23vjrn1522338035463" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">慢查询日志文件 （slow query log）</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#94ixhd1522334181526" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">查询日志文件 （query log）</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#11wrth1522333028064" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">3、socket文件</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#37ntis1522333034271" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">4、pid文件</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#5vdtp1522333038298" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">5、MySQL表结构文件</a></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><a href="#14ctzd1522333050319" style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">6、innodb存储引擎文件</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#8zwdu1522341427933" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">表空间文件</a></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><a href="#94htmv1522341414369" style="white-space: pre-wrap; text-indent: 56px; font-size: 14px; line-height: 1.75;">重做日志文件</a></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 28px; font-weight: bold; line-height: 1.75;">MySQL数据库文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 20px; font-weight: bold;">1、参数文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px;">告诉数据库启动实例的时候在哪里可以找到数据库文件，并指定初始化参数；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px;">通过mysql --help | grep my.cnf来寻找即可</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; font-weight: bold; line-height: 1.75;">2、日志文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px;">记录mysql实例对对某种条件作出响应时写入的文件，如错误日志文件，二进制日志文件，慢查询日志文件，查询日志文件等；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px; color: rgb(223, 64, 42);">注意：redo log 和undo log不在这个范围，因为仅支持事务的存储引擎才有redo log和undo log</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 28px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 28px; font-weight: bold;">2.1、错误日志文件 （error log）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px; line-height: 1.75;">对mysql的启动、运行、关闭进行了记录；</span><span style="text-indent: 28px; font-size: 14px; line-height: 1.75;">show variables like '%log_error%'</span> <span style="text-indent: 28px; font-size: 14px; line-height: 1.75;">来查看错误日志文件的路径；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show variables like '%log_error%';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| Variable_name       | Value                       |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| binlog_error_action | ABORT_SERVER                |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| log_error           | /usr/local/mysql/mysqld.err |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| log_error_verbosity | 3                           |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">3 rows in set (0.00 sec)</span></div></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 28px;"><br/></span><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 28px; font-weight: bold;">2.2、二进制日志文件 （bin log）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">bin log记录了对mysql数据库执行更改的所有操作，但不包括select和show操作，因为这两个操作对数据本身并没有修改。</span><span style="text-indent: 56px; font-size: 14px;">bin log有下面几个作用：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    恢复：对数据库全备恢复后，还需要恢复二进制日志来保证数据的完整；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    复制：主从复制，通过bin log来进行数据同步；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    审计：通过对二进制日志中的信息来进行审计，判断是否有sql注入攻击；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">bin log默认没有开启。需要手动开启，官方解释开启bin log会使性能下降1%，但是作用巨大，性能损失可以忽略；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="background-color: rgb(145, 205, 222); text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">相关参数：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="background-color: rgb(255, 255, 255);"><span style="text-indent: 56px; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">max_binlog_size：</span><span style="text-indent: 56px; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">指定单个二进制文件最大值，默认1G；</span></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_size：</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">指定二进制缓冲区大小，默认32K，其是针对会话（session）的，就是说，当一个线程开始一个事务的时候，都会自动分配一个大小为binlog_cache_size的内存，因此注意该值不能设置过大；通过</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_use</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">和</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_disk_use</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">的状态，可以判断是否设置合适，</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_use</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">记录了使用缓冲写二进制日志的次数，</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_disk_use</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">记录了临时文件写二进制的次数，该值如果为0，则表示</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">binlog_cache_size大小够用</span><span style="text-indent: 56px; font-size: 14px; line-height: 1.75;">，否则需要适当的增加大小；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">sync_binlog = [N] 表示每写缓冲多少次就刷新到磁盘，1是最安全</span><span style="text-indent: 56px; font-size: 14px;">的值，但也是最慢的；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">    sync_binlog 参数决定bin log刷新机制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">        1：实时刷新（默认）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">        0：交由操作系统管理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">        （2，3，4......n）：n个事务刷新一次</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">binlog-do-db 哪些库写入二进制文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">binlog-ignore-db 忽略哪些库写入二进制文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">log-slave-update 如果是从库，需要设置该参数来讲主库的二进制文件写入自己的二进制文件中去</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">binlog_format</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    STATEMENT：记录的是逻辑SQL语句</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    ROW：记录表行的更改情况，日志文件会增大，对磁盘空间要求有一定增加；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 84px; font-size: 14px;">    MIXED：混合使用，默认还是使用STATEMENT，但是某些情况下会使用ROW，比如</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 140px; font-size: 14px;">                1）表的存储引擎为NDB，这时对表的DML语句都是使用ROW；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 140px; font-size: 14px;">                2）使用了UUID()、 USER()、CURRENT_USER()、FOUND_ROWS()、</span><span style="text-indent: 168px; font-size: 14px;">ROW_COUNT()等不确定函数；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 140px; font-size: 14px;">                3）使用了INSERT DELAY语句；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 140px; font-size: 14px;">                4）使用了用户定义函数（UDF）；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 140px; font-size: 14px;">                5）使用了临时表（temporary table）；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">二进制文件是二进制的，需要使用mysqlbinlog工具辅助阅读；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 56px; font-size: 14px;">mysqlbinlog --no-defaults -v -v --base64-output=decode-row /data/binlog &gt; 1.log</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 56px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 56px; font-weight: bold;">2.3、慢查询日志文件 （slow query log）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px;">默认情况下，mysql不启动慢查询日志，需要手动开启；</span></div><div style="font-size: 9pt;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show variables like '%slow_query_log%';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| Variable_name       | Value                       |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| slow_query_log      | OFF                         |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| slow_query_log_file | /data/mysql/lyucan-slow.log |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+---------------------+-----------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">2 rows in set (0.01 sec)</span></div></div><div style="font-size: 9pt;"><br/></div><div><span style="font-size: 11pt;">相关参数：</span></div><div style="font-size: 9pt;"><span style="background-color: transparent; font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">long_query_time：</span><span style="background-color: transparent; font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">设置慢查询阈值，当超过这个阈值的时候，记录到满查询日志，供DBA进行查询优化，默认为10s；</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">long_query_not_using_indexes：</span><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">参数控制是否将没有使用索引的sql语句记录到慢查询日志里面；</span><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">log_throttle_queries_not_using_indexes：</span><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">5.6以后引入了一个参数来表示每分钟记录到慢查询日志的且未使用索引的sql语句数量，默认值为0，表示没有限制；</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">slow_query_type</span><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco; line-height: 1.75;">来表示启用slow log的方式，可以为：</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap; font-family: Monaco;">    0：表示不将sql语句记录到slow log</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap; font-family: Monaco;">    1：根据运行时间将sql记录到slow log</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap; font-family: Monaco;">    2：根据逻辑IO次数将sql记录到slow log</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap; font-family: Monaco;">    3：同事根据运行时间和逻辑IO次数将sql记录到slow log</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap;"><br/></span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap; font-family: Monaco;">可以使用mysqldumpslow命令来辅助分析慢查询日志；</span></div><div style="font-size: 9pt;"><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap;"><br/></span></div><div style="font-size: 9pt;"><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap; font-weight: bold;">2.4、查询日志文件 （query log）</span></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">对未能正确查询的sql语句，进行了记录</span></div><div style="font-size: 9pt;"><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap;"><br/></span></div><div style="font-size: 9pt;"><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap; font-weight: bold;">2.5、中继日志（relay log）</span></div><div style="white-space: pre-wrap; text-indent: 56px; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; font-weight: bold; line-height: 1.75;">3、socket文件</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">使用unix套接字连接时需要的文件；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; font-weight: bold; line-height: 1.75;">4、pid文件</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">mysql实例启动的进程文件；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; font-weight: bold; line-height: 1.75;">5、MySQL表结构文件</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">存放mysql表结构定义的文件，.frm后缀；</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; line-height: 1.75;">每张表都会有一个.frm的文件，存放该表的表结构定义，同时还用来存放视图，如果创建了一个v_a视图，那就会对应产生一个 v_a.frm文件，用来存放视图的定义，该文件可以使用cat查看；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; font-weight: bold; line-height: 1.75;">6、innodb存储引擎文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="text-indent: 28px; font-size: 14px;">因为mysql存储引擎是基于表的，每个存储引擎都会有自己的文件来保存各种数据；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 16px; text-indent: 28px;"><br/></span></div><div style="white-space: pre-wrap; text-align: left;"><span style="text-indent: 28px; font-size: 14px; font-weight: bold;">6.1、</span><span style="font-size: 16px; text-indent: 28px; font-weight: bold;">表空间文件</span></div><div style="white-space: pre-wrap; text-align: left;"><span style="font-size: 14px; text-indent: 56px;">innodb默认情况下有一个表空间文件，名为ibdata1，用户可以通过参数innodb_data_file_path对其进行设置，格式为：</span><span style="font-size: 14px; text-indent: 56px;">innodb_data_file_path = datafile_spec1[;datafile_spec2]...</span></div><div style="white-space: pre-wrap; text-align: left;"><div style="font-size: 9pt;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show variables like '%innodb_data_file%';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-----------------------+------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| Variable_name         | Value                  |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-----------------------+------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_data_file_path | ibdata1:12M:autoextend |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-----------------------+------------------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.00 sec)</span></div></div><div style="font-size: 9pt;"><br/></div><div style="font-size: 9pt;"><span style="font-size: 14px; text-indent: 56px; background-color: transparent; color: rgb(51, 51, 51); font-family: Monaco;">用户可以通过多个文件组成一个表空间，同事指定文件的属性，例如：</span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">[mysqld]</span></div><div><span style="font-size: 11pt;">innodb_data_file_path = /db/ibdata1:2000M;/db/ivdata2:2000M:autoextend</span></div></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;">若两个文件存放在不同的磁盘上，磁盘的负载可以被均衡，提高数据库的在整体性能；</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">设置innodb_data_file_path参数后，说有基于innodb的存储引擎的表的数据都会存放在该表空间中</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">如果设置了innodb_file_per_table参数，则用户基于每个innodb存储引擎的表都会产生一个独立的表空间，独立表空间的命名规则为：表名.ibd；</span></div><div><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap;"><br/></span></div><div><span style="font-size: 16px; text-indent: 28px; white-space: pre-wrap; font-weight: bold;">6.2、重做日志文件（redo log）</span></div><div><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap;">    默认情况下，数据目录下会有两个redo log 文件，ib_logfile0 和 ib_logfile1，每个InnoDB存储引擎至少有1个redo log文件组，每个文件组下至少有2个redo log文件。为了得到更高的可靠性，可以设置多个mirrored log group，将不同的文件组放在不同的磁盘上。日志组中每个redo log文件的大小一致，并以循环方式使用。InnoDB存储引擎先写redo log文件1，当达到文件的最后是，会切换至文件2，当文件2也被写满时，会再切换到文件1中。</span></div><div><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap;"><br/></span></div><div><span style="font-size: 14px; text-indent: 28px; white-space: pre-wrap;">相关参数：</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">innodb_log_file_size：参数指定了redo log文件的大小；</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">innodb_log_files_in_group：参数指定了redo log文件组中redo log文件的数量，默认为2；</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">innodb_mirrored_log_groups：参数指定了日志镜像文件组的数量，默认为1，代表只有一个文件组，没有镜像；</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">innodb_log_group_home_dir：参数指定了日志文件组所在路径，默认在数据库路径下；</span></div><div><span style="font-size: 14px; text-indent: 56px; white-space: pre-wrap;">innodb_flush_log_at_trx_commit 参数决定redo log的刷新机制</span></div><div><span style="font-size: 14px; text-indent: 84px; white-space: pre-wrap;">    0：每隔1秒刷新一次</span></div><div><span style="font-size: 14px; text-indent: 84px; white-space: pre-wrap;">    1：实时刷新（默认）建议设置为1</span></div><div><span style="font-size: 14px; text-indent: 84px; white-space: pre-wrap;">    2：交由操作系统管理</span></div><div style="white-space: pre-wrap; text-indent: 28px; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; text-indent: 28px; font-size: 14px; color: rgb(223, 64, 42); line-height: 1.75;">重做日志不需要二次写，因为重做日志的写入是以扇区为单位的，512字节，扇区是写入的最小单位，因此可以保证每次写都是成功的，所以不需要二次写；</span></div><div><br/></div><div><font style="font-size: 12pt;"><b>6.3、回滚日志文件（undo log）</b></font></div><div><font style="font-size: 11pt;"><span style="font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span>    </span>当我们对数据进行操作的时候，就会产生undo记录，Undo记录默认记录在</span><span style="box-sizing: border-box; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">系统表空间</span><span style="font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">（ibdata）中，</span><span style="box-sizing: border-box; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">从MySQL 5.6开始，Undo使用的表空间可以分离为独立的Undo log文件</span><span style="font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">。</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show variables like '%undo_table%';</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-------------------------+-------+</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| Variable_name           | Value |</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-------------------------+-------+</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_undo_tablespaces | 0     |</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+-------------------------+-------+</span></font></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 row in set (0.01 sec)</span></font></div></div><div>0表示使用系统默认的表空间，大于1表示使用独立的undo log文件，等于几就有几个文件；</div><div><font style="font-size: 12pt;"><b><br/></b></font></div><div><font style="font-size: 11pt;">相关参数：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">mysql&gt; show variables like '%undo%';</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--------------------------+------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| Variable_name            | Value      |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--------------------------+------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_max_undo_log_size | 1073741824 |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_undo_directory    | ./         |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_undo_log_truncate | OFF        |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_undo_logs         | 128        |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">| innodb_undo_tablespaces  | 0          |</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">+--------------------------+------------+</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">5 rows in set (0.00 sec)</span></div></div><div><br/></div><div><font style="font-size: 11pt;">innodb_max_undo_log_size：控制最大undo tablespace 文件的大小</font></div><div><span style="font-size: 14.6667px;">其他参数保持默认即可，没必要把表空间文件独立出来；</span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 