<html>
<head>
  <title>openvpn</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="664"/>
<h1>openvpn</h1>

<div>
<span><div>openvpn</div><div><br/></div><div>关闭selinux</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# getenforce</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Disabled</span></div></div><div><br/></div><div>开启tun模块</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]</span># lsmod |grep tun</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">tun                    27183  0</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">[root@localhost easy-rsa-2.2.0_master]# modinfo tun</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">filename:       /lib/modules/3.10.0-229.el7.x86_64/kernel/drivers/net/tun.ko</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">alias:          devname:net/tun</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">alias:          char-major-10-200</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">license:        GPL</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">author:         (C) 1999-2004 Max Krasnyansky &lt;</span><a href="mailto:maxk@qualcomm.com" style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">maxk@qualcomm.com</a><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">&gt;</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">description:    Universal TUN/TAP device driver</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">rhelversion:    7.1</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">srcversion:     F428E80340611745A5A9468</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">depends:        </span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">intree:         Y</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">vermagic:       3.10.0-229.el7.x86_64 SMP mod_unload modversions</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">signer:         CentOS Linux kernel signing key</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">sig_key:        A6:2A:0E:1D:6A:6E:48:4E:9B:FD:73:68:AF:34:08:10:48:E5:35:E5</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">sig_hashalgo:   sha256</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]</span>#</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@localhost ~]</span># modprobe tun</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: rgb(0, 128, 0);">[root@localhost ~]</span># lsmod |grep tun</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">tun                    27183  0</span></div></div><div><br/></div><div>开启转发</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.ip_forward</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.default.rp_filter</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.all.send_redirects</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.default.send_redirects</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.all.log_martians</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.default.log_martians</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.default.accept_source_route</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.all.accept_redirects</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.conf.default.accept_redirects</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 205, 205); font-size: 9pt;">net.ipv4.icmp_ignore_bogus_error_responses</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(200, 175, 0); font-size: 9pt;">=</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(187, 0, 0); font-size: 9pt;">1</span></div></div><div><br/></div><div><br/></div><div><br/></div><div>安装lzo软件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# mkdir /usr/local/openvpn</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# cd /usr/local/openvpn/</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# </span>wget</span> <a href="http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-2.03-3.1.el6_5.1.x86_64.rpm" style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-2.03-3.1.el6_5.1.x86_64.rpm</a></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# </span>wget</span> <a href="http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-devel-2.03-3.1.el6_5.1.x86_64.rpm" style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-devel-2.03-3.1.el6_5.1.x86_64.rpm</a></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost ~]# </span>wget</span> <a href="http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-minilzo-2.03-3.1.el6_5.1.x86_64.rpm" style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">http://mirrors.163.com/centos/6.10/os/x86_64/Packages/lzo-minilzo-2.03-3.1.el6_5.1.x86_64.rpm</a></div><div><br/></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# rpm -ivh *</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc openvpn]# rpm -qa |grep lzo</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">lzo-2.03-3.1.el6_5.1.x86_64</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">lzo-devel-2.03-3.1.el6_5.1.x86_64</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">lzo-minilzo-2.03-3.1.el6_5.1.x86_64</span></div></div><div><br/></div><div>安装openvpn</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# </span>yum -y install openssl-devel openssl pam-devel</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# wget <a href="https://github.com/lyucan01/learn/raw/master/openvpn-2.4.2.tar.gz">https://github.com/lyucan01/learn/raw/master/openvpn-2.4.2.tar.gz</a></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# tar -xf openvpn-2.4.2.tar.gz</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# cd openvpn-2.4.2</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn-2.4.2]# ./configure</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn-2.4.2]# make &amp;&amp; make install</span></div></div><div><br/></div><div><br/></div><div>安装easy-rsa</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# wget <a href="http://build.openvpn.net/downloads/releases/easy-rsa-2.2.0_master.tar.gz">http://build.openvpn.net/downloads/releases/easy-rsa-2.2.0_master.tar.gz</a></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# tar -xf easy-rsa-2.2.0_master.tar.gz</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# </span>cd easy-rsa-2.2.0_master</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# </span>./configure --prefix /usr/local/openvpn/easy-rsa</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# </span>make &amp;&amp; <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">make install</span></span></div></div><div><br/></div><div><br/></div><div>配置openvpn，生成相关证书文件</div><div>生成服务端文件</div><div>生成CA证书，修改vars文件，根据以下配置修改，最好下面的地区配置不要有重复的</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# cd /usr/local/openvpn/easy-rsa/share/easy-rsa/</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 修改vars配置，最好不要有重复</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# cat vars | grep -v ^# |grep -v ^$</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export EASY_RSA=&quot;`pwd`&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export OPENSSL=&quot;openssl&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export PKCS11TOOL=&quot;pkcs11-tool&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export GREP=&quot;grep&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_CONFIG=`$EASY_RSA/whichopensslcnf $EASY_RSA`</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_DIR=&quot;$EASY_RSA/keys&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">echo NOTE: If you run ./clean-all, I will be doing a rm -rf on $KEY_DIR</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export PKCS11_MODULE_PATH=&quot;dummy&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export PKCS11_PIN=&quot;dummy&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_SIZE=2048</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export CA_EXPIRE=3650</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_EXPIRE=3650</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_COUNTRY=&quot;PH&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_PROVINCE=&quot;Man&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_CITY=&quot;Pas&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_ORG=&quot;QHC&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_EMAIL=&quot;<a href="mailto:admin@qhc.com">admin@qhc.com</a>&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_CN=CN_QHC</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_NAME=QhcEasyRSA</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export KEY_OU=OU_QHC</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export PKCS11_MODULE_PATH=changeme</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">export PKCS11_PIN=1234</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# source vars</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">NOTE: If you run ./clean-all, I will be doing a rm -rf on /etc/openvpn/easy-rsa/keys       </span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#E30000"># 只有第一次需要运行，但是如果已经存在keys文件夹了，就千万不要运行<span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;">./clean-all，这会把之前生成的整数给清掉</span></font></span></div><div><br/></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 构建CA证书</font></span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# ./build-ca</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Generating a 2048 bit RSA private key</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">......+++</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">.......+++</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">writing new private key to 'ca.key'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">-----</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">You are about to be asked to enter information that will be incorporated</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">into your certificate request.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">What you are about to enter is what is called a Distinguished Name or a DN.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">There are quite a few fields but you can leave some blank</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">For some fields there will be a default value,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">If you enter '.', the field will be left blank.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">-----</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Country Name (2 letter code) [PH]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">State or Province Name (full name) [Man]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Locality Name (eg, city) [Pas]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Organization Name (eg, company) [QHC]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Organizational Unit Name (eg, section) [OU_QHC]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Common Name (eg, your name or your server's hostname) [CN_QHC]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Name [QhcEasyRSA]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Email Address [<a href="mailto:admin@qhc.com">admin@qhc.com</a>]:</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 构建服务器端证书</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# ./build-key-server server</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Generating a 2048 bit RSA private key</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">..................+++</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">.............................................................................................................+++</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">writing new private key to 'server.key'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">-----</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">You are about to be asked to enter information that will be incorporated</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">into your certificate request.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">What you are about to enter is what is called a Distinguished Name or a DN.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">There are quite a few fields but you can leave some blank</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">For some fields there will be a default value,</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">If you enter '.', the field will be left blank.</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">-----</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Country Name (2 letter code) [PH]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">State or Province Name (full name) [Man]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Locality Name (eg, city) [Pas]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Organization Name (eg, company) [QHC]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Organizational Unit Name (eg, section) [OU_QHC]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Common Name (eg, your name or your server's hostname) [server]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Name [QhcEasyRSA]:</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Email Address [<a href="mailto:admin@qhc.com">admin@qhc.com</a>]:</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 0, 255);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Please enter the following 'extra' attributes</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">to be sent with your certificate request</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">A challenge password []:                         </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 直接回车</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#008000">An optional company name []:                      </font><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 直接回车</font></span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Using configuration from /usr/local/share/easy-rsa/openssl-1.0.0.cnf</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Check that the request matches the signature</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Signature ok</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">The Subject's Distinguished Name is as follows</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">countryName           :PRINTABLE:'PH'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">stateOrProvinceName   :PRINTABLE:'Man'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">localityName          :PRINTABLE:'Pas'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">organizationName      :PRINTABLE:'QHC'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">organizationalUnitName:T61STRING:'OU_QHC'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">commonName            :PRINTABLE:'server'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">name                  :PRINTABLE:'QhcEasyRSA'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">emailAddress          :IA5STRING:'<a href="mailto:admin@qhc.com">admin@qhc.com</a>'</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Certificate is to be certified until Jul 20 03:44:03 2028 GMT (3650 days)</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Sign the certificate? [y/n]:y</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 0, 255);"/></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 0, 255);"/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">1 out of 1 certificate requests certified, commit? [y/n]y</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Write out database with 1 new entries</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Data Base Updated</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]#</span></div><div><br/></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 生成信息交流文件</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# ./build-dh</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">Generating DH parameters, 2048 bit long safe prime, generator 2</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">This is going to take a long time</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">......................................................................................................................</span></div><div><font color="#008000" face="DejaVu Sans Mono">省略多行</font></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">..................+.................................................................+.........+.....+.++*++*</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]#</span></div></div><div><br/></div><div>生成客户端文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">[root@qhc easy-rsa]# ./build-key client</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Generating a 2048 bit RSA private key</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">..............+++</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">.....................................+++</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">writing new private key to 'client.key'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">-----</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">You are about to be asked to enter information that will be incorporated</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">into your certificate request.</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">What you are about to enter is what is called a Distinguished Name or a DN.</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">There are quite a few fields but you can leave some blank</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">For some fields there will be a default value,</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">If you enter '.', the field will be left blank.</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">-----</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Country Name (2 letter code) [PH]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">State or Province Name (full name) [Man]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Locality Name (eg, city) [Pas]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Organization Name (eg, company) [QHC]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Organizational Unit Name (eg, section) [OU_QHC]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Common Name (eg, your name or your server's hostname) [client]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Name [QhcEasyRSA]:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Email Address [</span><a href="mailto:admin@qhc.com" style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">admin@qhc.com</a><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">]:</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Please enter the following 'extra' attributes</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">to be sent with your certificate request</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">A challenge password []:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">An optional company name []:</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Using configuration from /usr/local/share/easy-rsa/openssl-1.0.0.cnf</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Check that the request matches the signature</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Signature ok</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">The Subject's Distinguished Name is as follows</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">countryName           :PRINTABLE:'PH'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">stateOrProvinceName   :PRINTABLE:'Man'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">localityName          :PRINTABLE:'Pas'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">organizationName      :PRINTABLE:'QHC'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">organizationalUnitName:T61STRING:'OU_QHC'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">commonName            :PRINTABLE:'client'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">name                  :PRINTABLE:'QhcEasyRSA'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">emailAddress          :IA5STRING:'</span><a href="mailto:admin@qhc.com" style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">admin@qhc.com</a><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">'</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Certificate is to be certified until Jul 20 03:49:05 2028 GMT (3650 days)</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Sign the certificate? [y/n]:y</span></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div><br style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);"/></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">1 out of 1 certificate requests certified, commit? [y/n]y</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Write out database with 1 new entries</span></div><div><span style="font-family: DejaVu Sans Mono; font-size: 9pt; color: rgb(0, 128, 0);">Data Base Updated</span></div></div><div><br/></div><div>防止被攻击，生成ta.key</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# openvpn --genkey --secret ./keys/ta.key</span></div></div><div><br/></div><div><br/></div><div>配置openvpn，修改openvpn配置文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 创建配置文件存放路径</font></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost easy-rsa]# mkdir /etc/openvpn</span></div><div><br/></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 拷贝证书文件</font></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc easy-rsa]# cp keys/ca.crt keys/dh2048.pem keys/server.crt <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">keys/server.key</span> <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">keys/ta.key</span> /etc/openvpn/</span></div><div><br/></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font style="color: rgb(0, 0, 255);"># 修改配置</font></span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc openvpn]# cd /etc/openvpn/</span></div><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@localhost openvpn]# cp /usr/local/openvpn/openvpn-2.4.2/sample/sample-config-files/server.conf .</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc openvpn]# cat server.conf |grep -v ^# |grep -v ^$</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;local a.b.c.d         <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 指定监听的ip地址，命令式可选的，默认监听所有ip地址</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">port 11941             <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: #0000ff;"># 监听端口</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">proto tcp              <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: #0000ff;"># 监听协议</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;proto udp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;dev tap</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">dev tun                <span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt; color: #0000ff;"># 路由模式</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;dev-node MyTap</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ca /etc/openvpn/ca.crt    <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># ca证书存放路径</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cert /etc/openvpn/server.crt <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 服务器证书存放位置</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">key /etc/openvpn/server.key  # This file should be kept secret <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 服务器秘钥存放位置</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">dh /etc/openvpn/dh2048.pem     <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># dh2048.pem存放路径</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;topology subnet</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;server 10.8.0.0 255.255.255.0</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">server 192.168.1.0 255.255.255.0      <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 虚拟局域网网段，客户端分配的ip地址</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ifconfig-pool-persist ipp.txt         <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 在openvpn重启时，再次连接客户端将依然分配和以前一样的ip地址</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;server-bridge</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;route 192.168.10.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;route 192.168.20.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.11.0 255.255.255.0&quot;     <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># vpn路由</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.12.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.13.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.14.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.15.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.16.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;route 172.30.17.0 255.255.255.0&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;client-config-dir ccd</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;route 192.168.40.128 255.255.255.248</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;client-config-dir ccd</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;route 10.9.0.0 255.255.255.252</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;learn-address ./script</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;redirect-gateway def1 bypass-dhcp&quot;     <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 客户端所有网络通信走vpn，这个可选，如果注释掉就是本地的数据包还是走本地，不会强制走vpn</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;dhcp-option DNS 208.67.222.222&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;dhcp-option DNS 208.67.220.220&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;dhcp-option DNS 8.8.8.8&quot;              <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 指定客户端使用的主dns</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">push &quot;dhcp-option DNS 8.8.4.4&quot;              <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 指定客户端使用的备dns</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">client-to-client                       <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 开启客户端互访</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;duplicate-cn</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">keepalive 10 120                    <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 服务端10秒监控一次，如果120秒没响应就认定客户端down了</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">tls-auth /etc/openvpn/ta.key 0      <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 防ddos攻击，服务端设置0，客户端设置1</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;cipher AES-256-CBC</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;compress lz4-v2</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;push &quot;compress lz4-v2&quot;</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">comp-lzo               <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 允许数据压缩</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">max-clients 100       <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 最大客户端并发连接数</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">user nobody         <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 运行openvpn的用户</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">group nobody        <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 运行openvpn的组</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">persist-key         <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 通过keepalive检测超时后，重启vpn，不重新读取keys，保留第一次使用的keys</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">persist-tun         <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;">通过keepalive检测超时后，重启vpn，一直保持tun或者tap设备是linkup的</span></span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">status /var/log/openvpn-status.log    <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 日志</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;log         openvpn.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;log-append  openvpn.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">log-append  /var/log/openvpn.log</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">verb 3              <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 日志级别，0-9依次升高</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;mute 20            <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 相同信息的日志，如果连续出现超过20条，将不再记录到日志中</span></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;explicit-exit-notify 1</span></div></div><div><br/></div><div><br/></div><div>启动openvpn</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"><span style="min-height: 10pt; font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc openvpn]# </span>/usr/local/sbin/openvpn --config /etc/openvpn/server.conf --daemon     <span style="font-family: &quot;DejaVu Sans Mono&quot;; color: #0000ff; font-size: 9pt; min-height: 10pt;"># 以守护进程运行</span></span></div></div><div><br/></div><div><br/></div><div>防火墙配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc log]# iptables-save</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># Generated by iptables-save v1.4.7 on Wed Jul 11 17:09:50 2018</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*nat</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:PREROUTING ACCEPT [5182:294339]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:POSTROUTING ACCEPT [39:4935]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:OUTPUT ACCEPT [38:4875]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;;color: rgb(0, 128, 0);font-size: 9pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">-A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">COMMIT</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># Completed on Wed Jul 11 17:09:50 2018</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># Generated by iptables-save v1.4.7 on Wed Jul 11 17:09:50 2018</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">*filter</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:INPUT ACCEPT [22137:4083497]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:FORWARD ACCEPT [24742:13099439]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">:OUTPUT ACCEPT [21664:13568554]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">COMMIT</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;"># Completed on Wed Jul 11 17:09:50 2018</span></div></div><div><br/></div><div>客户端配置</div><div>客户端安装包</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><a href="http://download.informer.com/win-1191558865-7a2d573e-54490f3b/openvpn-install-2.4.6-i602.exe" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http://download.informer.com/win-1191558865-7a2d573e-54490f3b/openvpn-install-2.4.6-i602.exe</a></div></div><div><br/></div><div><span style="color: rgb(51, 51, 51);"><font style="font-size: 10pt;">客户端需要ca.crt、clent.crt、client.key、client.conf、ta.key五个文件，放在客户端的安装目录下</font></span></div><div><span style="color: rgb(51, 51, 51);"><font style="font-size: 10pt;">client.crt、client.key需要服务端生成文件，再复制到客户端</font></span></div><div><span style="color: rgb(51, 51, 51);"><font style="font-size: 10pt;">client.conf文件需要修改配置，包括服务端IP地址及端口号，证书名字</font></span></div><div><span style="color: rgb(51, 51, 51);"><font style="font-size: 10pt;">三个client文件需要生成修改，ca.crt、ta.crt不需要更改</font></span></div><div><br/></div><div>安装完配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">[root@qhc openvpn]# cat client.conf |grep -v ^# |grep -v ^$</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">client</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;dev tap</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">dev tun</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;dev-node MyTap</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">proto tcp</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">remote 122.55.247.6 1194         </span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 修改服务器地址和端口</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;remote my-server-2 1194</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;remote-random</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">resolv-retry infinite</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">nobind</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;user nobody</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;group nobody</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">persist-key</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">persist-tun</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;http-proxy-retry # retry on connection failures</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;http-proxy [proxy server] [proxy port #]</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;mute-replay-warnings</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">ca ca.crt                         </span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-size: 9pt;"><font color="#0000FF"># 在服务端生成文件后，拷贝到客户端</font></span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">cert client.crt</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">key client.key</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;remote-cert-tls server</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">tls-auth ta.key 1</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;cipher AES-256-CBC</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">comp-lzo</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">verb 3</span></div><div><span style="font-family: &quot;DejaVu Sans Mono&quot;; color: rgb(0, 128, 0); font-size: 9pt;">;mute 20</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><br/></div><div><br/></div><div>添加客户端流程</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">客户端需要ca.crt、clent.crt、client.key、client.conf、ta.key五个文件，放在客户端的安装目录下</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">client.crt、client.key需要服务端生成文件，再复制到客户端</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">client.conf文件需要修改配置，包括服务端IP地址及端口号，证书名字</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">三个client文件需要生成修改，ca.crt、ta.crt不需要更改</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">生成证书命令：</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[root@qhc ~]# cd /etc/openvpn/easy-rsa/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[root@qhc easy-rsa]# source vars         </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">NOTE: If you run ./clean-all, I will be doing a rm -rf on /etc/openvpn/easy-rsa/keys          ##千万不要执行./client-all，否则之前的证书全都没了</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">[root@qhc easy-rsa]# ./build-key client3  ##名字需要唯一，到./keys目录中查看</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Generating a 2048 bit RSA private key</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.......+++</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">..+++</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">writing new private key to 'client3.key'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">-----</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">You are about to be asked to enter information that will be incorporated</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">into your certificate request.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">What you are about to enter is what is called a Distinguished Name or a DN.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">There are quite a few fields but you can leave some blank</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">For some fields there will be a default value,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">If you enter '.', the field will be left blank.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">-----</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Country Name (2 letter code) [PH]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">State or Province Name (full name) [Man]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Locality Name (eg, city) [Pas]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Organization Name (eg, company) [QHC]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Organizational Unit Name (eg, section) [OU_QHC]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Common Name (eg, your name or your server's hostname) [client3]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Name [QhcEasyRSA]:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Email Address [</span><a href="mailto:admin@qhc.com" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">admin@qhc.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">]:</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Please enter the following 'extra' attributes</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">to be sent with your certificate request</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">A challenge password []:                          ##直接回车</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">An optional company name []:                      ##直接回车</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Using configuration from /etc/openvpn/easy-rsa/openssl-1.0.0.cnf</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Check that the request matches the signature</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Signature ok</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">The Subject's Distinguished Name is as follows</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">countryName           :PRINTABLE:'PH'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">stateOrProvinceName   :PRINTABLE:'Man'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">localityName          :PRINTABLE:'Pas'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">organizationName      :PRINTABLE:'QHC'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">organizationalUnitName:T61STRING:'OU_QHC'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">commonName            :PRINTABLE:'client3'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">name                  :PRINTABLE:'QhcEasyRSA'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">emailAddress          :IA5STRING:'</span><a href="mailto:admin@qhc.com" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">admin@qhc.com</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Certificate is to be certified until Jul  6 08:22:17 2028 GMT (3650 days)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Sign the certificate? [y/n]:y                              ##按y</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">1 out of 1 certificate requests certified, commit? [y/n]y   ##按y</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Write out database with 1 new entries</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Data Base Updated</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">##生成的证书在./keys中</span></div></div><div><br/></div><div><br/></div><div><br/></div><div>参考：</div><div><a href="https://www.dwhd.org/20160614_044415.html">https://www.dwhd.org/20160614_044415.html</a></div><div><a href="https://www.cnblogs.com/kl876435928/p/7155354.html">https://www.cnblogs.com/kl876435928/p/7155354.html</a></div><div><a href="https://www.jb51.net/article/108590.htm">https://www.jb51.net/article/108590.htm</a></div><div><a href="https://www.linuxprobe.com/centos6-setup-openvpn.html">https://www.linuxprobe.com/centos6-setup-openvpn.html</a></div><div><br/></div><div><br/></div></span>
</div></body></html> 