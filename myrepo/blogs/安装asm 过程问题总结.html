<html>
<head>
  <title>安装asm 过程问题总结</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="409"/>
<h1>安装asm 过程问题总结</h1>

<div>
<span><div>安装asm 过程问题总结</div><div>0. 关闭防火墙</div><div><br/></div><div>查看SELinux状态：</div><div>1、/usr/sbin/sestatus -v      ##如果SELinux status参数为enabled即为开启状态</div><div>SELinux status:                 enabled</div><div>vi /etc/selinux/config</div><div>将SELINUX=enforcing改为SELINUX=disabled</div><div><br/></div><div><br/></div><div><br/></div><div>2. 准备好Grid 用户及相关group。创建grid使用的目录</div><div><br/></div><div>/usr/sbin/groupadd -g 502 dba</div><div>/usr/sbin/groupadd -g 503 oinstall</div><div>/usr/sbin/groupadd -g 504 asmadmin</div><div>/usr/sbin/groupadd -g 505 asmoper</div><div>/usr/sbin/groupadd -g 506 asmdba</div><div>useradd -g oinstall -G asmdba,asmadmin,asmoper,dba grid</div><div>passwd grid</div><div><br/></div><div>[root@pass ~]# id grid</div><div>uid=501(grid) gid=500(oinstall) groups=500(oinstall),501(dba),504(asmadmin),505(asmoper),506(asmdba)</div><div><br/></div><div><br/></div><div>mkdir -p /oracle/grid/</div><div>mkdir -p /oracle/grid/gridhome</div><div><br/></div><div>mkdir -p grid:oinstall /opt/11g/oraInventory</div><div>chown -R grid:oinstall /oracle/grid/gridhome</div><div>chown -R grid:oinstall /oracle/grid/</div><div>chmod -R 775 /oracle/grid/  /oracle/grid/gridhome</div><div>chown -R grid:oinstall /opt/11g/oraInventory</div><div><br/></div><div>mkdir -p /oracle/11g/gridhome</div><div>chown -R grid:oinstall /oracle/11g/gridhome</div><div>chmod -R 775  /oracle/11g/gridhome</div><div><br/></div><div>3.配置grid 用户环境变量。</div><div><br/></div><div>vi .bash_profile</div><div><br/></div><div>TMP=/tmp; export TMP</div><div>TMPDIR=$TMP; export TMPDIR</div><div>ORACLE_BASE=/oracle/grid; export ORACLE_BASE</div><div>ORACLE_HOME=/oracle/11g/gridhome; export ORACLE_HOME</div><div>GRID_HOME=/oracle/11g/gridhome; export GRID_HOME</div><div>ORACLE_SID=+asm; export ORACLE_SID</div><div>ORACLE_TERM=xterm; export ORACLE_TERM</div><div>PATH=$GRID_HOME/bin:/usr/sbin:$PATH; export PATH</div><div>LD_LIBRARY_PATH=$GRID_HOME/lib:/lib:/usr/lib;</div><div>export LD_LIBRARY_PATH</div><div>CLASSPATH=$GRID_HOME/JRE:$GRID_HOME/jlib:$GRID_HOME/rdbms/jlib;</div><div>export CLASSPATH</div><div>if [ $USER = &quot;oracle&quot; ]; then</div><div>if [ $SHELL = &quot;/bin/ksh&quot; ]; then</div><div>ulimit -p 16384</div><div>ulimit -n 65536</div><div>else</div><div>ulimit -u 16384 -n 65536</div><div>fi</div><div>fi</div><div>umask 022</div><div><br/></div><div>4. 绑定的磁盘， 需要分区，但不需要格式。</div><div><br/></div><div>为什么要使用asm绑定磁盘</div><div>对于Oracle自动存储管理（ASM）所使用的磁盘，它需要能够识别他们，需要有正确的拥有组和读写权限,</div><div>所以使用UDEV绑定磁盘主要是用来解决这些问题的，在Linux中，你可以使用ASMLib程序来管理这些任务，</div><div>但它被看作是一个复杂的附加层，从来没有真正得到任何流行。相反，许多人使用Linux的设备管理器UDEV来来代替ASMLIB。</div><div><br/></div><div>ASMlib --orcle 2011 oracle该pkg已经不对rhel进行更新维护</div><div><br/></div><div>[root@pass dev]# cat /etc/issue</div><div>Oracle Linux Server release 6.7</div><div>Kernel \r on an \m</div><div><br/></div><div>#添加记录到/etc/scsi_id.config</div><div><br/></div><div>[root@pass dev]# echo &quot;options=--whitelisted --replace-whitespace&quot;  &gt;&gt; /etc/scsi_id.config</div><div>[root@pass ~]# cat /etc/scsi_id.config</div><div>options=--whitelisted --replace-whitespace</div><div><br/></div><div><br/></div><div>#确认哪些块设备需要udev绑定</div><div><br/></div><div>[root@pass dev]# ls -ltr /dev/sd*</div><div>brw-rw----. 1 root disk 8,  0 Dec  1 06:11 /dev/sda</div><div>brw-rw----. 1 root disk 8,  2 Dec  1 06:11 /dev/sda2</div><div>brw-rw----. 1 root disk 8,  1 Dec  1 06:11 /dev/sda1</div><div>brw-rw----. 1 root disk 8, 16 Dec  1 06:16 /dev/sdb</div><div>brw-rw----. 1 root disk 8, 17 Dec  1 06:16 /dev/sdb1</div><div>brw-rw----. 1 root disk 8, 32 Dec  1 06:17 /dev/sdc</div><div>brw-rw----. 1 root disk 8, 33 Dec  1 06:17 /dev/sdc1</div><div><br/></div><div>#将 b-&gt;c的编号放入for 循环中，例如：</div><div><br/></div><div>for i in b c ;</div><div>do</div><div>echo &quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/\$name\&quot;, RESULT==\&quot;`/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sd$i`\&quot;, NAME=\&quot;asm-disk$i\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot;      &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</div><div>done</div><div><br/></div><div><br/></div><div>[root@pass dev]# for i in b c d e;</div><div>do</div><div>echo &quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/\$name\&quot;, RESULT==\&quot;`/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sd$i`\&quot;, NAME=\&quot;asm-disk$i\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot; &gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</div><div>done</div><div><br/></div><div>[root@pass dev]# cat /etc/udev/rules.d/99-oracle-asmdevices.rules</div><div><br/></div><div>KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;1ATA_VBOX_HARDDISK_VBb08aa317-4d5276fa&quot;, NAME=&quot;asm-diskb&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;asmadmin&quot;, MODE=&quot;0660&quot;</div><div>KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;1ATA_VBOX_HARDDISK_VBc6849284-6467554d&quot;, NAME=&quot;asm-diskc&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;asmadmin&quot;, MODE=&quot;0660&quot;</div><div><br/></div><div>#root运行/sbin/start_udev  (may take some time)</div><div><br/></div><div>[root@pass dev]# /sbin/start_udev</div><div>Starting udev:                                                           [  OK  ]</div><div><br/></div><div>[root@pass ~]# /sbin/start_udev</div><div>Starting udev:</div><div>udevadm settle - timeout of 180 seconds reached, the event queue contains:</div><div>  /sys/devices/system/memory/memory4 (1756)</div><div>  /sys/devices/system/memory/memory5 (1757)</div><div>  /sys/devices/system/memory/memory6 (1758)</div><div>  /sys/devices/system/memory/memory7 (1759)</div><div>  /sys/devices/system/memory/memory9 (1761)</div><div>                                                           [  OK  ]</div><div><br/></div><div><br/></div><div>[root@pass dev]# ls -ltr /dev/asm-disk*  --注意权限！</div><div>brw-rw----. 1 grid asmadmin 8, 17 Dec  1 06:59 /dev/asm-diskb</div><div>brw-rw----. 1 grid asmadmin 8, 33 Dec  1 06:59 /dev/asm-diskc</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>5. 上传 Grid infrastructure 到服务器并解压 SCP linux.x64_11gR2_grid.zip</div><div><br/></div><div>6. 切换到grid 用户，运行runinstaller 按照Grid infrastructure stand alone</div><div><br/></div><div>&lt;oracle_11g_asm_grid_install.pdf&gt;</div><div><br/></div><div>Oracle Grid Infrastructure for a Standalone Server</div><div><a href="http://docs.oracle.com/cd/E11882_01/install.112/e47689/oraclerestart.htm#LADBI999">http://docs.oracle.com/cd/E11882_01/install.112/e47689/oraclerestart.htm#LADBI999</a></div><div><br/></div><div>If you plan to use Oracle Restart or Oracle Automatic Storage Management (Oracle ASM),</div><div>then you must install Oracle Grid Infrastructure before you install and create the database.</div><div>Oracle Grid Infrastructure for a standalone server is the software that includes Oracle Restart and Oracle ASM.</div><div>Oracle combines the two infrastructure products into a single set of binaries that is installed as the Oracle Grid Infrastructure home.</div><div><br/></div><div><br/></div><div>Enter the full pathname of the local bin directory: [/usr/local/bin]:</div><div>   Copying dbhome to /usr/local/bin ...</div><div>   Copying oraenv to /usr/local/bin ...</div><div>   Copying coraenv to /usr/local/bin ...</div><div><br/></div><div><br/></div><div>Creating /etc/oratab file...</div><div>Entries will be added to the /etc/oratab file as needed by</div><div>Database Configuration Assistant when a database is created</div><div>Finished running generic part of root script.</div><div>Now product-specific root actions will be performed.</div><div><br/></div><div>To configure Grid Infrastructure for a Stand-Alone Server run the following command as the root user:</div><div>/oracle/gridhome/perl/bin/perl -I/oracle/gridhome/perl/lib -I/oracle/gridhome/crs/install /oracle/gridhome/crs/install/roothas.pl</div><div><br/></div><div><br/></div><div>To configure Grid Infrastructure for a Cluster execute the following command:</div><div>/oracle/gridhome/crs/config/config.sh</div><div>This command launches the Grid Infrastructure Configuration Wizard. The wizard also supports silent operation, and the parameters can be passed through the response file that is available in the installation media.</div><div><br/></div><div><br/></div><div>[root@pass ~]# /oracle/gridhome/perl/bin/perl  -I/oracle/gridhome/perl/lib -I/oracle/gridhome/crs/install /oracle/gridhome/crs/install/roothas.pl</div><div>Using configuration parameter file: /oracle/gridhome/crs/install/crsconfig_params</div><div>Creating trace directory</div><div>User ignored Prerequisites during installation</div><div>LOCAL ADD MODE</div><div>Creating OCR keys for user 'grid', privgrp 'oinstall'..</div><div>Operation successful.</div><div>LOCAL ONLY MODE</div><div>Successfully accumulated necessary OCR keys.</div><div>Creating OCR keys for user 'root', privgrp 'root'..</div><div>Operation successful.</div><div>CRS-4664: Node pass successfully pinned.</div><div>Adding Clusterware entries to upstart</div><div><br/></div><div>pass     2016/03/18 19:48:23     /oracle/gridhome/cdata/pass/backup_20160318_194823.olr</div><div>Successfully configured Oracle Grid Infrastructure for a Standalone Server</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>执行root.sh时ohasd启动失</div><div><a href="http://www.vydbs.com/failed-executing-root-sh-ohasd-start-the-solution/">http://www.vydbs.com/failed-executing-root-sh-ohasd-start-the-solution/</a></div><div>Adding daemon to inittab</div><div>CRS-4124: Oracle High Availability Services startup failed.</div><div>CRS-4000: Command Start failed, or completed with errors.</div><div>ohasd failed to start: Inappropriate ioctl for device</div><div>ohasd failed to start: Inappropriate ioctl for device at /oracle/11g/grid/crs/install/roothas.pl line 296.</div><div><br/></div><div><br/></div><div>1） /oracle/11g/grid/crs/install/roothas.pl -deconfig -force -verbose   回退</div><div>2） 在执行root.sh脚本时出现Adding daemon to inittab的时候，使用root立即执行命令：</div><div><br/></div><div>/bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1 &amp;</div><div><br/></div><div>3） vi /etc/init/oracle-ohasd.conf</div><div><br/></div><div># Oracle OHASD startup</div><div>start on runlevel [35]</div><div>stop on runlevel [!35]</div><div>respawn</div><div>exec /etc/init.d/init.ohasd run &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</div><div><br/></div><div><br/></div><div><br/></div><div>/oracle/11g/grid/root.sh 配置成功</div><div>Successfully configured Oracle Grid Infrastructure for a Standalone Server</div><div>Updating inventory properties for clusterware</div><div>Starting Oracle Universal Installer...</div><div><br/></div><div>Checking swap space: must be greater than 500 MB.   Actual 2997 MB    Passed</div><div>The inventory pointer is located at /etc/oraInst.loc</div><div>The inventory is located at /opt/11g/oraInventory</div><div><br/></div><div><br/></div><div>ASM 配置使用手动配置，failed ignore，查看日志文件（缺少pfile）</div><div><br/></div><div><br/></div><div>7.编辑ASM pfile 启动ASM instance</div><div><br/></div><div>vi $GRID_HOME/dbs/init+asm.ora</div><div><br/></div><div><br/></div><div>*.asm_power_limit=1</div><div>*.instance_type='asm'</div><div>*.large_pool_size=12M</div><div>*.remote_login_passwordfile='EXCLUSIVE'</div><div><br/></div><div><br/></div><div><br/></div><div>8.启动ASM intance， 检查asm_diskstring是否正确。 （启动ASM，前需要先启动ora.cssd）</div><div><br/></div><div>[grid@pass ~]$ sqlplus / as sysasm</div><div><br/></div><div>SQL*Plus: Release 11.2.0.1.0 Production on Fri Dec 4 01:59:39 2015</div><div><br/></div><div>Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div><br/></div><div>Connected to an idle instance.</div><div><br/></div><div>SQL&gt; strartup nomount</div><div>SP2-0734: unknown command beginning &quot;strartup n...&quot; - rest of line ignored.</div><div>SQL&gt; startup nomount</div><div>ORA-01078: failure in processing system parameters</div><div>ORA-29701: unable to connect to Cluster Synchronization Service</div><div>SQL&gt;</div><div><br/></div><div><br/></div><div>[grid@pass ~]$  crs_stat -t</div><div>Name           Type           Target    State     Host</div><div>------------------------------------------------------------</div><div>ora....ER.lsnr ora....er.type ONLINE    OFFLINE</div><div>ora.cssd       ora.cssd.type  OFFLINE   OFFLINE</div><div>ora.diskmon    ora....on.type OFFLINE   OFFLINE</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>[grid@pass ~]$ crsctl start resource ora.cssd</div><div>CRS-2672: Attempting to start 'ora.cssd' on 'pass'</div><div>CRS-2672: Attempting to start 'ora.diskmon' on 'pass'</div><div>CRS-2676: Start of 'ora.diskmon' on 'pass' succeeded</div><div>CRS-2676: Start of 'ora.cssd' on 'pass' succeeded</div><div><br/></div><div>[grid@pass ~]$ ps -ef |grep -i cssd</div><div>grid     32492     1  0 02:04 ?        00:00:00 /oracle/11g/grid/bin/cssdagent</div><div>grid     32526     1  1 02:04 ?        00:00:00 /oracle/11g/grid/bin/ocssd.bin</div><div>grid     32557 31746  0 02:04 pts/3    00:00:00 grep -i cssd</div><div><br/></div><div><br/></div><div>[grid@pass ~]$ crs_stat -t</div><div>Name           Type           Target    State     Host</div><div>------------------------------------------------------------</div><div>ora....ER.lsnr ora....er.type ONLINE    OFFLINE</div><div>ora.cssd       ora.cssd.type  ONLINE    ONLINE    pass</div><div>ora.diskmon    ora....on.type ONLINE    ONLINE    pass</div><div><br/></div><div><br/></div><div>必须启动lsnr才能提供asm服务</div><div><br/></div><div>orapwd file=orapw+asm password=Passw0rd</div><div><br/></div><div><br/></div><div>[grid@pass ~]$ lsnrctl start</div><div><br/></div><div>LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 04-DEC-2015 02:05:26</div><div><br/></div><div>Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div><br/></div><div>Starting /oracle/11g/grid/bin/tnslsnr: please wait...</div><div><br/></div><div>TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div>System parameter file is /oracle/11g/grid/network/admin/listener.ora</div><div>Log messages written to /oracle/11g/diag/tnslsnr/pass/listener/alert/log.xml</div><div>Error listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div>TNS-12555: TNS:permission denied</div><div>TNS-12560: TNS:protocol adapter error</div><div>  TNS-00525: Insufficient privilege for operation</div><div>   Linux Error: 1: Operation not permitted</div><div><br/></div><div>su - root</div><div>chown -R grid:oinstall /var/tmp/.oracle</div><div><br/></div><div><br/></div><div>SID_LIST_LISTENER =</div><div>    (SID_LIST =</div><div>    (SID_DESC =</div><div>        (SID_NAME = +asm)</div><div>        (ORACLE_HOME = /u01/app/oracle/product/10.2.0/db_1)</div><div>        (PROGRAM = extproc)</div><div>    )</div><div>    )</div><div>   </div><div>lsnrctl start --OK</div><div><br/></div><div>[grid@pass ~]$ crs_stat -t</div><div>Name           Type           Target    State     Host</div><div>------------------------------------------------------------</div><div>ora....ER.lsnr ora....er.type ONLINE    ONLINE    pass</div><div>ora.cssd       ora.cssd.type  ONLINE    ONLINE    pass</div><div>ora.diskmon    ora....on.type ONLINE    ONLINE    pass</div><div><br/></div><div><br/></div><div>sqlplus / as sysasm ==》 注意要使用sysasm</div><div>or</div><div>ASMCMD&gt; startup nomount</div><div><br/></div><div><br/></div><div>[grid@pass ~]$ sqlplus / as sysasm   </div><div><br/></div><div>SQL&gt; startup nomount</div><div>ASM instance started</div><div><br/></div><div>Total System Global Area  283930624 bytes</div><div>Fixed Size                  2212656 bytes</div><div>Variable Size             256552144 bytes</div><div>ASM Cache                  25165824 bytes</div><div><br/></div><div><br/></div><div><br/></div><div>SQL&gt; show parameter asm_diskstring;</div><div><br/></div><div>NAME                                 TYPE        VALUE</div><div>------------------------------------ ----------- ------------------------------</div><div>asm_diskstring                       string</div><div><br/></div><div>[grid@pass dbs]$ cat init+asm.ora</div><div><br/></div><div>*.asm_power_limit=1</div><div>*.instance_type='asm'</div><div>*.remote_login_passwordfile='EXCLUSIVE'</div><div>*.asm_diskstring='/dev/asm-disk*'</div><div><br/></div><div><br/></div><div><br/></div><div>SQL&gt; show parameter asm_diskstring;</div><div><br/></div><div>NAME                                 TYPE        VALUE</div><div>------------------------------------ ----------- ------------------------------</div><div>asm_diskstring                       string      /dev/asm-disk*</div><div><br/></div><div>SQL&gt; col path for a50</div><div><br/></div><div>SQL&gt; select path, mode_status, state from v$asm_disk;</div><div><br/></div><div>PATH                                     MODE_ST STATE</div><div>---------------------------------------- ------- --------</div><div>/dev/asm-diskc                           ONLINE  NORMAL</div><div>/dev/asm-diskb                           ONLINE  NORMAL</div><div><br/></div><div><br/></div><div>                    </div><div>                    </div><div><br/></div><div><br/></div><div>9.创建Disk group</div><div><br/></div><div>create diskgroup DG1 normal redundancy</div><div>failgroup f1 disk '/dev/asm-diskb'</div><div>failgroup f2 disk '/dev/asm-diskc';</div><div><br/></div><div><br/></div><div><br/></div><div>SQL&gt; create diskgroup DG1 normal redundancy</div><div>failgroup f1 disk '/dev/asm-diskb'</div><div>failgroup f2 disk '/dev/asm-diskc';  2    3</div><div><br/></div><div>Diskgroup created.</div><div><br/></div><div><br/></div><div><br/></div><div>SQL&gt; select name, state, type, total_mb, free_mb from v$asm_diskgroup;</div><div><br/></div><div>NAME                           STATE       TYPE     TOTAL_MB    FREE_MB</div><div>------------------------------ ----------- ------ ---------- ----------</div><div>DG1                            MOUNTED     NORMAL       8188       8086</div><div><br/></div><div><br/></div><div>SQL&gt; shutdown</div><div>ASM diskgroups dismounted</div><div>ASM instance shutdown</div><div><br/></div><div><br/></div><div>vi $ORACLE_HOME/dbs/init+asm.ora</div><div>*.asm_diskstring='/dev/asm-disk*'</div><div>*.asm_diskgroups='DG1'</div><div>*.asm_power_limit=1</div><div>*.instance_type='asm'</div><div>*.remote_login_passwordfile='EXCLUSIVE'</div><div><br/></div><div><br/></div><div>SQL&gt; create  spfile from pfile;</div><div>create  spfile from pfile</div><div>*</div><div>ERROR at line 1:</div><div>ORA-29786: SIHA attribute GET failed with error [Attribute 'SPFILE' sts[200]</div><div>lsts[0]]</div><div><br/></div><div>#产生这个问题的原因为ORACLE认为ASM实例是手工创建的，并没有注册这个资源,那么首先增加ASM资源.需要使用下面命令注册asm</div><div><br/></div><div><br/></div><div>srvctl add listener -l LISTENER -o /oracle/11g/gridhome</div><div>srvctl add asm -l LISTENER -d '/dev/asm-disk*'</div><div><br/></div><div>[grid@pass ~]$ srvctl add asm -l LISTENER -d '/dev/asm-disk*'</div><div>PRCR-1001 : Resource ora.LISTENER.lsnr does not exist</div><div><br/></div><div><br/></div><div><br/></div><div>[grid@pass dbs]$ sqlplus / as sysasm</div><div><br/></div><div>SQL*Plus: Release 11.2.0.1.0 Production on Fri Dec 4 02:23:06 2015</div><div><br/></div><div>Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div><br/></div><div>Connected to an idle instance.</div><div><br/></div><div>SQL&gt; startup</div><div>ASM instance started</div><div><br/></div><div>Total System Global Area  283930624 bytes</div><div>Fixed Size                  2212656 bytes</div><div>Variable Size             256552144 bytes</div><div>ASM Cache                  25165824 bytes</div><div>ASM diskgroups mounted                           ====&gt; mounted!</div><div><br/></div><div><br/></div><div>10. 切换到Oracle，手动创建instance 和databae</div><div><br/></div><div>cd  $ORACLE_HOME/dbs</div><div><br/></div><div>*.compatible='11.2.0.0.0'</div><div>*.control_files='+DATA/controlfile1/control01.ctl','+DATA/controlfile2/control02.ctl'</div><div>*.db_block_size=8192</div><div>*.db_domain='ocp'</div><div>*.db_name='orcl'</div><div>*.memory_target=924951296</div><div>*.remote_login_passwordfile='EXCLUSIVE'</div><div>*.undo_tablespace='UNDOTBS1'</div><div><br/></div><div><br/></div><div><br/></div><div>grid user</div><div>[grid@pass dbs]$ asmcmd mkdir +DG1/redo +DG1/oradata   =&gt;</div><div>[grid@pass dbs]$ asmcmd ls</div><div>DG1/</div><div>[grid@pass dbs]$ asmcmd ls DG1/</div><div>oradata/</div><div>redo/</div><div><br/></div><div>export ORACLE_SID=orcl</div><div>[oracle@pass dbs]$ id oracle</div><div>uid=500(oracle) gid=500(oinstall) groups=500(oinstall),501(dba)</div><div><br/></div><div>[root@pass ~]# usermod -g oinstall -G asmdba,asmadmin,dba,asmoper oracle</div><div>[root@pass ~]# id oracle</div><div>uid=500(oracle) gid=500(oinstall) groups=500(oinstall),501(dba),504(asmadmin),505(asmoper),506(asmdba)</div><div><br/></div><div><br/></div><div>sqlplus / as sysdba</div><div>idle&gt; startup nomount</div><div>ORACLE instance started.</div><div><br/></div><div>Total System Global Area  271400960 bytes</div><div>Fixed Size                  2212536 bytes</div><div>Variable Size             226495816 bytes</div><div>Database Buffers           37748736 bytes</div><div>Redo Buffers                4943872 bytes</div><div><br/></div><div>idle&gt; select name, state, type, total_mb, free_mb from v$asm_diskgroup;</div><div><br/></div><div>no rows selected</div><div><br/></div><div><br/></div><div><br/></div><div>create database orcl</div><div>CONTROLFILE REUSE</div><div>maxlogfiles 5</div><div>maxlogmembers 5</div><div>maxdatafiles 100</div><div>maxinstances 1</div><div>logfile</div><div>group 1 ('+DG_DATA/redo/redo1.log') size 10m,</div><div>group 2 ('+DG_DATA/redo/redo2.log') size 10m,</div><div>group 3 ('+DG_DATA/redo/redo3.log') size 10m</div><div>datafile</div><div>'+DG_DATA/oradata/system.dbf' size 200m reuse</div><div>sysaux datafile '+DG_DATA/oradata/sysaux.dbf' size 100m</div><div>default tablespace users datafile '+DG_DATA/oradata/userdata.dbf' size 100m</div><div>undo tablespace undotbs1 datafile '+DG_DATA/oradata/undo1.dbf' size 100m</div><div>default temporary tablespace temp1 tempfile '+DG_DATA/oradata/temp01.dbf' size 100m reuse</div><div>character set al32utf8</div><div>;</div><div><br/></div><div><br/></div><div>ERROR at line 1:</div><div>ORA-01501: CREATE DATABASE failed</div><div>ORA-00200: control file could not be created</div><div>ORA-00202: control file: '+dg1/control01.ctl'</div><div>ORA-17502: ksfdcre:3 Failed to create file +dg1/control01.ctl</div><div>ORA-15001: diskgroup &quot;dg1&quot; does not exist or is not mounted</div><div>ORA-15055: unable to connect to ASM instance</div><div>ORA-01031: insufficient privileges</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>[root@pass ~]# id oracle</div><div>uid=500(oracle) gid=500(oinstall) groups=500(oinstall),501(dba),504(asmadmin),505(asmoper),506(asmdba)</div><div><br/></div><div><br/></div><div><br/></div><div>alert.log</div><div>Additional information: 9</div><div>ORA-15025: could not open disk '/dev/asm-diskc'</div><div>ORA-27041: unable to open file</div><div>Linux-x86_64 Error: 13: Permission denied</div><div>Additional information: 9</div><div><br/></div><div><br/></div><div>-数据库建立成功，添加数据字典</div><div>idle&gt; edit /oracle/11g/post_create_orcl.sql</div><div><br/></div><div>@$ORACLE_HOME/rdbms/admin/catalog.sql</div><div>@$ORACLE_HOME/rdbms/admin/catproc.sql</div><div>@$ORACLE_HOME/sqlplus/admin/pupbld.sql</div><div><br/></div><div>sys@JAMES&gt; select name,open_mode from v$database;</div><div><br/></div><div>NAME                                OPEN_MODE</div><div>----------------------------------- --------------------</div><div>JAMES                               READ WRITE</div><div><br/></div><div><br/></div><div><br/></div><div>sys@JAMES&gt; select name, state, type, total_mb, free_mb from v$asm_diskgroup;</div><div><br/></div><div>NAME                                STATE       TYPE     TOTAL_MB    FREE_MB</div><div>----------------------------------- ----------- ------ ---------- ----------</div><div>DG1                                 CONNECTED   NORMAL       8188       6734</div><div><br/></div><div>sys@JAMES&gt; select group_number, name,failgroup, path from v$asm_disk;</div><div><br/></div><div>GROUP_NUMBER NAME                                FAILGROUP                      PATH</div><div>------------ ----------------------------------- ------------------------------ --------------------------------------------------</div><div>           1 DG1_0001                            F2                             /dev/asm-diskc</div><div>           1 DG1_0000                            F1                             /dev/asm-diskb</div><div><br/></div><div>select * from V$datafile</div><div><br/></div><div><br/></div><div><br/></div><div>ASMCMD&gt; ls -lt --reverse DG1</div><div>Type         Redund  Striped  Time             Sys  Name</div><div>                                               Y    JAMES/</div><div>                                               N    oradata/</div><div>                                               N    redo/</div><div>                                               N    control01.ctl =&gt; +DG1/JAMES/CONTROLFILE/Current.256.897304191</div><div>                                               N    control02.ctl =&gt; +DG1/JAMES/CONTROLFILE/Current.257.897304191</div><div>                                               </div><div>                                               </div><div>添加监听器信息</div><div><br/></div><div>SID_LIST_LISTENER =</div><div>(SID_LIST =</div><div>  (SID_DESC =</div><div>  (GLOBAL_DBNAME = james)</div><div>  (SID_NAME = james)</div><div>  )</div><div>)</div><div><br/></div><div><br/></div><div><br/></div><div>[grid@pass admin]$ cat listener.ora</div><div># listener.ora Network Configuration File: /oracle/11g/grid/network/admin/listener.ora</div><div># Generated by Oracle configuration tools.</div><div><br/></div><div>LISTENER =</div><div>  (DESCRIPTION_LIST =</div><div>    (DESCRIPTION =</div><div>      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</div><div>      (ADDRESS = (PROTOCOL = TCP)(HOST = pass.ocp)(PORT = 1521))</div><div>    )</div><div>  )</div><div><br/></div><div>ADR_BASE_LISTENER = /oracle/11g</div><div>SID_LIST_LISTENER =</div><div>(SID_LIST =</div><div>  (SID_DESC =</div><div>  (GLOBAL_DBNAME = james)</div><div>  (SID_NAME = james)</div><div>  )</div><div>)</div><div>  </div><div>show parameter service_name</div><div>  </div><div>  [grid@pass admin]$ lsnrctl status</div><div><br/></div><div>LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 04-DEC-2015 03:13:06</div><div><br/></div><div>Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div><br/></div><div>Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div>STATUS of the LISTENER</div><div>------------------------</div><div>Alias                     LISTENER</div><div>Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div>Start Date                04-DEC-2015 03:07:58</div><div>Uptime                    0 days 0 hr. 5 min. 8 sec</div><div>Trace Level               off</div><div>Security                  ON: Local OS Authentication</div><div>SNMP                      OFF</div><div>Listener Parameter File   /oracle/11g/grid/network/admin/listener.ora</div><div>Listener Log File         /oracle/11g/diag/tnslsnr/pass/listener/alert/log.xml</div><div>Listening Endpoints Summary...</div><div>  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div>  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=pass.ocp)(PORT=1521)))</div><div>Services Summary...</div><div>Service &quot;+asm&quot; has 1 instance(s).</div><div>  Instance &quot;+asm&quot;, status READY, has 1 handler(s) for this service...</div><div>Service &quot;james&quot; has 2 instance(s).</div><div>  Instance &quot;james&quot;, status UNKNOWN, has 1 handler(s) for this service...</div><div>  Instance &quot;james&quot;, status READY, has 1 handler(s) for this service...</div><div>The command completed successfully</div><div><br/></div><div>                    </div><div><br/></div><div>                    </div><div>[oracle@pass dbs]$ sqlplus sys/Passw0rd@192.168.56.101/james as sysdba</div><div><br/></div><div>SQL*Plus: Release 11.2.0.1.0 Production on Fri Dec 4 03:18:13 2015</div><div><br/></div><div>Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div><br/></div><div>ERROR:</div><div>ORA-01031: insufficient privileges</div><div><br/></div><div>[oracle@pass dbs]$ orapwd file=/oracle/11g/product/11.2.0/dbhome_1/dbs/orapwjames password=Passw0rd</div><div><br/></div><div>[oracle@pass dbs]$ ls -ltr /oracle/11g/product/11.2.0/dbhome_1/dbs/orapwjames</div><div>-rw-r-----. 1 oracle oinstall 1536 Dec  4 03:25 /oracle/11g/product/11.2.0/dbhome_1/dbs/orapwjames</div><div>                </div><div>[oracle@pass dbs]$ sqlplus sys/Passw0rd@192.168.56.101/james as sysdba</div><div><br/></div><div>SQL*Plus: Release 11.2.0.1.0 Production on Fri Dec 4 03:26:13 2015</div><div><br/></div><div>Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div><br/></div><div><br/></div><div>Connected to:</div><div>Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</div><div>With the Partitioning, Automatic Storage Management, OLAP, Data Mining</div><div>and Real Application Testing options</div><div><br/></div><div>sys@JAMES&gt;</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">[grid@pass ~]$ orapwd file=/oracle/11g/grid/dbs/orapw+asm password=Passw0rd</span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div>TNS-01190: The user is not authorized to execute the requested listener command</div><div>该错误出现由于grid和oracle只能同时使用一个用户来进行lsn的启停，用grid用户起的只能用grid停，oracle也是这样</div></span>
</div></body></html> 