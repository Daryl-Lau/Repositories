<html>
<head>
  <title>Nginx</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="388"/>
<h1>Nginx</h1>

<div>
<span><div>Nginx</div><div><br/></div><div><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Nginx只能对web和mail做负载均衡，只能针对80和25端口</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Apache 模块丰富，系统稳定，可移植性好，但比较耗资源</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Lighttpd 内存开销低，cpu占用率低，效能较好以及模块丰富</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Tomcat 开源，运行servlet和JSP Web软件的基于Java的web应用软件，但是他对静态文件，高并发的处理能力较弱，在制造行业用的较多</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">IBM WebSphere 市场份额较少</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Microsoft IIS 多应用于制造行业</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">http 反向代理 mail反向代理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">高并发连接，官方测试可支持5w并发量，实际3w左右</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">使用epoll和kqueue网络I/O模型</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">内存消耗小，开启10个Nginx进程消耗15M*10=150M内存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">支持负载均衡，反向代理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Nginx请求连接的方法</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">select模型，阻塞I/O</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">epoll模型，多路复用I/O，并发量更大，速度更快</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">安装Nginx</span><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75;"> </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">源码包安装</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">yum -y install gcc gcc-c++ autoconf automake</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">yum -y install zlib zlib-devel openssl openssl-devel pcre-devel</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">zlib：Nginx提供gzip模块，需zli库支持</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">openssl：Nginx提供ssl功能</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">pcre：提供地址重写rewrite功能</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">创建nginx系统用户和组</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">groupadd  -r nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">useradd -s /sbin/nologin -g nginx -r  nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">自定义模块</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">./configure \</span></div><div><span style="font-size: 11pt;">--prefix=/usr/local \</span></div><div><span style="font-size: 11pt;">--sbin-path=/usr/sbin/nginx \</span></div><div><span style="font-size: 11pt;">--conf-path=/etc/nginx/nginx.conf \</span></div><div><span style="font-size: 11pt;">--error-log-path=/var/log/nginx/error.log \</span></div><div><span style="font-size: 11pt;">--pid-path=/var/run/nginx/nginx.pid \</span></div><div><span style="font-size: 11pt;">--lock-path=/var/lock/nginx.lock \</span></div><div><span style="font-size: 11pt;">--user=nginx \</span></div><div><span style="font-size: 11pt;">--group=nginx \</span></div><div><span style="font-size: 11pt;">--with-http_ssl_module \</span></div><div><span style="font-size: 11pt;">--with-http_flv_module \</span></div><div><span style="font-size: 11pt;">--with-http_gzip_static_module \</span></div><div><span style="font-size: 11pt;">--http-log-path=/var/log/nginx/access.log \</span></div><div><span style="font-size: 11pt;">--http-client-body-temp-path=/var/tmp/nginx/client \</span></div><div><span style="font-size: 11pt;">--http-proxy-temp-path=/var/tmp/nginx/proxy \</span></div><div><span style="font-size: 11pt;">--http-fastcgi-temp-path=/var/tmp/nginx/fcgi \</span></div><div><span style="font-size: 11pt;">--with-http_stub_status_module</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">make &amp;&amp; make install</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">编译完成后可以启动nginx，不能通过systemd服务控制启动</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx控制方法</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# /usr/sbin/nginx -c /etc/nginx/nginx.conf</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">从容关闭Nginx，就是给nginx发信号</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# kill -QUIT $(cat /var/run/nginx/nginx.pid)</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">平滑重启nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> ~]# kill -HUP $(cat /var/run/nginx/nginx.pid)</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">快速停止</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# kill -TERM $(cat /var/run/nginx/nginx.pid)</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">强制结束所有的nginx进程</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# pkill -9 nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">发送信号重新读取配置文件</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# pkill -1 nginx</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">检测nginx配置文件语法</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> ~]# /usr/sbin/nginx  -t -c /etc/nginx/nginx.conf</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">nginx: configuration file /etc/nginx/nginx.conf test is successful</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">配置文件语法，每一个server代表一个虚拟主机，每一个location代表一个目录，如果在location外面指定root目录，location定义的目录就是根据root定义的目录结构来的，定义的内容每行最后都要以‘；’结尾</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); line-height: 1.75; font-weight: bold;">location匹配规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">语法：location [=|~|~*|^~] /url/ {...}</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">默认值：no</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">使用字段：server下的location</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">这个参数根据URL的不同需求来进行配置，可以使用字符串与正则表达式匹配，如果要使用正则表达式，你必须指定下列前缀</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">~：区分大小写</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">~*：不区分大小写</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">^~：禁止表达式匹配</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">=“精确匹配</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">如果有重复匹配，则匹配最精确的行</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">EXAMPLE：</span></div><div><span style="font-size: 11pt;">location = / {</span></div><div><span style="font-size: 11pt;">#只匹配/的查询</span></div><div><span style="font-size: 11pt;">[configuration A]</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">location / {</span></div><div><span style="font-size: 11pt;">#匹配任何以/开始的查询，但是正则表达式与一些较长的字符串将被首先匹配</span></div><div><span style="font-size: 11pt;">[configuration B]</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">location ^~ /images/ {</span></div><div><span style="font-size: 11pt;">#匹配任何以/images/开始的查询并且停止搜索，不检查正则表达式</span></div><div><span style="font-size: 11pt;">[configuration C]</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">location ~* \.(gif|jgp|jpeg)$｛</span></div><div><span style="font-size: 11pt;">＃匹配任何以gif，jpg，或jpeg结尾的文件，但是有/images/目录的请求将在configuration C 中处理</span></div><div><span style="font-size: 11pt;">[configuration D]</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); line-height: 1.75; font-weight: bold;">配置虚拟主机，每一个server都是一个虚拟主机</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">[</span><a href="mailto:root@localhost" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">root@localhost</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> redhatb2]# cat /etc/nginx/nginx.conf | grep -v \# | grep -v ^$</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">#user  nobody；        </span></div><div><span style="font-size: 11pt;">指定用于运行worker进程的用户和组【user  nginx  nginx 】编译过程中指定了user和group此处就无需再指定</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#pid  /PATH/TO/PID_FILE；</span></div><div><span style="font-size: 11pt;">指定nginx进程的pid文件路径</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#worker_cpu_affinity；           cpu绑定</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#worker_priority [-20-19];       指定nice值，默认为0</span></div><div><br style="font-size: 11pt;"/></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">worker_processes  1;   ======&gt;可以设置为auto自动匹配cpu个数</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">events {</span></div><div><span style="font-size: 11pt;">    worker_connections  1024;</span></div><div><span style="font-size: 11pt;">}</span></div><div><span style="font-size: 11pt;">http {</span></div><div><span style="font-size: 11pt;">    include       mime.types;</span></div><div><span style="font-size: 11pt;">    default_type  application/octet-stream;</span></div><div><span style="font-size: 11pt;">    sendfile        on;</span></div><div><span style="font-size: 11pt;">    keepalive_timeout  65;</span></div><div><span style="font-size: 11pt;">    server {</span></div><div><span style="font-size: 11pt;">        listen       80;</span></div><div><span style="font-size: 11pt;">        server_name  </span><a href="http://redhatb1.example.com/" style="font-size: 11pt;">redhatb1.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">        root /var/www/redhatb1;</span></div><div><span style="font-size: 11pt;">        location / {</span></div><div><span style="font-size: 11pt;">            index  index.html index.htm;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">        error_page   500 502 503 504  /50x.html;</span></div><div><span style="font-size: 11pt;">        location = /50x.html {</span></div><div><span style="font-size: 11pt;">            root   html;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">    }</span></div><div><span style="font-size: 11pt;">    server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">         }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="line-height: 1.75;">上面的</span><a href="http://redhatb2.example.com/" style="line-height: 1.75;">redhatb2.example.com</a><span style="line-height: 1.75;">主机设置成为了默认主机，此时，如果有域名解析到服务器的IP地址并请求，但是nginx配置文件中没有相对应的虚拟主机条目，此时就会跳转到redhatb2这个默认的虚拟主机上。如果所有的虚拟主机都没有配置成为默认主机选项，那么默认跳转到第一条虚拟主机条目。</span><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">当默认条目附加到以下条目的时候，配置中没有响应条目的请求就会跳到以下配置上，就会返回错误信息</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">    server {</span></div><div><span style="font-size: 11pt;">         listen       80  default_server;</span></div><div><span style="font-size: 11pt;">         server_name  _;</span></div><div><span style="font-size: 11pt;">         return       444;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">自定义日志，可以根据不同的虚拟主机定义不同的错误日志</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;     =====&gt;可以指定级别，出于调试目的，可以指定为debug级别，但是仅在编译时，使用了“--with-debug”选项时才有效</span></div><div><span style="font-size: 11pt;">      }</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">自定义错误页面，可以根据自己需求自定义错误页面</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           error_page   403 404  /40x.html;</span></div><div><span style="font-size: 11pt;">           location = /40x.html {</span></div><div><span style="font-size: 11pt;">           root   /var/www/error;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">要在/var/www/error下面创建40x.html，里面的内容是自定义的错误页面</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">可以一起定义，也可以分开定义如下所示，这样403和404错误可以显示不同的内容，同时，也需要在/var/www/error下创建403.html和404.html错误页面</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           error_page   403  /403.html;</span></div><div><span style="font-size: 11pt;">           location = /403.html {</span></div><div><span style="font-size: 11pt;">           root   /var/www/error;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           error_page   404  /404.html;</span></div><div><span style="font-size: 11pt;">           location = /404.html {</span></div><div><span style="font-size: 11pt;">           root   /var/www/error;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">自动索引功能</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           location /data {</span></div><div><span style="font-size: 11pt;">           autoindex on;</span></div><div><span style="font-size: 11pt;">           }</span></div><div><span style="font-size: 11pt;">      }</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">开启这个功能后，访问</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"><a href="http://redhatb2.example.com/data" style="font-size: 14px; line-height: 1.75; background-color: rgb(255, 255, 255);">redhatb2.example.com/data</a>时</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">将自动把/data目录下的所有文件列出来，和Apache里的</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Options Indexes功能一样，当用户请求/data目录的时候，会直接列出目录里面的内容，不会报403错误，这种方式很不安全，除非作为下载站使用。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">别名功能</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           location /a {</span></div><div><span style="font-size: 11pt;">           alias /var/www/alias/test;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">假如当你访问</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">/a/top.gif的时候，实际上访问的是/var/www/alias/test/top.gif</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"><font style="color: rgb(227, 0, 0);">！！注意！！当location后面定义的目录以/结尾时，下面alias定义的目录也要以/结尾，否则报错</font></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">像这样就不会报错，和上面不以/结尾时一样的，要么都加，要么都不加</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">   location /a/ {</span></div><div><span style="font-size: 11pt;">           alias /var/www/alias/test/;</span></div><div><span style="font-size: 11pt;">        }</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">但是如果加上/的话，用户在浏览器中也必须以/结尾，如果只是对一条路径的其中一段做别名，可以加上/，也可以不加，所以综合来看，还是不加要方便一点</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Apache里面做别名有一个Alias模块专门定义别名，而不在directory里面定义</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">控制站点的访问</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           location /a {</span></div><div><span style="font-size: 11pt;">           deny 192.168.0.123;</span></div><div><span style="font-size: 11pt;">           allow 192.168.0.0/24;</span></div><div><span style="font-size: 11pt;">           allow 192.168.1.1;</span></div><div><span style="font-size: 11pt;">           deny all;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">这种控制有先后顺序，和Apache不一样，nginx是从上到下依次匹配，和防火墙的匹配规则类似</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">目录身份验证</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">和Apache的目录身份验证类似，只是语法不一样</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           location /data {</span></div><div><span style="font-size: 11pt;">           autoindex on;</span></div><div><span style="font-size: 11pt;">           auth_basic &quot;AwstatAuth&quot;;</span></div><div><span style="font-size: 11pt;">           auth_basic_user_file /etc/nginx/htpasswd;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">同时也需要使用htpasswd命令创建htpasswd文件，详细操作参考 的基于认证的网页登录笔记</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx状态检查</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">           listen 80 default_server;</span></div><div><span style="font-size: 11pt;">           server_name</span> <a href="http://redhatb2.example.com/" style="font-size: 11pt;">redhatb2.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">           root /var/www/redhatb2;</span></div><div><span style="font-size: 11pt;">           index  index.html;</span></div><div><span style="font-size: 11pt;">           access_log /var/log/nginx/redhatb2-access.log main;</span></div><div><span style="font-size: 11pt;">           error_log /var/log/nginx/redhatb2-error.log warn;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">           location /status {</span></div><div><span style="font-size: 11pt;">           stub_status on;</span></div><div><span style="font-size: 11pt;">           access_log off;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">/status目录可以不存在，进入</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"><a href="http://redhatb2.example.com/status" style="font-size: 14px; line-height: 1.75; background-color: rgb(255, 255, 255);">redhatb2.example.com/status</a>可以查看nginx的状态信息，例如</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Active connections: 2 server accepts handled requests 46 46 198 Reading: 0 Writing: 1 Waiting: 1</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx地址重写rewrite</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">Rewrite主要的功能就是实现URL的重写，如果需要nginx的地址重写功能，那么在编译之前，需要编译安装PCRE库（兼容perl的正则表达式）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">URL：统一资源定位符，用户浏览器里面输入的是URL地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">URI：由一个通过通用资源标识符进行定位，配置文件中location定义的是URI地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">变量名可以使用“=”或“！=”运算符</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“~”表示区分大小写字母的匹配</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“~*”表示不区分大小写的匹配</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“！~”和“！~*”与“~”“！~”相反</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“-f”和“！-f”用来判断文件是否存在</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“-d”和“！-d”用来判断目录是否存在</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“-e”和“！-e”用来判断文件或目录是否存在</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">“-x”和“！-x”用来判断文件是否可以执行</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">同时支持$1到$9的位置化参数</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">rewrite最后一项参数为flag标记，支持以下几种</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">last：相当于Apache里面的【L】标记，表示完成rewrite</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">break：本条规则匹配完成后，终止匹配，不再匹配后面的规则</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">redirect：返回302临时重定向，浏览器地址会显示跳转后的URL地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">permanent：返回301永久重定向，浏览器地址栏会显示跳转后的URL地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">last和break用来实现URI重写，浏览器地址栏URL地址不变</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">redirect和permanent用来实现URL跳转，浏览器地址栏会显示跳转后的URL地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">一般在跟location中（即location /  {......}）或直接在server标签中编写rewrite规则，推荐使用last标记</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">在非根location中（location /data {......}），则使用break标记</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">if指令</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">规则语法</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">if（$http_user_agent ~ MSIE）{</span></div><div><span style="font-size: 11pt;">     rewrite ^(.*)$/mesi/$1 break;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$1代表位置化参数，引用root后面的URI路径</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">break 标识符</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">if(!-f $request_filename){</span></div><div><span style="font-size: 11pt;">rewrite ^/img/(.*)$ /site/$host/imgages/$1 last;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">return指令</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">规则语法</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">location ~ .*\.(sh|bash)?$</span></div><div><span style="font-size: 11pt;">{</span></div><div><span style="font-size: 11pt;">return 403;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">1、将原来要访问/pub目录重写为/download</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">        listen       80;</span></div><div><span style="font-size: 11pt;">        server_name  </span><a href="http://redhatb1.example.com/" style="font-size: 11pt;">redhatb1.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">        root /var/www/redhatb1;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        location / {</span></div><div><span style="font-size: 11pt;">            index  index.html index.htm;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        location /pub {</span></div><div><span style="font-size: 11pt;">           rewrite ^/pub/?$ /download permanent;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        location /download {</span></div><div><span style="font-size: 11pt;">         autoindex on;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 14px; line-height: 1.75; white-space: pre-wrap;">将所有请求</span><a href="http://redhatb1.example.com/pub" style="font-size: 14px; line-height: 1.75;">redhatb1.example.com/pub</a><span style="font-size: 14px; line-height: 1.75; white-space: pre-wrap;">的链接重写到</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255);"><a href="http://redhatb1.example.com/download" style="font-size: 14px; line-height: 1.75; background-color: rgb(255, 255, 255);">redhatb1.example.com/download</a></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">rewrite可以写在location里面，也可以写在location外面</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">2、根据不同的浏览器将得到不同的结果</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">        listen       80;</span></div><div><span style="font-size: 11pt;">        server_name  </span><a href="http://redhatb1.example.com/" style="font-size: 11pt;">redhatb1.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">        root /var/www/redhat1;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        if ($http_user_agent ~ Firefox ){</span></div><div><span style="font-size: 11pt;">        rewrite ^/data/(.*)$ /firefox/data/$1 last;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">        if ($http_user_agent ~ MSIE) {</span></div><div><span style="font-size: 11pt;">        rewrite ^(.*)$  /msie/$1 last;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">红色标记的两种重写不一样，上面的可以实现目录和文件的跳转，而下面的只能实现文件的跳转，上面一种情况比较好，但是必须制定一个下级目录，而不能指定全部目录</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">3、实现域名跳转</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">         listen      80;</span></div><div><span style="font-size: 11pt;">         server_name  </span><a href="http://redhatb3.example.com/" style="font-size: 11pt;">redhatb3.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">         root /var/www/redhatb3;</span></div><div><span style="font-size: 11pt;">         index index.html;</span></div><div><span style="font-size: 11pt;">         rewrite ^(.*)$</span> <a href="http://redhatb1.example.com/$1" style="font-size: 11pt;">http://redhatb1.example.com/$1</a> <span style="font-size: 11pt;">permanent;</span></div><div><span style="font-size: 11pt;">        location /firefox/data {</span></div><div><span style="font-size: 11pt;">           index index.html;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="font-size: 14px; line-height: 1.75; white-space: pre-wrap;">当访问</span><a href="http://redhatb3.example.com/" style="font-size: 14px; line-height: 1.75;">redhatb3.example.com</a><span style="font-size: 14px; line-height: 1.75; white-space: pre-wrap;">的时候，将自动跳转到</span><a href="http://redhatb1.example.com/" style="font-size: 14px; line-height: 1.75;">redhatb1.example.com</a></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">TLS认证的配置</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">        listen       443 ssl;</span></div><div><span style="font-size: 11pt;">        server_name  </span><a href="http://redhatb.example.com/" style="font-size: 11pt;">redhatb.example.com</a><span style="font-size: 11pt;">;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        ssl_certificate      /etc/pki/tls/certs/nginx.crt;</span></div><div><span style="font-size: 11pt;">        ssl_certificate_key  /etc/pki/tls/private/nginx.key;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        ssl_session_cache    shared:SSL:1m;</span></div><div><span style="font-size: 11pt;">        ssl_session_timeout  5m;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        ssl_ciphers  HIGH:!aNULL:!MD5;</span></div><div><span style="font-size: 11pt;">        ssl_prefer_server_ciphers  on;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">        location / {</span></div><div><span style="font-size: 11pt;">            root   /var/www/redhatb;</span></div><div><span style="font-size: 11pt;">            index  index.html index.htm;</span></div><div><span style="font-size: 11pt;">        }</span></div><div><span style="font-size: 11pt;">    }</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">通过keygen命令生成证书和私钥，证书放在</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">/etc/pki/tls/certs里面，私钥放在/etc/pki/tls/private里面，重启nginx生效</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx日志管理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">log_format指令用来设置日志的记录格式，语法如下：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">log_format name format  [format......]</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">默认的日志格式</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">                      '$status $body_bytes_sent &quot;$http_referer&quot; '</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$remote_addr：客户端的IP地址</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$remote_user：用来记录远程客户端用户名称，一般不会有记录，除非用账号密码认证了的，才会记录用户名</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$time_local：用来记录访问时间及时区</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$request：用于记录请求的URL和HTTP协议</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$status：用于记录请求的状态，例如成功时状态为200，页面找不到时为404</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$bady_bytes_sent：用于记录发送给客户端的文件主体内容大小</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$http_referer：用于记录是从哪个页面链接访问过来的</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$http_user_agemt：用于记录客户端浏览器的相关信息</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">$http_x_forwarded_for：用于记录远程用户真正的IP地址。一旦有了缓存，代理，后端日志记录的是缓存，代理的IP地址，而不会记录原来真正的IP地址，此字段就是用于记录真正的来源IP地址。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">可以给每个server或者每个location分别定义日志，更精确</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">可以将日志放在缓存里面例如：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">access_log  /data/log/$server_name.log main buffer=32k;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">buffer=32k：表示设置内存缓冲区的大小</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">注意：尽量不要用变量，当主机不多的时候，直接用主机名</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">开启日志打开缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">对于每一条日志记录，日志文件都将先打开文件，再写入日志记录，然后马上关闭，为了提高包含变量的日志文件存放路径的性能，可以使用open_log_file_cache指令来设置，格式如下：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">open_log_file_cache  max=N [incative=time] [min_user=N] [valid=time] | off</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">该指令默认是禁止的，等同于open_log_file_cache off;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">max：设置缓存中的最大文件描述符数量</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">inactive：设置一个时间，如果在设置的时间内没有使用此文件描述符，则自动删除此描述符</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">min_uses：在参数inactive指定的时间范围内，如果日志文件超过被使用的次数，则将该日志文件的描述符计入缓存，默认为10秒钟</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">valid：设置多长时间检查一次，看日志文件路径与文件名是否仍然存在，默认60秒</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(255, 0, 0);">open_log_file_cache max=1000 inactive=20s min_uses=2 valid=1m;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">这条指令的意思是，设置1000个文件描述符，每1分钟检查一次，如果检查到20秒内该文件没有被使用2次，则将它从缓存中删除，如果使用了2次及2次以上，则计入缓存。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;"> </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">可以进行nginx日志的分割</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">编辑一个脚本</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">vim /var/log/nginx/nginx_log.sh</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">#!/bin/bash</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#定义日志目录</span></div><div><span style="font-size: 11pt;">log_path='/var/log/nginx'</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#创建每天的目录</span></div><div><span style="font-size: 11pt;">mkdir -p  $log_path/$(date -d yesterday +%Y)/$(date -d yesterday +%m)/$(date -d yesterday +%d)/</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#把日志移动到相应的目录</span></div><div><span style="font-size: 11pt;">mv $log_path/redhatb2-access.log $log_path/$(date -d yesterday +%Y)/$(date -d yesterday +%m)/$(date -d yesterday +%d)/$(date -d yesterday +%Y-%m-%d)-redhatb2.access.log</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">#重启nginx生成新的日志文件</span></div><div><span style="font-size: 11pt;">kill -HUP $(cat /var/run/nginx/nginx.pid)</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#创建计划任务</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">crontab -e</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">01 01 * * * /bin/bash /var/log/nginx/nginx_log.sh</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">每天的1点1分执行一次</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">上述脚本及计划任务的作用就是，把每天的日志分割出来，放到相应的目录里面去，便于管理，不至于日志文件过于庞大</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx开启压缩功能</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">在http{......}中间，启用压缩</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#vim /etc/nginx/nginx.conf</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">gzip on；</span></div><div><span style="font-size: 11pt;">gzip_mon_length 1k ;</span></div><div><span style="font-size: 11pt;">gzip_buffer 4 16k ;</span></div><div><span style="font-size: 11pt;">gzip_http_version 1.1 ;</span></div><div><span style="font-size: 11pt;">gzip_comp_level 2 ;</span></div><div><span style="font-size: 11pt;">gzip_type text/plain application/x-javascript text/css application/xml;</span></div><div><span style="font-size: 11pt;">gzip_vary on；</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">nginx的浏览器本地缓存设置</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#vim /etc/nginx/nginx.conf</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">location  ~  .*\.(gif|jpg|jpge|png|bmp|swf)$</span></div><div><span style="font-size: 11pt;">{</span></div><div><span style="font-size: 11pt;">    expires 30d;</span></div><div><span style="font-size: 11pt;">}</span></div><div><span style="font-size: 11pt;">location  ~  .*\.(js|css)?$</span></div><div><span style="font-size: 11pt;">{</span></div><div><span style="font-size: 11pt;">    expires 1h;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">分别缓存30天和一个小时</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">设定限速</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">location /download {</span></div><div><span style="font-size: 11pt;">    limit_rate_after 20m;</span></div><div><span style="font-size: 11pt;">    limit_rate 256k;</span></div><div><span style="font-size: 11pt;">    autoindex on;</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">设置前20M不限速，下载完20M之后开始限速，每秒256KB</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">设置反向代理及缓冲，下面是整个的配置</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75;">需要在http和location字段中同时设置</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">http {</span></div><div><span style="font-size: 11pt;">    include       mime.types;</span></div><div><span style="font-size: 11pt;">    default_type  application/octet-stream;</span></div><div><span style="font-size: 11pt;">    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span></div><div><span style="font-size: 11pt;">                      '$status $body_bytes_sent &quot;$http_referer&quot; '</span></div><div><span style="font-size: 11pt;">                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</span></div><div><span style="font-size: 11pt;">    sendfile        on;</span></div><div><span style="font-size: 11pt;">    keepalive_timeout  65;</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">client_max_body_size 300m;   </span></div><div><span style="font-size: 11pt;">client_body_buffer_size 128k;    </span></div><div><span style="font-size: 11pt;">proxy_read_timeout 600;   </span></div><div><span style="font-size: 11pt;">proxy_send_timeout 600;</span></div><div><span style="font-size: 11pt;">proxy_buffer_size 16k;</span></div><div><span style="font-size: 11pt;">proxy_buffers 4 32k;</span></div><div><span style="font-size: 11pt;">proxy_busy_buffers_size 64k;</span></div><div><span style="font-size: 11pt;">proxy_temp_file_write_size 64k;</span></div><div><span style="font-size: 11pt;">proxy_temp_path  /proxy/nginx/temp;</span></div><div><span style="font-size: 11pt;">proxy_cache_path  /proxy/nginx/cache  levels=1:2  keys_zone=cache_one:500m  inactive=1d   max_size=1g;</span></div><div><span style="font-size: 11pt;">#上面这一段可以写到下面的location中，写在这里表示全局适用</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">server {</span></div><div><span style="font-size: 11pt;">         listen      80;</span></div><div><span style="font-size: 11pt;">         server_name  </span><a href="http://redhatb3.example.com/" style="font-size: 11pt;">redhatb3.example.com</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">         root /var/www/redhatb3;</span></div><div><span style="font-size: 11pt;">         index index.html;</span></div><div><span style="font-size: 11pt;">         location /firefox/data {</span></div><div><span style="font-size: 11pt;">           index index.html;</span></div><div><span style="font-size: 11pt;">         }</span></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">         location /sms {</span></div><div><span style="font-size: 11pt;">         proxy_pass http://172.25.254.121;</span></div><div><span style="font-size: 11pt;">         proxy_set_header Host $host;</span></div><div><span style="font-size: 11pt;">         proxy_cache cache_one;</span></div><div><span style="font-size: 11pt;">         proxy_set_header X-Forwarded-For $remote_addr;</span></div><div><span style="font-size: 11pt;">         proxy_cache_valid 200 10m;</span></div><div><span style="font-size: 11pt;">         proxy_cache_valid 304 1m;</span></div><div><span style="font-size: 11pt;">         proxy_cache_valid 301 302 1h;</span></div><div><span style="font-size: 11pt;">         proxy_cache_valid any 1m;</span></div><div><span style="font-size: 11pt;">         proxy_cache_key $host$uri$is_args$args;</span></div><div><span style="font-size: 11pt;">         }</span></div><div><span style="font-size: 11pt;">   }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; font-weight: bold;">在http段进行设置中的各个指令的意义</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75;">http  {</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;"> #允许客户端请求的最大的单个文件字节数</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    client_max_body_size 300m;   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">  </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">#缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    client_body_buffer_size 128k;    </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#跟后端服务器连接的超时时间，发起握手等候响应的超时时间</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_connent_timeout 600;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">#连接成功后，等候后端服务器响应时间，其实已经进入后端的排队之中等候处理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_read_timeout 600;   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">#后端服务器回传时间，就是在规定时间之内后端服务器必须传完所有的数据</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_send_timeout 600;   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">#代理请求缓存区，这个缓存区会保存用户的头信息以供nginx进行规则处理，一般只要能保存下头信息即可</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_buffer_size 16k;   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#告诉nginx保存单个用的几个buffer及最大用多大空间</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_buffers 4 32k;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#如果系统很忙的时候可以申请更大的proxy_buffers，官方推荐*2</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_busy_buffers_size 64k;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#proxy缓存临时文件的大小</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">    proxy_temp_file_write_size 64k;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_temp_path  /data1/proxy_temp_path;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_cache_path  /data1/proxy_cache_path  </span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">levels=1:2  keys_zone=cache_one:500m  inactive=1d   max_size=1g;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">}</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">###上面</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">keys_zone=cache_one:500m指定的500m是存放在内存中的，不要设置的太大，cache_one是cache的名字，inactive=1d 缓存一天</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; font-weight: bold;">在location中设置的指令的意义</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75;">location /sms {</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#根据目录将请求丢到后端服务器，而本地不能有/sms目录，否则将访问本地的/sms目录</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_pass</span> <a href="http://172.25.254.111/" style="white-space: pre-wrap; font-size: 14px; line-height: 1.75; color: rgb(0, 56, 132); text-decoration: underline;">http://172.25.254.111</a><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">;      #后面可以接IP也可以接ip加端口号</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#这个字段的意思是记录来源IP，而不是记录代理服务器，就是后端的日志里面记录的不是代理服务器IP，而是，真正远端客户端的IP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_set_header Host $host;   </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#引用的cache</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_cache cache_one;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">#记录远程IP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_set_header X-Forwarded-For $remote_addr;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; line-height: 1.75;">上面这些设置仅仅是把请求丢到后端，并没有做缓存，如果需要缓存，加上以下字段</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_cache_valid 200 10m;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_cache_valid 304 1m;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">proxy_cache_valid 301 302 1h;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">proxy_cache_valid any 1m;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">#以域名、URI、参数组合成Web缓存key值，nginx根据key值哈希，存储缓存内容到二级缓存目录内</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">proxy_cache_key $host$uri$is_args$args;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); line-height: 1.75;">}</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; line-height: 1.75; font-weight: bold;">upstream模块实现负载均衡</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">upstream这个字段应该设置在http段里面</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt;">http {</span></div><div><span style="font-size: 11pt;">......</span></div><div><span style="font-size: 11pt;">upstream my_server_pool {</span></div><div><span style="font-size: 11pt;">    server 172.25.254.121:80 weight=1 max_fails=2 fail_timeout=30s;</span></div><div><span style="font-size: 11pt;">    server 172.25.254.123:80 weight=2 max_fails=2 fail_timeout=30s;</span></div><div><span style="font-size: 11pt;">    }</span></div><div><br style="font-size: 11pt;"/></div><div><br style="font-size: 11pt;"/></div><div><span style="font-size: 11pt;">   location /sms {</span></div><div><span style="font-size: 11pt;">         proxy_pass</span> <a href="http://my_server_pool/" style="font-size: 11pt;">http://my_server_pool</a><span style="font-size: 11pt;">;</span></div><div><span style="font-size: 11pt;">    }</span></div><div><span style="font-size: 11pt;">}</span></div></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); line-height: 1.75;">在上面的配置中，my_server_pool是upstream的名字，可以随便取，weight代表权重，就是丢给那个主机的次数，权重为2表示丢给它两次，再丢给下个主机，以上面的为例，121处理一次，123处理2次，再丢给121处理1次，然后再丢给123处理2次。max_fails为最大失败次数，失败两次后，丢给下一台主机，fail_timeout表示超时时间，超过30秒，丢给下一台主机</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">      </span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">ab -c 100 -n 1000 http://。。。。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div><br/></div></span>
</div></body></html> 